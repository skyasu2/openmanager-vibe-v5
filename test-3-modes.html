<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸš€ OpenManager Vibe v5 - 3ê°€ì§€ ëª¨ë“œ í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        h1 {
            text-align: center;
            color: #2d3748;
            margin-bottom: 30px;
            font-size: 2.5em;
        }

        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .test-card {
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 25px;
            background: #f8fafc;
        }

        .test-card h2 {
            color: #2b6cb0;
            margin-top: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .test-questions {
            margin: 20px 0;
        }

        .question-btn {
            display: block;
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            background: #4299e1;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .question-btn:hover {
            background: #3182ce;
            transform: translateY(-2px);
        }

        .result-area {
            margin-top: 20px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #4299e1;
            min-height: 200px;
            font-size: 13px;
            overflow-y: auto;
            max-height: 400px;
        }

        .loading {
            color: #666;
            font-style: italic;
        }

        .success {
            color: #38a169;
        }

        .error {
            color: #e53e3e;
        }

        .comparison-section {
            margin-top: 40px;
            padding: 30px;
            background: #edf2f7;
            border-radius: 12px;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #cbd5e0;
        }

        .comparison-table th {
            background: #4a5568;
            color: white;
        }

        .mode-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }

        .badge-rag {
            background: #c6f6d5;
            color: #22543d;
        }

        .badge-pattern {
            background: #fed7d7;
            color: #742a2a;
        }

        .badge-mcp {
            background: #bee3f8;
            color: #2a4365;
        }

        .stats-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #4299e1;
        }

        .debug-info {
            background: #1a202c;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            overflow-x: auto;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ğŸš€ OpenManager Vibe v5 - 3ê°€ì§€ ëª¨ë“œ ë¹„êµ í…ŒìŠ¤íŠ¸</h1>

        <div class="test-grid">
            <!-- RAG Engine ëª¨ë“œ -->
            <div class="test-card">
                <h2>ğŸ¤– <span class="mode-badge badge-rag">RAG Engine</span></h2>
                <p><strong>ë²¡í„° ê²€ìƒ‰ + ëª…ë ¹ì–´ ë°ì´í„°ë² ì´ìŠ¤</strong><br>
                    ê°€ì¥ ì •í™•í•œ ëª…ë ¹ì–´ ê¸°ë°˜ ì‘ë‹µì„ ì œê³µí•©ë‹ˆë‹¤.</p>

                <div class="test-questions">
                    <button class="question-btn" onclick="testRAG('CPU ì‚¬ìš©ë¥ ì´ 95%ì¼ ë•Œ ì–´ë–»ê²Œ í•´ì•¼ í•˜ë‚˜ìš”?')">
                        ğŸ§ Linux CPU 95% ë¬¸ì œ
                    </button>
                    <button class="question-btn" onclick="testRAG('Kubernetes Podê°€ CrashLoopBackOff ìƒíƒœì…ë‹ˆë‹¤')">
                        â˜¸ï¸ K8s Pod CrashLoopBackOff
                    </button>
                    <button class="question-btn" onclick="testRAG('MySQL ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°ì´ ì‹¤íŒ¨í•©ë‹ˆë‹¤')">
                        ğŸ˜ MySQL ì—°ê²° ì‹¤íŒ¨
                    </button>
                    <button class="question-btn" onclick="testRAG('ë¦¬ëˆ…ìŠ¤ top ëª…ë ¹ì–´ ì‚¬ìš©ë²•')">
                        ğŸ“Š Linux top ëª…ë ¹ì–´
                    </button>
                </div>

                <div class="result-area" id="rag-result">
                    RAG Engine í…ŒìŠ¤íŠ¸ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...
                </div>
            </div>

            <!-- íŒ¨í„´ ë§¤ì¹­ ëª¨ë“œ -->
            <div class="test-card">
                <h2>ğŸ” <span class="mode-badge badge-pattern">Pattern Matching</span></h2>
                <p><strong>í‚¤ì›Œë“œ íŒ¨í„´ ê¸°ë°˜ ë§¤ì¹­</strong><br>
                    ë¹ ë¥¸ ì‘ë‹µì´ì§€ë§Œ ì œí•œì ì¸ ì •í™•ë„ë¥¼ ì œê³µí•©ë‹ˆë‹¤.</p>

                <div class="test-questions">
                    <button class="question-btn" onclick="testPattern('CPU ì‚¬ìš©ë¥ ì´ 95%ì¼ ë•Œ ì–´ë–»ê²Œ í•´ì•¼ í•˜ë‚˜ìš”?')">
                        ğŸ§ Linux CPU 95% ë¬¸ì œ
                    </button>
                    <button class="question-btn" onclick="testPattern('Kubernetes Podê°€ CrashLoopBackOff ìƒíƒœì…ë‹ˆë‹¤')">
                        â˜¸ï¸ K8s Pod CrashLoopBackOff
                    </button>
                    <button class="question-btn" onclick="testPattern('MySQL ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°ì´ ì‹¤íŒ¨í•©ë‹ˆë‹¤')">
                        ğŸ˜ MySQL ì—°ê²° ì‹¤íŒ¨
                    </button>
                    <button class="question-btn" onclick="testPattern('ë¦¬ëˆ…ìŠ¤ top ëª…ë ¹ì–´ ì‚¬ìš©ë²•')">
                        ğŸ“Š Linux top ëª…ë ¹ì–´
                    </button>
                </div>

                <div class="result-area" id="pattern-result">
                    íŒ¨í„´ ë§¤ì¹­ í…ŒìŠ¤íŠ¸ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...
                </div>
            </div>

            <!-- MCP ì»¨í…ìŠ¤íŠ¸ ëª¨ë“œ -->
            <div class="test-card">
                <h2>ğŸ§  <span class="mode-badge badge-mcp">MCP Context</span></h2>
                <p><strong>ì»¨í…ìŠ¤íŠ¸ íŒŒì¼ ê¸°ë°˜ AI ì‘ë‹µ</strong><br>
                    ìƒí™©ë³„ ë§ì¶¤ ê°€ì´ë“œë¥¼ ì œê³µí•©ë‹ˆë‹¤.</p>

                <div class="test-questions">
                    <button class="question-btn" onclick="testMCP('CPU ì‚¬ìš©ë¥ ì´ 95%ì¼ ë•Œ ì–´ë–»ê²Œ í•´ì•¼ í•˜ë‚˜ìš”?')">
                        ğŸ§ Linux CPU 95% ë¬¸ì œ
                    </button>
                    <button class="question-btn" onclick="testMCP('Kubernetes Podê°€ CrashLoopBackOff ìƒíƒœì…ë‹ˆë‹¤')">
                        â˜¸ï¸ K8s Pod CrashLoopBackOff
                    </button>
                    <button class="question-btn" onclick="testMCP('MySQL ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°ì´ ì‹¤íŒ¨í•©ë‹ˆë‹¤')">
                        ğŸ˜ MySQL ì—°ê²° ì‹¤íŒ¨
                    </button>
                    <button class="question-btn" onclick="testMCP('ë¦¬ëˆ…ìŠ¤ top ëª…ë ¹ì–´ ì‚¬ìš©ë²•')">
                        ğŸ“Š Linux top ëª…ë ¹ì–´
                    </button>
                </div>

                <div class="result-area" id="mcp-result">
                    MCP ì»¨í…ìŠ¤íŠ¸ í…ŒìŠ¤íŠ¸ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...
                </div>
            </div>
        </div>

        <!-- ë¹„êµ ë¶„ì„ ì„¹ì…˜ -->
        <div class="comparison-section">
            <h2>ğŸ“Š 3ê°€ì§€ ëª¨ë“œ ë¹„êµ ë¶„ì„</h2>
            <table class="comparison-table" id="comparison-table">
                <thead>
                    <tr>
                        <th>ì§ˆë¬¸</th>
                        <th>RAG Engine</th>
                        <th>Pattern Matching</th>
                        <th>MCP Context</th>
                        <th>ìµœê³  ì„±ëŠ¥</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td colspan="5" style="text-align: center; color: #666;">
                            í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ë©´ ë¹„êµ ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- í†µê³„ ì„¹ì…˜ -->
        <div class="stats-section">
            <div class="stat-card">
                <div class="stat-number" id="total-tests">0</div>
                <div>ì´ í…ŒìŠ¤íŠ¸ ìˆ˜í–‰</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="avg-response-time">0ms</div>
                <div>í‰ê·  ì‘ë‹µ ì‹œê°„</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="success-rate">0%</div>
                <div>ì„±ê³µë¥ </div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="best-mode">-</div>
                <div>ìµœê³  ì„±ëŠ¥ ëª¨ë“œ</div>
            </div>
        </div>
    </div>

    <script>
        let testResults = {};
        let totalTests = 0;
        let successfulTests = 0;
        let totalResponseTime = 0;

        // RAG Engine í…ŒìŠ¤íŠ¸
        async function testRAG(question) {
            const resultDiv = document.getElementById('rag-result');
            resultDiv.innerHTML = '<div class="loading">ğŸ” RAG Engine ê²€ìƒ‰ ì¤‘...</div>';

            const startTime = Date.now();
            try {
                const response = await fetch('/api/analyze', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        query: question,
                        type: 'troubleshooting',
                        mode: 'rag' // ê°•ì œ RAG ëª¨ë“œ
                    })
                });

                const data = await response.json();
                const responseTime = Date.now() - startTime;

                if (data.success) {
                    displayResult('rag-result', data, responseTime, 'success');
                    recordTestResult(question, 'rag', data, responseTime, true);
                } else {
                    displayResult('rag-result', data, responseTime, 'error');
                    recordTestResult(question, 'rag', data, responseTime, false);
                }
            } catch (error) {
                displayResult('rag-result', { error: error.message }, Date.now() - startTime, 'error');
                recordTestResult(question, 'rag', { error: error.message }, Date.now() - startTime, false);
            }
        }

        // íŒ¨í„´ ë§¤ì¹­ í…ŒìŠ¤íŠ¸
        async function testPattern(question) {
            const resultDiv = document.getElementById('pattern-result');
            resultDiv.innerHTML = '<div class="loading">ğŸ” íŒ¨í„´ ë§¤ì¹­ ë¶„ì„ ì¤‘...</div>';

            const startTime = Date.now();
            try {
                const response = await fetch('/api/analyze', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        query: question,
                        type: 'troubleshooting',
                        mode: 'pattern' // íŒ¨í„´ ë§¤ì¹­ ëª¨ë“œ
                    })
                });

                const data = await response.json();
                const responseTime = Date.now() - startTime;

                displayResult('pattern-result', data, responseTime, data.success ? 'success' : 'error');
                recordTestResult(question, 'pattern', data, responseTime, data.success);
            } catch (error) {
                displayResult('pattern-result', { error: error.message }, Date.now() - startTime, 'error');
                recordTestResult(question, 'pattern', { error: error.message }, Date.now() - startTime, false);
            }
        }

        // MCP ì»¨í…ìŠ¤íŠ¸ í…ŒìŠ¤íŠ¸
        async function testMCP(question) {
            const resultDiv = document.getElementById('mcp-result');
            resultDiv.innerHTML = '<div class="loading">ğŸ§  MCP ì»¨í…ìŠ¤íŠ¸ ë¶„ì„ ì¤‘...</div>';

            const startTime = Date.now();
            try {
                const response = await fetch('/api/ai/unified', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        question: question,
                        context: 'system-troubleshooting'
                    })
                });

                const data = await response.json();
                const responseTime = Date.now() - startTime;

                displayResult('mcp-result', data, responseTime, data.success ? 'success' : 'error');
                recordTestResult(question, 'mcp', data, responseTime, data.success);
            } catch (error) {
                displayResult('mcp-result', { error: error.message }, Date.now() - startTime, 'error');
                recordTestResult(question, 'mcp', { error: error.message }, Date.now() - startTime, false);
            }
        }

        // ê²°ê³¼ í‘œì‹œ
        function displayResult(elementId, data, responseTime, status) {
            const resultDiv = document.getElementById(elementId);

            let html = `<div class="${status}">`;
            html += `<strong>ì‘ë‹µ ì‹œê°„:</strong> ${responseTime}ms<br>`;
            html += `<strong>ìƒíƒœ:</strong> ${status === 'success' ? 'âœ… ì„±ê³µ' : 'âŒ ì‹¤íŒ¨'}<br><br>`;

            if (data.data) {
                html += `<strong>íƒ€ì…:</strong> ${data.data.type || 'N/A'}<br>`;
                html += `<strong>ìš”ì•½:</strong> ${data.data.summary || 'N/A'}<br>`;
                html += `<strong>ì‹ ë¢°ë„:</strong> ${data.data.confidence || 'N/A'}<br>`;

                if (data.data.commands && data.data.commands.length > 0) {
                    html += `<strong>ëª…ë ¹ì–´:</strong><br>`;
                    data.data.commands.forEach(cmd => {
                        html += `â€¢ <code>${cmd}</code><br>`;
                    });
                }

                if (data.data.debug_info) {
                    html += `<div class="debug-info">`;
                    html += `<strong>ë””ë²„ê·¸ ì •ë³´:</strong><br>`;
                    html += `${JSON.stringify(data.data.debug_info, null, 2)}`;
                    html += `</div>`;
                }
            } else if (data.error) {
                html += `<strong>ì˜¤ë¥˜:</strong> ${data.error}`;
            } else {
                html += `<strong>ì‘ë‹µ:</strong> ${JSON.stringify(data, null, 2)}`;
            }

            html += `</div>`;
            resultDiv.innerHTML = html;
        }

        // í…ŒìŠ¤íŠ¸ ê²°ê³¼ ê¸°ë¡
        function recordTestResult(question, mode, data, responseTime, success) {
            if (!testResults[question]) {
                testResults[question] = {};
            }

            testResults[question][mode] = {
                data: data,
                responseTime: responseTime,
                success: success,
                timestamp: new Date().toISOString()
            };

            totalTests++;
            if (success) successfulTests++;
            totalResponseTime += responseTime;

            updateStats();
            updateComparisonTable();
        }

        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateStats() {
            document.getElementById('total-tests').textContent = totalTests;
            document.getElementById('avg-response-time').textContent =
                totalTests > 0 ? Math.round(totalResponseTime / totalTests) + 'ms' : '0ms';
            document.getElementById('success-rate').textContent =
                totalTests > 0 ? Math.round((successfulTests / totalTests) * 100) + '%' : '0%';

            // ìµœê³  ì„±ëŠ¥ ëª¨ë“œ ê³„ì‚°
            const modeStats = { rag: 0, pattern: 0, mcp: 0 };
            Object.values(testResults).forEach(questionResults => {
                Object.keys(questionResults).forEach(mode => {
                    if (questionResults[mode].success) {
                        modeStats[mode]++;
                    }
                });
            });

            const bestMode = Object.keys(modeStats).reduce((a, b) =>
                modeStats[a] > modeStats[b] ? a : b
            );

            const modeNames = { rag: 'RAG', pattern: 'Pattern', mcp: 'MCP' };
            document.getElementById('best-mode').textContent = modeNames[bestMode] || '-';
        }

        // ë¹„êµ í…Œì´ë¸” ì—…ë°ì´íŠ¸
        function updateComparisonTable() {
            const tbody = document.querySelector('#comparison-table tbody');
            let html = '';

            Object.keys(testResults).forEach(question => {
                const results = testResults[question];
                html += `<tr>`;
                html += `<td>${question.substring(0, 30)}...</td>`;

                ['rag', 'pattern', 'mcp'].forEach(mode => {
                    if (results[mode]) {
                        const result = results[mode];
                        const statusIcon = result.success ? 'âœ…' : 'âŒ';
                        const confidence = result.data.data?.confidence || 'N/A';
                        html += `<td>${statusIcon} ${result.responseTime}ms<br><small>ì‹ ë¢°ë„: ${confidence}</small></td>`;
                    } else {
                        html += `<td>-</td>`;
                    }
                });

                // ìµœê³  ì„±ëŠ¥ ê³„ì‚°
                let bestMode = '-';
                let bestScore = -1;
                Object.keys(results).forEach(mode => {
                    if (results[mode].success) {
                        const score = (results[mode].data.data?.confidence || 0) * 100 - results[mode].responseTime / 10;
                        if (score > bestScore) {
                            bestScore = score;
                            bestMode = mode.toUpperCase();
                        }
                    }
                });

                html += `<td><strong>${bestMode}</strong></td>`;
                html += `</tr>`;
            });

            tbody.innerHTML = html || '<tr><td colspan="5" style="text-align: center; color: #666;">í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ë©´ ë¹„êµ ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.</td></tr>';
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function () {
            console.log('ğŸš€ OpenManager Vibe v5 - 3ê°€ì§€ ëª¨ë“œ í…ŒìŠ¤íŠ¸ ì‹œìŠ¤í…œ ì¤€ë¹„ ì™„ë£Œ');
        });
    </script>
</body>

</html>