<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🚀 OpenManager Vibe v5 - 3가지 모드 테스트</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        h1 {
            text-align: center;
            color: #2d3748;
            margin-bottom: 30px;
            font-size: 2.5em;
        }

        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .test-card {
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 25px;
            background: #f8fafc;
        }

        .test-card h2 {
            color: #2b6cb0;
            margin-top: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .test-questions {
            margin: 20px 0;
        }

        .question-btn {
            display: block;
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            background: #4299e1;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .question-btn:hover {
            background: #3182ce;
            transform: translateY(-2px);
        }

        .result-area {
            margin-top: 20px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #4299e1;
            min-height: 200px;
            font-size: 13px;
            overflow-y: auto;
            max-height: 400px;
        }

        .loading {
            color: #666;
            font-style: italic;
        }

        .success {
            color: #38a169;
        }

        .error {
            color: #e53e3e;
        }

        .comparison-section {
            margin-top: 40px;
            padding: 30px;
            background: #edf2f7;
            border-radius: 12px;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #cbd5e0;
        }

        .comparison-table th {
            background: #4a5568;
            color: white;
        }

        .mode-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }

        .badge-rag {
            background: #c6f6d5;
            color: #22543d;
        }

        .badge-pattern {
            background: #fed7d7;
            color: #742a2a;
        }

        .badge-mcp {
            background: #bee3f8;
            color: #2a4365;
        }

        .stats-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #4299e1;
        }

        .debug-info {
            background: #1a202c;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            overflow-x: auto;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>🚀 OpenManager Vibe v5 - 3가지 모드 비교 테스트</h1>

        <div class="test-grid">
            <!-- RAG Engine 모드 -->
            <div class="test-card">
                <h2>🤖 <span class="mode-badge badge-rag">RAG Engine</span></h2>
                <p><strong>벡터 검색 + 명령어 데이터베이스</strong><br>
                    가장 정확한 명령어 기반 응답을 제공합니다.</p>

                <div class="test-questions">
                    <button class="question-btn" onclick="testRAG('CPU 사용률이 95%일 때 어떻게 해야 하나요?')">
                        🐧 Linux CPU 95% 문제
                    </button>
                    <button class="question-btn" onclick="testRAG('Kubernetes Pod가 CrashLoopBackOff 상태입니다')">
                        ☸️ K8s Pod CrashLoopBackOff
                    </button>
                    <button class="question-btn" onclick="testRAG('MySQL 데이터베이스 연결이 실패합니다')">
                        🐘 MySQL 연결 실패
                    </button>
                    <button class="question-btn" onclick="testRAG('리눅스 top 명령어 사용법')">
                        📊 Linux top 명령어
                    </button>
                </div>

                <div class="result-area" id="rag-result">
                    RAG Engine 테스트 결과가 여기에 표시됩니다...
                </div>
            </div>

            <!-- 패턴 매칭 모드 -->
            <div class="test-card">
                <h2>🔍 <span class="mode-badge badge-pattern">Pattern Matching</span></h2>
                <p><strong>키워드 패턴 기반 매칭</strong><br>
                    빠른 응답이지만 제한적인 정확도를 제공합니다.</p>

                <div class="test-questions">
                    <button class="question-btn" onclick="testPattern('CPU 사용률이 95%일 때 어떻게 해야 하나요?')">
                        🐧 Linux CPU 95% 문제
                    </button>
                    <button class="question-btn" onclick="testPattern('Kubernetes Pod가 CrashLoopBackOff 상태입니다')">
                        ☸️ K8s Pod CrashLoopBackOff
                    </button>
                    <button class="question-btn" onclick="testPattern('MySQL 데이터베이스 연결이 실패합니다')">
                        🐘 MySQL 연결 실패
                    </button>
                    <button class="question-btn" onclick="testPattern('리눅스 top 명령어 사용법')">
                        📊 Linux top 명령어
                    </button>
                </div>

                <div class="result-area" id="pattern-result">
                    패턴 매칭 테스트 결과가 여기에 표시됩니다...
                </div>
            </div>

            <!-- MCP 컨텍스트 모드 -->
            <div class="test-card">
                <h2>🧠 <span class="mode-badge badge-mcp">MCP Context</span></h2>
                <p><strong>컨텍스트 파일 기반 AI 응답</strong><br>
                    상황별 맞춤 가이드를 제공합니다.</p>

                <div class="test-questions">
                    <button class="question-btn" onclick="testMCP('CPU 사용률이 95%일 때 어떻게 해야 하나요?')">
                        🐧 Linux CPU 95% 문제
                    </button>
                    <button class="question-btn" onclick="testMCP('Kubernetes Pod가 CrashLoopBackOff 상태입니다')">
                        ☸️ K8s Pod CrashLoopBackOff
                    </button>
                    <button class="question-btn" onclick="testMCP('MySQL 데이터베이스 연결이 실패합니다')">
                        🐘 MySQL 연결 실패
                    </button>
                    <button class="question-btn" onclick="testMCP('리눅스 top 명령어 사용법')">
                        📊 Linux top 명령어
                    </button>
                </div>

                <div class="result-area" id="mcp-result">
                    MCP 컨텍스트 테스트 결과가 여기에 표시됩니다...
                </div>
            </div>
        </div>

        <!-- 비교 분석 섹션 -->
        <div class="comparison-section">
            <h2>📊 3가지 모드 비교 분석</h2>
            <table class="comparison-table" id="comparison-table">
                <thead>
                    <tr>
                        <th>질문</th>
                        <th>RAG Engine</th>
                        <th>Pattern Matching</th>
                        <th>MCP Context</th>
                        <th>최고 성능</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td colspan="5" style="text-align: center; color: #666;">
                            테스트를 실행하면 비교 결과가 표시됩니다.
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- 통계 섹션 -->
        <div class="stats-section">
            <div class="stat-card">
                <div class="stat-number" id="total-tests">0</div>
                <div>총 테스트 수행</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="avg-response-time">0ms</div>
                <div>평균 응답 시간</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="success-rate">0%</div>
                <div>성공률</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="best-mode">-</div>
                <div>최고 성능 모드</div>
            </div>
        </div>
    </div>

    <script>
        let testResults = {};
        let totalTests = 0;
        let successfulTests = 0;
        let totalResponseTime = 0;

        // RAG Engine 테스트
        async function testRAG(question) {
            const resultDiv = document.getElementById('rag-result');
            resultDiv.innerHTML = '<div class="loading">🔍 RAG Engine 검색 중...</div>';

            const startTime = Date.now();
            try {
                const response = await fetch('/api/analyze', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        query: question,
                        type: 'troubleshooting',
                        mode: 'rag' // 강제 RAG 모드
                    })
                });

                const data = await response.json();
                const responseTime = Date.now() - startTime;

                if (data.success) {
                    displayResult('rag-result', data, responseTime, 'success');
                    recordTestResult(question, 'rag', data, responseTime, true);
                } else {
                    displayResult('rag-result', data, responseTime, 'error');
                    recordTestResult(question, 'rag', data, responseTime, false);
                }
            } catch (error) {
                displayResult('rag-result', { error: error.message }, Date.now() - startTime, 'error');
                recordTestResult(question, 'rag', { error: error.message }, Date.now() - startTime, false);
            }
        }

        // 패턴 매칭 테스트
        async function testPattern(question) {
            const resultDiv = document.getElementById('pattern-result');
            resultDiv.innerHTML = '<div class="loading">🔍 패턴 매칭 분석 중...</div>';

            const startTime = Date.now();
            try {
                const response = await fetch('/api/analyze', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        query: question,
                        type: 'troubleshooting',
                        mode: 'pattern' // 패턴 매칭 모드
                    })
                });

                const data = await response.json();
                const responseTime = Date.now() - startTime;

                displayResult('pattern-result', data, responseTime, data.success ? 'success' : 'error');
                recordTestResult(question, 'pattern', data, responseTime, data.success);
            } catch (error) {
                displayResult('pattern-result', { error: error.message }, Date.now() - startTime, 'error');
                recordTestResult(question, 'pattern', { error: error.message }, Date.now() - startTime, false);
            }
        }

        // MCP 컨텍스트 테스트
        async function testMCP(question) {
            const resultDiv = document.getElementById('mcp-result');
            resultDiv.innerHTML = '<div class="loading">🧠 MCP 컨텍스트 분석 중...</div>';

            const startTime = Date.now();
            try {
                const response = await fetch('/api/ai/unified', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        question: question,
                        context: 'system-troubleshooting'
                    })
                });

                const data = await response.json();
                const responseTime = Date.now() - startTime;

                displayResult('mcp-result', data, responseTime, data.success ? 'success' : 'error');
                recordTestResult(question, 'mcp', data, responseTime, data.success);
            } catch (error) {
                displayResult('mcp-result', { error: error.message }, Date.now() - startTime, 'error');
                recordTestResult(question, 'mcp', { error: error.message }, Date.now() - startTime, false);
            }
        }

        // 결과 표시
        function displayResult(elementId, data, responseTime, status) {
            const resultDiv = document.getElementById(elementId);

            let html = `<div class="${status}">`;
            html += `<strong>응답 시간:</strong> ${responseTime}ms<br>`;
            html += `<strong>상태:</strong> ${status === 'success' ? '✅ 성공' : '❌ 실패'}<br><br>`;

            if (data.data) {
                html += `<strong>타입:</strong> ${data.data.type || 'N/A'}<br>`;
                html += `<strong>요약:</strong> ${data.data.summary || 'N/A'}<br>`;
                html += `<strong>신뢰도:</strong> ${data.data.confidence || 'N/A'}<br>`;

                if (data.data.commands && data.data.commands.length > 0) {
                    html += `<strong>명령어:</strong><br>`;
                    data.data.commands.forEach(cmd => {
                        html += `• <code>${cmd}</code><br>`;
                    });
                }

                if (data.data.debug_info) {
                    html += `<div class="debug-info">`;
                    html += `<strong>디버그 정보:</strong><br>`;
                    html += `${JSON.stringify(data.data.debug_info, null, 2)}`;
                    html += `</div>`;
                }
            } else if (data.error) {
                html += `<strong>오류:</strong> ${data.error}`;
            } else {
                html += `<strong>응답:</strong> ${JSON.stringify(data, null, 2)}`;
            }

            html += `</div>`;
            resultDiv.innerHTML = html;
        }

        // 테스트 결과 기록
        function recordTestResult(question, mode, data, responseTime, success) {
            if (!testResults[question]) {
                testResults[question] = {};
            }

            testResults[question][mode] = {
                data: data,
                responseTime: responseTime,
                success: success,
                timestamp: new Date().toISOString()
            };

            totalTests++;
            if (success) successfulTests++;
            totalResponseTime += responseTime;

            updateStats();
            updateComparisonTable();
        }

        // 통계 업데이트
        function updateStats() {
            document.getElementById('total-tests').textContent = totalTests;
            document.getElementById('avg-response-time').textContent =
                totalTests > 0 ? Math.round(totalResponseTime / totalTests) + 'ms' : '0ms';
            document.getElementById('success-rate').textContent =
                totalTests > 0 ? Math.round((successfulTests / totalTests) * 100) + '%' : '0%';

            // 최고 성능 모드 계산
            const modeStats = { rag: 0, pattern: 0, mcp: 0 };
            Object.values(testResults).forEach(questionResults => {
                Object.keys(questionResults).forEach(mode => {
                    if (questionResults[mode].success) {
                        modeStats[mode]++;
                    }
                });
            });

            const bestMode = Object.keys(modeStats).reduce((a, b) =>
                modeStats[a] > modeStats[b] ? a : b
            );

            const modeNames = { rag: 'RAG', pattern: 'Pattern', mcp: 'MCP' };
            document.getElementById('best-mode').textContent = modeNames[bestMode] || '-';
        }

        // 비교 테이블 업데이트
        function updateComparisonTable() {
            const tbody = document.querySelector('#comparison-table tbody');
            let html = '';

            Object.keys(testResults).forEach(question => {
                const results = testResults[question];
                html += `<tr>`;
                html += `<td>${question.substring(0, 30)}...</td>`;

                ['rag', 'pattern', 'mcp'].forEach(mode => {
                    if (results[mode]) {
                        const result = results[mode];
                        const statusIcon = result.success ? '✅' : '❌';
                        const confidence = result.data.data?.confidence || 'N/A';
                        html += `<td>${statusIcon} ${result.responseTime}ms<br><small>신뢰도: ${confidence}</small></td>`;
                    } else {
                        html += `<td>-</td>`;
                    }
                });

                // 최고 성능 계산
                let bestMode = '-';
                let bestScore = -1;
                Object.keys(results).forEach(mode => {
                    if (results[mode].success) {
                        const score = (results[mode].data.data?.confidence || 0) * 100 - results[mode].responseTime / 10;
                        if (score > bestScore) {
                            bestScore = score;
                            bestMode = mode.toUpperCase();
                        }
                    }
                });

                html += `<td><strong>${bestMode}</strong></td>`;
                html += `</tr>`;
            });

            tbody.innerHTML = html || '<tr><td colspan="5" style="text-align: center; color: #666;">테스트를 실행하면 비교 결과가 표시됩니다.</td></tr>';
        }

        // 페이지 로드 시 초기화
        document.addEventListener('DOMContentLoaded', function () {
            console.log('🚀 OpenManager Vibe v5 - 3가지 모드 테스트 시스템 준비 완료');
        });
    </script>
</body>

</html>