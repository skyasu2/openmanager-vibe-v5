#!/usr/bin/env node

/**
 * ğŸš€ g - Gemini ê°œë°œ ë„êµ¬ ë¹ ë¥¸ ì‹¤í–‰ê¸°
 * 
 * ì‚¬ìš©ë²•:
 *   ./tools/g "ì§ˆë¬¸ë‚´ìš©"                     # ë¹ ë¥¸ ì±„íŒ…
 *   ./tools/g file src/app/page.tsx          # íŒŒì¼ ë¶„ì„
 *   ./tools/g diff                           # Git diff ë¦¬ë·°
 *   ./tools/g stats                          # ì‚¬ìš©ëŸ‰ í™•ì¸
 *   ./tools/g health                         # í—¬ìŠ¤ì²´í¬
 */

import GeminiDevTools from './gemini-dev-tools.js';

const tool = new GeminiDevTools();
const args = process.argv.slice(2);

if (args.length === 0) {
  console.log(`
ğŸš€ g - Gemini ê°œë°œ ë„êµ¬ ë¹ ë¥¸ ì‹¤í–‰ê¸°

ì‚¬ìš©ë²•:
  ./tools/g "ì§ˆë¬¸ë‚´ìš©"              ë¹ ë¥¸ ì±„íŒ…
  ./tools/g file <íŒŒì¼ê²½ë¡œ>         íŒŒì¼ ë¶„ì„
  ./tools/g diff                    Git diff ë¦¬ë·°
  ./tools/g stats                   ì‚¬ìš©ëŸ‰ í™•ì¸
  ./tools/g health                  í—¬ìŠ¤ì²´í¬
  ./tools/g clear                   ì»¨í…ìŠ¤íŠ¸ ì´ˆê¸°í™”
  ./tools/g compress                ëŒ€í™” ì••ì¶•

ì˜ˆì‹œ:
  ./tools/g "TypeScript ì—ëŸ¬ í•´ê²°ë²•"
  ./tools/g file src/app/page.tsx
  ./tools/g diff "SOLID ì›ì¹™ ê´€ì ì—ì„œ"
  `);
  process.exit(0);
}

const command = args[0];

async function run() {
  try {
    switch (command) {
      case 'file':
        if (args.length < 2) {
          console.error('âŒ íŒŒì¼ ê²½ë¡œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
          process.exit(1);
        }
        const filePath = args[1];
        const question = args.slice(2).join(' ') || "ì´ íŒŒì¼ì„ ë¶„ì„í•´ì£¼ì„¸ìš”";
        const result = await tool.analyzeFile(filePath, question);
        console.log(result);
        break;
        
      case 'diff':
        const diffMessage = args.slice(1).join(' ') || "ë³€ê²½ì‚¬í•­ì„ ë¦¬ë·°í•´ì£¼ì„¸ìš”";
        const diffResult = await tool.analyzeGitDiff(diffMessage);
        console.log(diffResult);
        break;
        
      case 'stats':
        const stats = await tool.getStats();
        console.log(stats);
        break;
        
      case 'health':
        const health = await tool.healthCheck();
        console.log(JSON.stringify(health, null, 2));
        break;
        
      case 'clear':
        const clearResult = await tool.clearContext();
        console.log(clearResult);
        break;
        
      case 'compress':
        const compressResult = await tool.compressContext();
        console.log(compressResult);
        break;
        
      default:
        // ê¸°ë³¸ì ìœ¼ë¡œ ì±„íŒ…ìœ¼ë¡œ ì²˜ë¦¬
        const chatResult = await tool.quickChat(args.join(' '));
        console.log(chatResult);
    }
  } catch (error) {
    console.error('âŒ ì˜¤ë¥˜:', error.message);
    process.exit(1);
  }
}

run();