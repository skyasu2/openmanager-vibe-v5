<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🎯 서버별 실무 가이드 시스템 v2.0</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }

        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            border-radius: 10px;
            color: white;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        select,
        input,
        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        select:focus,
        input:focus,
        textarea:focus {
            outline: none;
            border-color: #4facfe;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin: 20px 0;
        }

        button {
            flex: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .result-container {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 5px solid #4facfe;
        }

        .guide-section {
            margin-bottom: 25px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .guide-section h3 {
            margin-top: 0;
            color: #667eea;
            border-bottom: 2px solid #e1e5e9;
            padding-bottom: 10px;
        }

        .command-item {
            background: #f1f3f4;
            padding: 10px;
            margin: 8px 0;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            border-left: 3px solid #4facfe;
        }

        .command-description {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
            font-family: 'Segoe UI', sans-serif;
        }

        .troubleshooting-item {
            background: #fff3cd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #ffc107;
        }

        .monitoring-metric {
            display: inline-block;
            background: #d4edda;
            padding: 5px 10px;
            margin: 3px;
            border-radius: 15px;
            font-size: 14px;
            border: 1px solid #c3e6cb;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #dc3545;
        }

        .server-type-badge {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 14px;
            margin-bottom: 15px;
        }

        .example-queries {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .example-query {
            background: white;
            padding: 8px 12px;
            margin: 5px 0;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .example-query:hover {
            background: #bbdefb;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-success {
            background: #28a745;
        }

        .status-warning {
            background: #ffc107;
        }

        .status-error {
            background: #dc3545;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>🎯 서버별 실무 가이드 시스템 v2.0</h1>
            <p>OpenManager Vibe v5 - 룰기반 AI 엔진 + 실무 가이드 통합</p>
            <div id="systemStatus"></div>
        </div>

        <div class="form-group">
            <label for="serverType">🖥️ 서버 타입 선택:</label>
            <select id="serverType">
                <option value="">서버 타입을 선택하세요</option>
                <option value="web">🌐 웹서버 (Apache/Nginx)</option>
                <option value="database">🗄️ 데이터베이스 (MySQL/PostgreSQL)</option>
                <option value="cache">⚡ 캐시 서버 (Redis/Memcached)</option>
                <option value="api">🔗 API 서버 (Node.js/Python)</option>
                <option value="container">🐳 컨테이너 (Docker/Kubernetes)</option>
                <option value="queue">📬 큐 서버 (RabbitMQ/Kafka)</option>
                <option value="cdn">🌍 CDN 서버</option>
                <option value="storage">💾 스토리지 서버</option>
            </select>
        </div>

        <div class="form-group">
            <label for="query">💬 질문 입력:</label>
            <textarea id="query" rows="3"
                placeholder="예: 웹서버 재시작하는 방법, MySQL 느려졌어 어떻게 확인해?, Redis 메모리 사용량 확인하고 싶어"></textarea>
        </div>

        <div class="example-queries">
            <h4>📋 예제 질문들:</h4>
            <div class="example-query" onclick="setExample('web', '웹서버 재시작하는 방법')">🌐 웹서버 재시작하는 방법</div>
            <div class="example-query" onclick="setExample('database', 'MySQL 느려졌어, 어떻게 확인해?')">🗄️ MySQL 느려졌어, 어떻게 확인해?
            </div>
            <div class="example-query" onclick="setExample('cache', 'Redis 메모리 사용량 확인하고 싶어')">⚡ Redis 메모리 사용량 확인하고 싶어
            </div>
            <div class="example-query" onclick="setExample('api', 'API 서버 응답이 느려')">🔗 API 서버 응답이 느려</div>
            <div class="example-query" onclick="setExample('container', '도커 컨테이너 시작 안돼')">🐳 도커 컨테이너 시작 안돼</div>
        </div>

        <div class="button-group">
            <button class="btn-primary" onclick="testPracticalGuide()">🎯 실무 가이드 조회</button>
            <button class="btn-secondary" onclick="testNaturalLanguage()">🧠 자연어 처리 테스트</button>
            <button class="btn-secondary" onclick="checkSystemStatus()">🔍 시스템 상태 확인</button>
        </div>

        <div id="result" class="result-container" style="display: none;"></div>
    </div>

    <script>
        // 페이지 로드 시 시스템 상태 확인
        window.onload = function () {
            checkSystemStatus();
        };

        function setExample(serverType, query) {
            document.getElementById('serverType').value = serverType;
            document.getElementById('query').value = query;
        }

        async function checkSystemStatus() {
            const statusDiv = document.getElementById('systemStatus');
            statusDiv.innerHTML = '<span class="status-indicator status-warning"></span>시스템 상태 확인 중...';

            try {
                const response = await fetch('/api/ai/rule-based');
                const data = await response.json();

                if (data.success) {
                    const status = data.data.status;
                    const practicalGuide = data.data.practicalGuideSystem;

                    let statusHtml = `<span class="status-indicator status-success"></span>시스템 정상 (${status})`;

                    if (practicalGuide && practicalGuide.enabled) {
                        statusHtml += ` | 실무 가이드 활성화 (${practicalGuide.supportedServerTypes.length}개 서버 타입)`;
                    }

                    statusDiv.innerHTML = statusHtml;
                } else {
                    statusDiv.innerHTML = '<span class="status-indicator status-error"></span>시스템 오류';
                }
            } catch (error) {
                statusDiv.innerHTML = '<span class="status-indicator status-error"></span>연결 실패';
            }
        }

        async function testPracticalGuide() {
            const serverType = document.getElementById('serverType').value;
            const query = document.getElementById('query').value;
            const resultDiv = document.getElementById('result');

            if (!serverType) {
                alert('서버 타입을 선택해주세요!');
                return;
            }

            if (!query.trim()) {
                alert('질문을 입력해주세요!');
                return;
            }

            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<div class="loading">🔍 실무 가이드를 조회하고 있습니다...</div>';

            try {
                const response = await fetch(`/api/ai/rule-based?practical=true&serverType=${encodeURIComponent(serverType)}&query=${encodeURIComponent(query)}`);
                const data = await response.json();

                console.log('실무 가이드 응답:', data); // 디버깅용

                if (data.success) {
                    displayPracticalGuide(data.data);
                } else {
                    resultDiv.innerHTML = `<div class="error">❌ 오류: ${data.error || data.details || '알 수 없는 오류'}</div>`;
                }
            } catch (error) {
                console.error('실무 가이드 조회 오류:', error);
                resultDiv.innerHTML = `<div class="error">❌ 네트워크 오류: ${error.message}</div>`;
            }
        }

        async function testNaturalLanguage() {
            const query = document.getElementById('query').value;
            const resultDiv = document.getElementById('result');

            if (!query.trim()) {
                alert('질문을 입력해주세요!');
                return;
            }

            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<div class="loading">🧠 자연어 처리 중...</div>';

            try {
                const response = await fetch('/api/ai/rule-based', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        query: query,
                        options: {
                            language: 'ko',
                            priority: 'balance'
                        }
                    })
                });

                const data = await response.json();
                console.log('자연어 처리 응답:', data); // 디버깅용

                if (data.success) {
                    displayNaturalLanguageResult(data.data);
                } else {
                    resultDiv.innerHTML = `<div class="error">❌ 오류: ${data.error}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">❌ 네트워크 오류: ${error.message}</div>`;
            }
        }

        function displayPracticalGuide(data) {
            const { serverType, query, practicalGuide, supportedServerTypes } = data;
            let html = `
                <div class="server-type-badge">🖥️ ${serverType.toUpperCase()} 서버</div>
                <h2>💡 "${query}" - 실무 가이드</h2>
            `;

            if (practicalGuide) {
                // 명령어 가이드
                if (practicalGuide.commands) {
                    html += `
                        <div class="guide-section">
                            <h3>🔧 주요 명령어</h3>
                    `;
                    Object.entries(practicalGuide.commands).forEach(([key, cmd]) => {
                        html += `
                            <div class="command-item">
                                <strong>${key}:</strong> ${cmd.command}
                                <div class="command-description">${cmd.description}</div>
                                ${cmd.example ? `<div class="command-description">예제: ${cmd.example}</div>` : ''}
                                ${cmd.caution ? `<div class="command-description">⚠️ ${cmd.caution}</div>` : ''}
                            </div>
                        `;
                    });
                    html += `</div>`;
                }

                // 트러블슈팅 가이드
                if (practicalGuide.troubleshooting && practicalGuide.troubleshooting.length > 0) {
                    html += `
                        <div class="guide-section">
                            <h3>🚨 트러블슈팅 가이드</h3>
                    `;
                    practicalGuide.troubleshooting.forEach(item => {
                        html += `
                            <div class="troubleshooting-item">
                                <h4>증상: ${item.symptom}</h4>
                                <p><strong>진단 방법:</strong></p>
                                <ul>
                                    ${item.diagnosis.map(d => `<li>${d}</li>`).join('')}
                                </ul>
                                <p><strong>해결 방안:</strong></p>
                                <ul>
                                    ${item.solution.map(s => `<li>${s}</li>`).join('')}
                                </ul>
                                ${item.prevention ? `<p><strong>예방책:</strong> ${item.prevention}</p>` : ''}
                            </div>
                        `;
                    });
                    html += `</div>`;
                }

                // 모니터링 가이드
                if (practicalGuide.monitoring) {
                    html += `
                        <div class="guide-section">
                            <h3>📊 모니터링 가이드</h3>
                            <p><strong>핵심 메트릭:</strong></p>
                            <div>
                                ${practicalGuide.monitoring.key_metrics.map(metric =>
                        `<span class="monitoring-metric">${metric}</span>`
                    ).join('')}
                            </div>
                            <p><strong>로그 위치:</strong></p>
                            <ul>
                                ${practicalGuide.monitoring.log_locations.map(log => `<li>${log}</li>`).join('')}
                            </ul>
                            <p><strong>성능 지표:</strong></p>
                            <ul>
                                ${practicalGuide.monitoring.performance_indicators.map(indicator => `<li>${indicator}</li>`).join('')}
                            </ul>
                        </div>
                    `;
                }
            } else {
                html += `
                    <div class="guide-section">
                        <h3>📋 지원되는 서버 타입</h3>
                        <p>현재 다음 서버 타입들에 대한 실무 가이드를 제공합니다:</p>
                        <div>
                            ${supportedServerTypes.map(type =>
                    `<span class="monitoring-metric">${type}</span>`
                ).join('')}
                        </div>
                    </div>
                `;
            }

            document.getElementById('result').innerHTML = html;
        }

        function displayNaturalLanguageResult(data) {
            const { query, intent, confidence, response, serverType, practicalGuide, processingTime, engineBreakdown } = data;

            let html = `
                <h2>🧠 자연어 처리 결과</h2>
                <div class="guide-section">
                    <h3>📝 처리 결과</h3>
                    <p><strong>질문:</strong> ${query}</p>
                    <p><strong>의도:</strong> ${intent}</p>
                    <p><strong>신뢰도:</strong> ${Math.round(confidence * 100)}%</p>
                    <p><strong>응답:</strong> ${response}</p>
                    <p><strong>처리 시간:</strong> ${processingTime}ms</p>
                    ${serverType ? `<p><strong>감지된 서버 타입:</strong> <span class="server-type-badge">${serverType}</span></p>` : ''}
                </div>
            `;

            if (engineBreakdown) {
                html += `
                    <div class="guide-section">
                        <h3>⚙️ 엔진별 기여도</h3>
                        <div>
                            ${Object.entries(engineBreakdown).map(([engine, score]) =>
                    `<span class="monitoring-metric">${engine}: ${Math.round(score * 100)}%</span>`
                ).join('')}
                        </div>
                    </div>
                `;
            }

            if (practicalGuide) {
                html += `
                    <div class="guide-section">
                        <h3>🎯 실무 가이드 제안</h3>
                        ${practicalGuide.quickCommands ? `
                            <p><strong>빠른 명령어:</strong></p>
                            <ul>
                                ${practicalGuide.quickCommands.map(cmd => `<li><code>${cmd}</code></li>`).join('')}
                            </ul>
                        ` : ''}
                        ${practicalGuide.troubleshootingTips ? `
                            <p><strong>트러블슈팅 팁:</strong></p>
                            <ul>
                                ${practicalGuide.troubleshootingTips.map(tip => `<li>${tip}</li>`).join('')}
                            </ul>
                        ` : ''}
                        ${practicalGuide.monitoringMetrics ? `
                            <p><strong>모니터링 메트릭:</strong></p>
                            <div>
                                ${practicalGuide.monitoringMetrics.map(metric =>
                    `<span class="monitoring-metric">${metric}</span>`
                ).join('')}
                            </div>
                        ` : ''}
                    </div>
                `;
            }

            document.getElementById('result').innerHTML = html;
        }
    </script>
</body>

</html>