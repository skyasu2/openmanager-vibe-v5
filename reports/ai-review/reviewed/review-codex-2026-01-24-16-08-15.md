# ğŸš€ AI ìë™ ì½”ë“œ ë¦¬ë·° ë¦¬í¬íŠ¸ (Engine: CODEX)

**ë‚ ì§œ**: 2026-01-24 16-08-15
**ì»¤ë°‹**: `3d15b9019`
**ë¸Œëœì¹˜**: `main`
**AI ì—”ì§„**: **CODEX**

---

## ğŸ” ì‹¤ì‹œê°„ ê²€ì¦ ê²°ê³¼ (2026-01-24 16:08:15)

```
ESLint: ìë™ ê²€ì¦ (pre-push)
TypeScript: ìë™ ê²€ì¦ (pre-push)
```

**ê²€ì¦ ë¡œê·¸ íŒŒì¼**:
- ESLint: `logs/validation/`
- TypeScript: `logs/validation/`

---

## ğŸ“Š ë³€ê²½ì‚¬í•­ ìš”ì•½

**ì»¤ë°‹**: `3d15b9019b493ece418bbdd2c81e229e0f517aa5`
**ë©”ì‹œì§€**: refactor(ai-engine): AI SDK v6 best practices and dead code cleanup

## ğŸ—‘ï¸ cloud-run/ai-engine/src/data/scenarios.ts (ì‚­ì œë¨)

## ğŸ“„ cloud-run/ai-engine/src/routes/analytics.ts

```diff
diff --git a/cloud-run/ai-engine/src/routes/analytics.ts b/cloud-run/ai-engine/src/routes/analytics.ts
index cd3d7ca56..27f92206e 100644
--- a/cloud-run/ai-engine/src/routes/analytics.ts
+++ b/cloud-run/ai-engine/src/routes/analytics.ts
@@ -26,10 +26,7 @@ import { handleApiError, jsonSuccess } from '../lib/error-handler';
 import { sanitizeChineseCharacters, sanitizeJsonStrings } from '../lib/text-sanitizer';
 import { getReporterAgentConfig, isReporterAgentAvailable } from '../services/ai-sdk/agents/reporter-agent';
 import { getAnalystAgentConfig, isAnalystAgentAvailable } from '../services/ai-sdk/agents/analyst-agent';
-import {
-  syncIncidentsToRAG,
-  getRAGInjectionStats,
-} from '../lib/incident-rag-injector';
+// incident-rag-injector imports removed - endpoints deprecated
 
 export const analyticsRouter = new Hono();
 
@@ -603,127 +600,6 @@ async function incidentReportFallback(
   });
 }
 
-// Batch processing constants
-const BATCH_LIMITS = {
-  MAX_SERVERS: 50,
-  DEFAULT_CHUNK_SIZE: 10,
-} as const;
-
-/**
- * POST /analyze-batch - Batch Server Analysis
- *
- * Uses Precomputed State for O(1) lookup
- * Analyzes multiple servers in parallel with chunking for memory efficiency
- *
- * @limit Max 50 servers per request
- */
-analyticsRouter.post('/analyze-batch', async (c: Context) => {
-  try {
-    const body = await c.req.json().catch(() => ({}));
-    const serverIds: string[] = Array.isArray(body.serverIds) ? body.serverIds : [];
-    const analysisType = body.analysisType || 'anomaly';
-
-    // Input validation
-    if (serverIds.length > BATCH_LIMITS.MAX_SERVERS) {
-      return c.json({
-        success: false,
-        error: `Too many servers requested. Maximum: ${BATCH_LIMITS.MAX_SERVERS}`,
-      }, 400);
-    }
-
-    console.log(`ğŸ”¬ [Batch Analysis] servers=${serverIds.length}, type=${analysisType}`);
-
-    // Get servers from precomputed state (O(1))
-    const state = getCurrentState();
-    const targetServers = serverIds.length > 0
-      ? state.servers.filter((s) => serverIds.includes(s.id)).slice(0, BATCH_LIMITS.MAX_SERVERS)
-      : state.servers.slice(0, BATCH_LIMITS.MAX_SERVERS);
-
-    const results = await Promise.all(
-      targetServers.map(async (server) => {
-        const anomalyResult = await detectAnomalies.execute!({
-          serverId: server.id,
-          metricType: 'all',
-        }, { toolCallId: `batch-${server.id}`, messages: [] });
-
-        return {
-          serverId: server.id,
-          serverName: server.name,
-          ...anomalyResult,
-        };
-      })
-    );
-
-    return jsonSuccess(c, {
-      totalServers: results.length,
-      analysisType,
-      results,
-      _dataSource: 'precomputed-state',
-    });
-  } catch (error) {
-    return handleApiError(c, error, 'Batch Analysis');
-  }
-});
-
-/**
- * POST /rag/sync-incidents - Sync Incidents to RAG Knowledge Base
- *
- * Injects approved incident reports into knowledge_base for RAG search.
- * Should be called periodically or after batch approvals.
- *
- * @version 1.0.0 - RAG injection
- */
-analyticsRouter.post('/rag/sync-incidents', async (c: Context) => {
-  try {
-    const { limit = 10, daysBack = 30 } = await c.req.json().catch(() => ({}));
+// analyze-batch endpoint removed - not used by frontend
 
-    console.log(`ğŸ“¥ [RAG Sync] Starting incident sync (limit=${limit}, days=${daysBack})`);
-
-    const result = await syncIncidentsToRAG({ limit, daysBack });
-
-    if (!result.success && result.synced === 0) {
```

## ğŸ“„ cloud-run/ai-engine/src/routes/approval.ts

```diff
diff --git a/cloud-run/ai-engine/src/routes/approval.ts b/cloud-run/ai-engine/src/routes/approval.ts
index c5e20dedd..c5d9c2b68 100644
--- a/cloud-run/ai-engine/src/routes/approval.ts
+++ b/cloud-run/ai-engine/src/routes/approval.ts
@@ -1,101 +1,23 @@
 /**
  * Approval Routes
  *
- * Human-in-the-Loop approval endpoints.
+ * Approval history endpoints for RAG context injection.
  *
- * @version 1.1.0
+ * @version 2.0.0
  * @created 2025-12-28
- * @updated 2026-01-01
+ * @updated 2026-01-24
  *
- * @deprecated HITL workflow removed in v4.1 (user-triggered design)
- * - `/status`, `/decide`, `/stats` endpoints are deprecated (no longer called from frontend)
- * - `/history`, `/history/stats` endpoints kept for RAG context injection
- *   (used by incident-rag-injector.ts for approval_history table queries)
+ * Note: HITL workflow removed in v4.1.
+ * Only `/history` and `/history/stats` endpoints remain for RAG use.
  */
 
 import { Hono } from 'hono';
 import type { Context } from 'hono';
 import { approvalStore } from '../services/approval/approval-store';
-import { handleApiError, handleValidationError, handleNotFoundError, jsonSuccess } from '../lib/error-handler';
+import { handleApiError, jsonSuccess } from '../lib/error-handler';
 
 export const approvalRouter = new Hono();
 
-/**
- * GET /approval/status - Check pending approval status
- */
-approvalRouter.get('/status', async (c: Context) => {
-  try {
-    const sessionId = c.req.query('sessionId');
-
-    if (!sessionId) {
-      return handleValidationError(c, 'sessionId is required');
-    }
-
-    const pending = await approvalStore.getPending(sessionId);
-
-    if (!pending) {
-      return jsonSuccess(c, {
-        hasPending: false,
-        action: null,
-        sessionId,
-      });
-    }
-
-    return jsonSuccess(c, {
-      hasPending: true,
-      action: {
-        type: pending.actionType,
-        description: pending.description,
-        details: pending.payload,
-        requestedAt: pending.requestedAt.toISOString(),
-        requestedBy: pending.requestedBy,
-        expiresAt: pending.expiresAt.toISOString(),
-      },
-      sessionId,
-    });
-  } catch (error) {
-    return handleApiError(c, error, 'Approval Status');
-  }
-});
-
-/**
- * POST /approval/decide - Submit approval decision
- */
-approvalRouter.post('/decide', async (c: Context) => {
-  try {
-    const { sessionId, approved, reason, approvedBy } = await c.req.json();
-
-    if (!sessionId || typeof approved !== 'boolean') {
-      return handleValidationError(c, 'sessionId and approved are required');
-    }
-
-    const success = await approvalStore.submitDecision(sessionId, approved, {
-      reason,
-      decidedBy: approvedBy,
-    });
-
-    if (!success) {
-      return handleNotFoundError(c, 'Pending approval for this session');
-    }
-
-    return jsonSuccess(c, {
-      sessionId,
-      decision: approved ? 'approved' : 'rejected',
-      decidedAt: new Date().toISOString(),
-    });
-  } catch (error) {
-    return handleApiError(c, error, 'Approval Decision');
-  }
-});
```

## ğŸ“„ cloud-run/ai-engine/src/routes/supervisor.ts

```diff
diff --git a/cloud-run/ai-engine/src/routes/supervisor.ts b/cloud-run/ai-engine/src/routes/supervisor.ts
index 740037038..f4861a7fe 100644
--- a/cloud-run/ai-engine/src/routes/supervisor.ts
+++ b/cloud-run/ai-engine/src/routes/supervisor.ts
@@ -12,7 +12,13 @@ import { Hono } from 'hono';
 import type { Context } from 'hono';
 import { streamSSE } from 'hono/streaming';
 import { z } from 'zod';
-import { executeSupervisor, executeSupervisorStream, checkSupervisorHealth, logProviderStatus } from '../services/ai-sdk';
+import {
+  executeSupervisor,
+  executeSupervisorStream,
+  checkSupervisorHealth,
+  logProviderStatus,
+  createSupervisorStreamResponse,
+} from '../services/ai-sdk';
 import { handleApiError, handleValidationError, jsonSuccess } from '../lib/error-handler';
 import { sanitizeChineseCharacters } from '../lib/text-sanitizer';
 import { logger } from '../lib/logger';
@@ -172,6 +178,64 @@ supervisorRouter.post('/stream', async (c: Context) => {
   }
 });
 
+/**
+ * POST /supervisor/stream/v2 - AI SDK Native UIMessageStream Endpoint
+ *
+ * Uses AI SDK v6 createUIMessageStream for native streaming that works
+ * directly with useChat on the frontend without custom transport.
+ *
+ * Benefits over /stream:
+ * - Native AI SDK protocol (no TextStreamChatTransport needed)
+ * - Structured data events (handoffs, tool calls, metadata)
+ * - Better frontend integration with useChat hooks
+ *
+ * Event types:
+ * - text: Incremental text content (native AI SDK)
+ * - data: Structured events (handoff, tool_call, done, error)
+ */
+supervisorRouter.post('/stream/v2', async (c: Context) => {
+  try {
+    // 1. Parse and validate request with Zod schema
+    const body = await c.req.json();
+    const parseResult = streamRequestSchema.safeParse(body);
+
+    if (!parseResult.success) {
+      const errorDetails = parseResult.error.issues
+        .map((i) => i.message)
+        .join(', ');
+      logger.warn({ errorDetails }, 'SupervisorStreamV2 invalid payload');
+      return handleValidationError(c, `Invalid request: ${errorDetails}`);
+    }
+
+    const { messages, sessionId } = parseResult.data;
+
+    // 2. Get last user query for logging
+    const lastMessage = messages[messages.length - 1];
+    const query = lastMessage.content;
+
+    logger.info(
+      { sessionId: sessionId || 'default', query: query.slice(0, 50) },
+      'SupervisorStreamV2 starting (UIMessageStream)'
+    );
+    logProviderStatus();
+
+    // 3. Create and return UIMessageStream response
+    const response = createSupervisorStreamResponse({
+      messages: messages.map((m) => ({
+        role: m.role as 'user' | 'assistant',
+        content: m.content,
+      })),
+      sessionId: sessionId || 'default',
+    });
+
+    logger.info('SupervisorStreamV2 response created');
+
+    return response;
+  } catch (error) {
+    return handleApiError(c, error, 'SupervisorStreamV2');
+  }
+});
+
 /**
  * GET /supervisor/health - Health Check for AI SDK Supervisor
  */
```

## ğŸ“„ cloud-run/ai-engine/src/services/ai-sdk/agents/advisor-agent.ts

```diff
diff --git a/cloud-run/ai-engine/src/services/ai-sdk/agents/advisor-agent.ts b/cloud-run/ai-engine/src/services/ai-sdk/agents/advisor-agent.ts
index 0485c10be..284f76705 100644
--- a/cloud-run/ai-engine/src/services/ai-sdk/agents/advisor-agent.ts
+++ b/cloud-run/ai-engine/src/services/ai-sdk/agents/advisor-agent.ts
@@ -38,7 +38,3 @@ export function isAdvisorAgentAvailable(): boolean {
   return config?.getModel() !== null;
 }
 
-// Legacy export for compatibility (deprecated - use getAdvisorAgentConfig instead)
-export const advisorAgent = null;
-
-export default advisorAgent;
```

## ğŸ“„ cloud-run/ai-engine/src/services/ai-sdk/agents/analyst-agent.ts

```diff
diff --git a/cloud-run/ai-engine/src/services/ai-sdk/agents/analyst-agent.ts b/cloud-run/ai-engine/src/services/ai-sdk/agents/analyst-agent.ts
index f2f720f2b..a5000a49b 100644
--- a/cloud-run/ai-engine/src/services/ai-sdk/agents/analyst-agent.ts
+++ b/cloud-run/ai-engine/src/services/ai-sdk/agents/analyst-agent.ts
@@ -38,7 +38,3 @@ export function isAnalystAgentAvailable(): boolean {
   return config?.getModel() !== null;
 }
 
-// Legacy export for compatibility (deprecated - use getAnalystAgentConfig instead)
-export const analystAgent = null;
-
-export default analystAgent;
```

## ğŸ“„ cloud-run/ai-engine/src/services/ai-sdk/agents/config/agent-configs.ts

```diff
diff --git a/cloud-run/ai-engine/src/services/ai-sdk/agents/config/agent-configs.ts b/cloud-run/ai-engine/src/services/ai-sdk/agents/config/agent-configs.ts
index 02f591dca..bc5c8953c 100644
--- a/cloud-run/ai-engine/src/services/ai-sdk/agents/config/agent-configs.ts
+++ b/cloud-run/ai-engine/src/services/ai-sdk/agents/config/agent-configs.ts
@@ -62,6 +62,8 @@ import {
   refineRootCauseAnalysis,
   enhanceSuggestedActions,
   extendServerCorrelation,
+  // Final answer (AI SDK v6 Best Practice)
+  finalAnswer,
 } from '../../../../tools-ai-sdk';
 
 // ============================================================================
@@ -318,6 +320,7 @@ export const AGENT_CONFIGS: Record<string, AgentConfig> = {
       getServerByGroup,
       getServerByGroupAdvanced,
       searchWeb,
+      finalAnswer, // AI SDK v6 Best Practice: graceful loop termination
     },
     matchPatterns: [
       // Korean keywords
@@ -382,6 +385,7 @@ export const AGENT_CONFIGS: Record<string, AgentConfig> = {
       analyzePattern,
       correlateMetrics,
       findRootCause,
+      finalAnswer, // AI SDK v6 Best Practice: graceful loop termination
     },
     matchPatterns: [
       // Anomaly keywords
@@ -421,6 +425,7 @@ export const AGENT_CONFIGS: Record<string, AgentConfig> = {
       buildIncidentTimeline,
       findRootCause,
       correlateMetrics,
+      finalAnswer, // AI SDK v6 Best Practice: graceful loop termination
     },
     matchPatterns: [
       // Report keywords
@@ -458,6 +463,7 @@ export const AGENT_CONFIGS: Record<string, AgentConfig> = {
       findRootCause,
       correlateMetrics,
       detectAnomalies,
+      finalAnswer, // AI SDK v6 Best Practice: graceful loop termination
     },
     matchPatterns: [
       // Solution keywords
```

## ğŸ“„ cloud-run/ai-engine/src/services/ai-sdk/agents/index.ts

```diff
diff --git a/cloud-run/ai-engine/src/services/ai-sdk/agents/index.ts b/cloud-run/ai-engine/src/services/ai-sdk/agents/index.ts
index a128f3270..f929df95c 100644
--- a/cloud-run/ai-engine/src/services/ai-sdk/agents/index.ts
+++ b/cloud-run/ai-engine/src/services/ai-sdk/agents/index.ts
@@ -24,10 +24,10 @@ export {
   shouldEnableWebSearch,
   resolveWebSearchSetting,
 } from './orchestrator';
-export { nlqAgent, getNlqAgentConfig, isNlqAgentAvailable } from './nlq-agent';
-export { analystAgent, getAnalystAgentConfig, isAnalystAgentAvailable } from './analyst-agent';
-export { reporterAgent, getReporterAgentConfig, isReporterAgentAvailable, generateHighQualityReport } from './reporter-agent';
-export { advisorAgent, getAdvisorAgentConfig, isAdvisorAgentAvailable } from './advisor-agent';
+export { getNlqAgentConfig, isNlqAgentAvailable } from './nlq-agent';
+export { getAnalystAgentConfig, isAnalystAgentAvailable } from './analyst-agent';
+export { getReporterAgentConfig, isReporterAgentAvailable, generateHighQualityReport } from './reporter-agent';
+export { getAdvisorAgentConfig, isAdvisorAgentAvailable } from './advisor-agent';
 export { executeReporterPipeline, type PipelineResult, type PipelineConfig } from './reporter-pipeline';
 export type { MultiAgentRequest, MultiAgentResponse } from './orchestrator';
 export { AGENT_CONFIGS, type AgentConfig, getAgentNames, getAgentConfig, isAgentAvailable, getAvailableAgents } from './config';
```

## ğŸ“„ cloud-run/ai-engine/src/services/ai-sdk/agents/nlq-agent.ts

```diff
diff --git a/cloud-run/ai-engine/src/services/ai-sdk/agents/nlq-agent.ts b/cloud-run/ai-engine/src/services/ai-sdk/agents/nlq-agent.ts
index 3e7a29b41..8de9642d6 100644
--- a/cloud-run/ai-engine/src/services/ai-sdk/agents/nlq-agent.ts
+++ b/cloud-run/ai-engine/src/services/ai-sdk/agents/nlq-agent.ts
@@ -40,7 +40,3 @@ export function isNlqAgentAvailable(): boolean {
   return config?.getModel() !== null;
 }
 
-// Legacy export for compatibility (deprecated - use getNlqAgentConfig instead)
-export const nlqAgent = null;
-
-export default nlqAgent;
```

## ğŸ“„ cloud-run/ai-engine/src/services/ai-sdk/agents/orchestrator.test.ts

```diff
diff --git a/cloud-run/ai-engine/src/services/ai-sdk/agents/orchestrator.test.ts b/cloud-run/ai-engine/src/services/ai-sdk/agents/orchestrator.test.ts
index 60a6374de..2faa04cb1 100644
--- a/cloud-run/ai-engine/src/services/ai-sdk/agents/orchestrator.test.ts
+++ b/cloud-run/ai-engine/src/services/ai-sdk/agents/orchestrator.test.ts
@@ -65,6 +65,8 @@ vi.mock('../../../tools-ai-sdk', () => ({
   searchKnowledgeBase: { execute: vi.fn() },
   searchWeb: { execute: vi.fn() },
   recommendCommands: { execute: vi.fn() },
+  // AI SDK v6 Best Practice: finalAnswer for graceful loop termination
+  finalAnswer: { execute: vi.fn() },
   // Incident evaluation tools
   evaluateIncidentReport: { execute: vi.fn() },
   validateReportStructure: { execute: vi.fn() },
@@ -409,30 +411,10 @@ describe('preFilterQuery', () => {
 });
 
 // ============================================================================
-// Legacy Compatibility Tests
+// Agent Config Tests
 // ============================================================================
 
-describe('Legacy Compatibility Exports', () => {
-  it('nlqAgent should be null (deprecated)', async () => {
-    const { nlqAgent } = await import('./nlq-agent');
-    expect(nlqAgent).toBeNull();
-  });
-
-  it('analystAgent should be null (deprecated)', async () => {
-    const { analystAgent } = await import('./analyst-agent');
-    expect(analystAgent).toBeNull();
-  });
-
-  it('reporterAgent should be null (deprecated)', async () => {
-    const { reporterAgent } = await import('./reporter-agent');
-    expect(reporterAgent).toBeNull();
-  });
-
-  it('advisorAgent should be null (deprecated)', async () => {
-    const { advisorAgent } = await import('./advisor-agent');
-    expect(advisorAgent).toBeNull();
-  });
-
+describe('Agent Config Exports', () => {
   it('should have config getters for each agent', async () => {
     const { getNlqAgentConfig } = await import('./nlq-agent');
     const { getAnalystAgentConfig } = await import('./analyst-agent');
```

---

## ğŸš€ AI ë¦¬ë·° ê²°ê³¼

ğŸ“Œ ë²„ê·¸ ë° ì •í•©ì„±
- [CRITICAL] `hasToolCall('finalAnswer')`ë¡œ ì¢…ë£Œí•˜ë„ë¡ ë³€ê²½í–ˆëŠ”ë°, OrchestratorëŠ” `finalAnswer` ê²°ê³¼ë¥¼ ì‘ë‹µì— ë°˜ì˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ëª¨ë¸ì´ `finalAnswer`ë§Œ í˜¸ì¶œí•˜ê³  í…ìŠ¤íŠ¸ë¥¼ ë‚´ì§€ ì•Šìœ¼ë©´ ì‘ë‹µì´ ë¹ˆ ë¬¸ìì—´ì´ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. `cloud-run/ai-engine/src/services/ai-sdk/agents/orchestrator.ts:702-753`  
  ê°œì„  ìŠ¤ë‹ˆí«(ë¹„ìŠ¤íŠ¸ë¦¬ë°):
```ts
// after result available
let finalAnswerResult: { answer?: string } | null = null;
for (const step of result.steps) {
  for (const call of step.toolCalls) {
    const res = step.toolResults?.find((r) => r.toolCallId === call.toolCallId);
    if (res?.toolName === 'finalAnswer' && res.result && typeof res.result === 'object') {
      finalAnswerResult = res.result as { answer?: string };
    }
  }
}
const responseText = finalAnswerResult?.answer ?? result.text;
const sanitizedResponse = sanitizeChineseCharacters(responseText);
```
  ìŠ¤íŠ¸ë¦¬ë°ë„ ë™ì¼ ë¬¸ì œì…ë‹ˆë‹¤. `cloud-run/ai-engine/src/services/ai-sdk/agents/orchestrator.ts:1453-1560`  
  ê°œì„  ìŠ¤ë‹ˆí«(ìŠ¤íŠ¸ë¦¬ë°):
```ts
let emittedText = false;
for await (const textChunk of streamResult.textStream) {
  const sanitized = sanitizeChineseCharacters(textChunk);
  if (sanitized) {
    emittedText = true;
    yield { type: 'text_delta', data: sanitized };
  }
}
// ...after steps resolved
const finalAnswer = steps?.flatMap(s => s.toolResults ?? [])
  .find(r => r.toolName === 'finalAnswer')?.result as { answer?: string } | undefined;
if (!emittedText && finalAnswer?.answer) {
  yield { type: 'text_delta', data: sanitizeChineseCharacters(finalAnswer.answer) };
}
```

- [HIGH] `/supervisor/stream/v2`ì˜ `text-delta` ì´ë²¤íŠ¸ì— ë§¤ ë¸íƒ€ë§ˆë‹¤ ë‹¤ë¥¸ `id`ë¥¼ ë¶€ì—¬í•©ë‹ˆë‹¤. UIMessageStreamì€ ë™ì¼ ë©”ì‹œì§€ idì— ë¸íƒ€ë¥¼ ëˆ„ì í•´ì•¼ í•˜ë¯€ë¡œ, í˜„ì¬ êµ¬í˜„ì€ ë¸íƒ€ë§ˆë‹¤ ìƒˆ ë©”ì‹œì§€ë¡œ ë Œë”ë  ê°€ëŠ¥ì„±ì´ í½ë‹ˆë‹¤. `cloud-run/ai-engine/src/services/ai-sdk/supervisor.ts:1046-1055`  
  ê°œì„  ìŠ¤ë‹ˆí«:
```ts
const messageId = `assistant-${Date.now()}`;
for await (const event of executeSupervisorStream({ ...request, mode })) {
  if (event.type === 'text_delta') {
    writer.write({ type: 'text-delta', delta: event.data as string, id: messageId });
  }
}
```

- [MEDIUM] `createPrepareStep`ì˜ ì •ê·œì‹ ìˆœì„œë¡œ ì¸í•´ â€œì›ì¸/ì™œâ€ê°€ Analyst ë¶„ê¸°ë¡œ ë¨¼ì € ë§¤ì¹­ë˜ì–´ RCA ë„êµ¬ê°€ 1ë‹¨ê³„ì—ì„œ ì œì™¸ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” 3-step ì œí•œê³¼ ê²°í•©ë˜ë©´ RCA ì‘ë‹µ í’ˆì§ˆ ì €í•˜ë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. `cloud-run/ai-engine/src/services/ai-sdk/supervisor.ts:932-944`  
  ê°œì„  ìŠ¤ë‹ˆí«(ìš°ì„ ìˆœìœ„ ì¡°ì •):
```ts
// RCA ë¨¼ì €
if (/ì¥ì• |rca|íƒ€ì„ë¼ì¸|ìƒê´€ê´€ê³„|ì›ì¸|ì™œ/.test(q)) {
  return { activeTools: ['findRootCause','buildIncidentTimeline','correlateMetrics','getServerMetrics','finalAnswer'] as ToolName[] };
}
// ì´í›„ Analyst
if (/ì´ìƒ|íŠ¸ë Œë“œ|ì˜ˆì¸¡|íŒ¨í„´/.test(q)) { ... }
```

ğŸ“Œ ì½”ë“œ í’ˆì§ˆ ë° êµ¬ì¡°
- [MEDIUM] `createSupervisorStreamResponse`ì˜ `done` ì´ë²¤íŠ¸ëŠ” `success: true`ë¡œ ê³ ì •ë˜ì–´ ìƒìœ„ ìŠ¤íŠ¸ë¦¼ì´ ì‹¤íŒ¨ë¥¼ ì•Œë ¤ë„ ë¬´ì¡°ê±´ ì„±ê³µìœ¼ë¡œ ê¸°ë¡ë©ë‹ˆë‹¤. í´ë¼ì´ì–¸íŠ¸/ê´€ì¸¡ ë¡œê·¸ì— ì˜¤íƒì„ ìœ ë°œí•©ë‹ˆë‹¤. `cloud-run/ai-engine/src/services/ai-sdk/supervisor.ts:1098-1107`  
  ê°œì„  ìŠ¤ë‹ˆí«:
```ts
const doneData = event.data as Record<string, unknown>;
writer.write({
  type: 'data-done',
  data: {
    durationMs: Date.now() - startTime,
    ...doneData,
    success: (doneData.success as boolean | undefined) ?? true,
  },
});
```

ğŸ“Œ ì„±ëŠ¥ ë° íš¨ìœ¨ì„±
- í° ì„±ëŠ¥ íšŒê·€ëŠ” ë³´ì´ì§€ ì•ŠìŠµë‹ˆë‹¤. ë‹¤ë§Œ `executeReporterWithPipeline`ì´ 45s timeoutì„ ì„¤ì •í•˜ê³  ìˆì–´ Vercel 60s ì œí•œê³¼ ê·¼ì ‘í•©ë‹ˆë‹¤. ì‹¤ì‚¬ìš© íŠ¸ë˜í”½ì—ì„œ íƒ€ì„ì•„ì›ƒ ê°€ëŠ¥ì„±ì´ ìˆìœ¼ë‹ˆ ê²½ê³  ë¡œê·¸ë‚˜ ì‹¤íŒ¨ ì‹œ fallback ì‘ë‹µ(ê°„ë‹¨ ìš”ì•½)ë„ ê³ ë ¤í•´ ì£¼ì„¸ìš”.

ğŸ“Œ ë³´ì•ˆ ë° ì•ˆì •ì„±
- ë³€ê²½ìœ¼ë¡œ ì¸í•œ ì§ì ‘ì  ë³´ì•ˆ ì´ìŠˆëŠ” í™•ì¸ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë‹¤ë§Œ `finalAnswer` ë„ì…ìœ¼ë¡œ ì‘ë‹µì´ ë¹„ì–´ë²„ë¦¬ëŠ” ê²½ìš°ê°€ ìƒê¸°ë©´ í´ë¼ì´ì–¸íŠ¸ ì¬ì‹œë„/ë£¨í”„ë¥¼ ìœ ë°œí•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì•ˆì •ì„± ê´€ì ì—ì„œ ë°˜ë“œì‹œ ìˆ˜ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.

ğŸ“Œ ë¬¸ì„œ/í…ŒìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
- ë¬¸ì„œ: ê²½ê³ ëŒ€ë¡œ API ë¬¸ì„œ ì—…ë°ì´íŠ¸ê°€ í•„ìš”í•©ë‹ˆë‹¤. íŠ¹íˆ ì œê±°ëœ ì—”ë“œí¬ì¸íŠ¸(`/analytics/analyze-batch`, `/analytics/rag/*`, `/approval/status`, `/approval/decide`, `/approval/stats`)ëŠ” **Breaking Change**ì´ë¯€ë¡œ `docs/api/` ë˜ëŠ” `README`ì— ëª…ì‹œ ê¶Œì¥.
- í…ŒìŠ¤íŠ¸:
  - `finalAnswer` ë„êµ¬ í˜¸ì¶œ ì‹œ `response`ê°€ tool ê²°ê³¼ë¥¼ ë°˜í™˜í•˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸ ì¶”ê°€ í•„ìš” (`orchestrator` ë¹„/ìŠ¤íŠ¸ë¦¬ë° ê°ê°).
  - `/supervisor/stream/v2`ê°€ ë™ì¼ message idë¡œ ë¸íƒ€ë¥¼ ë³‘í•©í•˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸ í•„ìš”.

â­ ì¢…í•© ì˜ê²¬ ë° ê²°ë¡ 
- ì ìˆ˜: 6.5 / 10  
- ìŠ¹ì¸ ì—¬ë¶€: **ê±°ë¶€ (Blocking ìˆ˜ì • í•„ìš”)**  
- ì‚¬ìœ : `finalAnswer` ë„êµ¬ê°€ í˜¸ì¶œë˜ë©´ ì‘ë‹µì´ ë¹ˆ ë¬¸ìì—´ì´ ë  ìˆ˜ ìˆëŠ” ì¹˜ëª…ì  ê²½ë¡œê°€ ì¡´ì¬í•˜ë©°, ì‹ ê·œ UIMessageStreamì˜ ë¸íƒ€ id ì²˜ë¦¬ë„ í´ë¼ì´ì–¸íŠ¸ ë Œë”ë§ì„ ê¹¨ëœ¨ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìœ„ 2ê±´ì€ ë°°í¬ ì „ ë°˜ë“œì‹œ ìˆ˜ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.

í•„ìš”í•˜ì‹œë©´ ìœ„ ìŠ¤ë‹ˆí« ê¸°ì¤€ìœ¼ë¡œ ì‹¤ì œ íŒ¨ì¹˜ê¹Œì§€ ì§„í–‰í•  ìˆ˜ ìˆì–´ìš”.

---

## ğŸ“‹ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] ë²„ê·¸ ìœ„í—˜ ì‚¬í•­ í™•ì¸ ì™„ë£Œ
- [ ] ê°œì„  ì œì•ˆ ê²€í†  ì™„ë£Œ
- [ ] TypeScript ì•ˆì „ì„± í™•ì¸ ì™„ë£Œ
- [ ] ë³´ì•ˆ ì´ìŠˆ í™•ì¸ ì™„ë£Œ
- [ ] ì¢…í•© í‰ê°€ í™•ì¸ ì™„ë£Œ

## ğŸš¨ ì˜¤íƒ(False Positive) ê¸°ë¡

<!-- ê±°ë¶€/ì €ì ìˆ˜ê°€ ì˜¤íƒì¸ ê²½ìš° ì•„ë˜ì— ê¸°ë¡ -->
<!-- ì˜ˆì‹œ: - [x] limit ê²€ì¦ ì´ìŠˆ: Mock í•¸ë“¤ëŸ¬ë¼ ì‹¤ì œ ì˜í–¥ ì—†ìŒ -->


---

**ìƒì„± ì‹œê°„**: 2026-01-24 16:11:56
**ë¦¬ë·° íŒŒì¼**: `/mnt/d/cursor/openmanager-vibe-v5/reports/ai-review/pending/review-codex-2026-01-24-16-08-15.md`
**AI ì—”ì§„**: CODEX
