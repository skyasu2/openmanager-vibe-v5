name: Lint Check

on:
  pull_request:
    branches:
      - main
      - master
      - develop
  push:
    branches:
      - main
      - master
      - develop

jobs:
  lint:
    name: ESLint Strict Check
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version-file: '.nvmrc'
          cache: 'npm'

      - name: Install Dependencies
        run: npm ci

      - name: Run ESLint Strict CI Check
        timeout-minutes: 5
        continue-on-error: true # Lint ê²½ê³ ëŠ” CI ì°¨ë‹¨ ë°©ì§€
        run: |
          echo "ğŸ” ESLint Strict CI Check ì‹œì‘..."

          # ë©”ëª¨ë¦¬ ì œí•œ ì¦ê°€ ë° íƒ€ì„ì•„ì›ƒ ì„¤ì •
          if timeout 300 npm run lint:ci:strict; then
            echo "âœ… ESLint ê²€ì‚¬ í†µê³¼ (ê²½ê³  0ê°œ)"
          else
            exit_code=$?

            if [ $exit_code -eq 124 ]; then
              echo "âš ï¸ ESLint íƒ€ì„ì•„ì›ƒ (5ë¶„ ì´ˆê³¼)"
              echo "ğŸ“ ë¡œì»¬ì—ì„œ 'npm run lint'ë¡œ í™•ì¸ ê¶Œì¥"
            else
              echo "âš ï¸ ESLint ê²½ê³  ë°œê²¬"
              echo "ğŸ“‹ ê²½ê³  ìƒì„¸ (ìµœê·¼ 10ê°œ):"
              npm run lint:ci:strict 2>&1 | grep -E "warning|âš " | head -10 || true
              echo "ğŸ“ ë¡œì»¬ì—ì„œ 'npm run lint'ë¡œ ì „ì²´ í™•ì¸ ê°€ëŠ¥"
            fi

            # Main ë¸Œëœì¹˜ëŠ” ì‹¤íŒ¨, ë‹¤ë¥¸ ë¸Œëœì¹˜ëŠ” ê²½ê³ 
            if [[ "${GITHUB_REF}" == "refs/heads/main" ]]; then
              echo "ğŸš¨ Main ë¸Œëœì¹˜ - Lint ê²½ê³ ë¡œ ì¸í•œ ì‹¤íŒ¨"
              exit 1
            else
              echo "âœ… Feature ë¸Œëœì¹˜ - Lint ê²½ê³  ë¬´ì‹œ (ê³„ì† ì§„í–‰)"
            fi
          fi
