name: Lint Check (Biome)

on:
  pull_request:
    branches:
      - main
      - master
      - develop
  push:
    branches:
      - main
      - master
      - develop

jobs:
  lint:
    name: Biome Check
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version-file: '.nvmrc'
          cache: 'npm'

      - name: Install Dependencies
        run: npm ci

      - name: Run Biome Check
        timeout-minutes: 2
        continue-on-error: true # Lint ê²½ê³ ëŠ” CI ì°¨ë‹¨ ë°©ì§€
        run: |
          echo "ğŸ” Biome Check ì‹œì‘..."

          # Biome check (format + lint)
          if output=$(timeout 120 npm run check 2>&1); then
            echo "âœ… Biome ê²€ì‚¬ í†µê³¼ (ì—ëŸ¬ 0ê°œ, ê²½ê³  0ê°œ)"
          else
            exit_code=$?

            if [ $exit_code -eq 124 ]; then
              echo "âš ï¸ Biome íƒ€ì„ì•„ì›ƒ (2ë¶„ ì´ˆê³¼)"
              echo "ğŸ“ ë¡œì»¬ì—ì„œ 'npm run check'ë¡œ í™•ì¸ ê¶Œì¥"
            else
              echo "âš ï¸ Biome ê²½ê³  ë˜ëŠ” ì—ëŸ¬ ë°œê²¬"
              echo "ğŸ“‹ ê²°ê³¼ ìš”ì•½:"
              echo "$output" | grep -E "Found|error|warning" | tail -5 || true
              echo ""
              echo "ğŸ“ ë¡œì»¬ì—ì„œ 'npm run check'ë¡œ ì „ì²´ í™•ì¸ ê°€ëŠ¥"
              echo "ğŸ”§ ìë™ ìˆ˜ì •: 'npm run lint:fix'"
            fi

            # Main ë¸Œëœì¹˜ëŠ” ì—ëŸ¬ë§Œ ì‹¤íŒ¨, ë‹¤ë¥¸ ë¸Œëœì¹˜ëŠ” ê²½ê³ 
            if echo "$output" | grep -q "Found.*error"; then
              if [[ "${GITHUB_REF}" == "refs/heads/main" ]]; then
                echo "ğŸš¨ Main ë¸Œëœì¹˜ - Biome ì—ëŸ¬ë¡œ ì¸í•œ ì‹¤íŒ¨"
                exit 1
              else
                echo "âš ï¸ Feature ë¸Œëœì¹˜ - Biome ì—ëŸ¬ ê²½ê³ "
              fi
            else
              echo "âœ… ê²½ê³ ë§Œ ìˆìŒ - ê³„ì† ì§„í–‰"
            fi
          fi
