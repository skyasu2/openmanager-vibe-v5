# Issue Report: 2025-01-28-22-08 - CRITICAL

## Summary
GCP Functions 완전 실패 - 모든 4개 함수가 404 에러 반환. 배포 스크립트와 실제 GCP 프로젝트 ID 불일치 확인.

## Impact
- **비즈니스 영향**: AI 기능 100% 불가 (한국어 NLP, ML 분석, AI 통합 처리)
- **사용자 영향**: 자연어 질의, AI 기반 분석, 지능형 응답 기능 모두 사용 불가
- **시스템 영향**: Vercel에서 GCP Functions 호출 시 404 에러로 폴백 처리 필요

## Root Cause
1. **프로젝트 ID 불일치**:
   - 배포 스크립트: `openmanager-ai`
   - 환경 변수: `openmanager-free-tier`
   - 실제 URL: `asia-northeast3-openmanager-free-tier.cloudfunctions.net`

2. **배포 상태 불명**:
   - 4개 함수 모두 404 반환
   - Node.js 함수 2개: ai-gateway, rule-engine
   - Python 함수 2개: korean-nlp-python, basic-ml-python
   - 그러나 소스 디렉토리명은 다름: enhanced-korean-nlp, ml-analytics-engine

3. **Python 마이그레이션 진행 중**:
   - JavaScript에서 Python으로 전환 중
   - 일부 함수는 Python 코드 준비됨 (enhanced-korean-nlp/main.py)

## Resolution Steps

### 즉시 조치 필요:
1. GCP 프로젝트 확인 및 배포:
   ```bash
   # 현재 프로젝트 확인
   gcloud config get-value project
   
   # 올바른 프로젝트로 설정
   gcloud config set project openmanager-free-tier
   
   # Functions 목록 확인
   gcloud functions list --region=asia-northeast3
   ```

2. 배포 스크립트 수정:
   - `/gcp-functions/deployment/deploy-all.sh`의 PROJECT_ID를 `openmanager-free-tier`로 변경
   - 함수명과 디렉토리명 매핑 수정

3. 긴급 배포:
   ```bash
   cd /mnt/d/cursor/openmanager-vibe-v5
   bash gcp-functions/deployment/deploy-all.sh
   ```

### 중장기 개선:
1. **환경 변수 통합**:
   - `.env.local`의 GCP 관련 변수 정리
   - 프로젝트 ID 일관성 확보

2. **함수명 표준화**:
   - 디렉토리명과 함수명 일치
   - Python/Node.js 구분 명확화

3. **모니터링 강화**:
   - GCP Functions 헬스체크 API 구현
   - 배포 후 자동 검증 스크립트 추가

## Prevention

1. **CI/CD 파이프라인**:
   - GitHub Actions로 자동 배포 구성
   - 배포 전 환경 변수 검증
   - 배포 후 자동 테스트

2. **문서화**:
   - GCP Functions 배포 가이드 작성
   - 환경 변수 설정 문서화
   - 트러블슈팅 가이드 추가

3. **모니터링**:
   - GCP Monitoring 대시보드 설정
   - 함수별 에러율 알림 설정
   - 주기적 헬스체크 (15분 간격)

## 현재 서비스 상태

### 정상 작동:
- **Vercel**: 200 OK, 823ms 응답시간
- **Supabase**: 200 OK, REST API 정상
- **Redis**: 200 OK, 0% 메모리 사용 (256MB 한계 중 0B 사용)

### 무료 티어 사용률:
- **Vercel**: 예상 30% (100GB 중 약 30GB)
- **Supabase**: 3% (500MB 중 약 15MB)
- **Redis**: 0% (256MB 중 0B 사용)
- **GCP**: 측정 불가 (Functions 미배포)

## 권장 사항

1. **즉시**: GCP Functions 재배포 (예상 소요시간: 10-15분)
2. **24시간 내**: 환경 변수 및 배포 스크립트 정리
3. **1주일 내**: CI/CD 파이프라인 구축
4. **2주일 내**: 전체 Python 마이그레이션 완료

---
**담당자**: DevOps Team
**예상 해결 시간**: 1시간
**비즈니스 연속성**: Vercel 기본 기능은 정상, AI 기능만 영향