<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì„œë²„ ë°ì´í„° ìƒì„±ê¸° ê²€ì¦ í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: 'Consolas', 'Monaco', monospace;
            background-color: #1a1a1a;
            color: #00ff00;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .output {
            background-color: #000;
            border: 1px solid #333;
            padding: 20px;
            border-radius: 8px;
            white-space: pre-wrap;
            font-size: 14px;
            height: 600px;
            overflow-y: auto;
        }

        .button {
            background-color: #007acc;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 0;
            font-size: 16px;
        }

        .button:hover {
            background-color: #005a9e;
        }

        .success {
            color: #00ff00;
        }

        .error {
            color: #ff4444;
        }

        .warning {
            color: #ffaa00;
        }

        .info {
            color: #00aaff;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ğŸ§ª ì„œë²„ ë°ì´í„° ìƒì„±ê¸° ì„¤ê³„ ê²€ì¦ í…ŒìŠ¤íŠ¸</h1>
        <p>RealServerDataGeneratorê°€ ì„¤ê³„ ëª…ì„¸ì— ë§ê²Œ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.</p>

        <button class="button" onclick="runTest()">ğŸš€ í…ŒìŠ¤íŠ¸ ì‹œì‘</button>
        <button class="button" onclick="clearOutput()">ğŸ—‘ï¸ ì¶œë ¥ ì§€ìš°ê¸°</button>

        <div id="output" class="output">í…ŒìŠ¤íŠ¸ë¥¼ ì‹œì‘í•˜ë ¤ë©´ ìœ„ì˜ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”...</div>
    </div>

    <script>
        let outputElement = document.getElementById('output');

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const colorClass = type === 'success' ? 'success' :
                type === 'error' ? 'error' :
                    type === 'warning' ? 'warning' : 'info';

            outputElement.innerHTML += `<span class="${colorClass}">[${timestamp}] ${message}</span>\n`;
            outputElement.scrollTop = outputElement.scrollHeight;
        }

        function clearOutput() {
            outputElement.innerHTML = '';
        }

        async function runTest() {
            clearOutput();
            log('ğŸ§ª ì„œë²„ ë°ì´í„° ìƒì„±ê¸° ì„¤ê³„ ê²€ì¦ ì‹œì‘...', 'info');
            log('', 'info');

            try {
                // API í˜¸ì¶œë¡œ ì„œë²„ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                log('ğŸ“¡ API í˜¸ì¶œ ì¤‘...', 'info');
                const response = await fetch('http://localhost:3000/api/servers/realtime?type=servers');
                const result = await response.json();

                if (!result.success) {
                    throw new Error(`API í˜¸ì¶œ ì‹¤íŒ¨: ${result.error}`);
                }

                const servers = result.data;
                log(`âœ… ì´ ${servers.length}ê°œ ì„œë²„ ë°ì´í„° ìˆ˜ì‹ `, 'success');
                log('', 'info');

                // ì„¤ê³„ ëª…ì„¸ ê²€ì¦
                const validationResults = {
                    serverCount: servers.length === 20, // ğŸ¯ 20ê°œë¡œ ë³€ê²½
                    serverTypes: [],
                    serverNames: [],
                    roles: [],
                    environments: [],
                    locations: [],
                    statuses: [],
                    cpuCores: [],
                    memoryRanges: [],
                    healthScores: [],
                };

                // ê° ì„œë²„ ë°ì´í„° ê²€ì¦
                servers.forEach((server, index) => {
                    // ì„œë²„ íƒ€ì… ê²€ì¦
                    const validTypes = ['web', 'api', 'database', 'cache', 'queue'];
                    validationResults.serverTypes.push(validTypes.includes(server.type));

                    // ì„œë²„ ì´ë¦„ í˜•ì‹ ê²€ì¦ (íƒ€ì…-ìˆ«ì)
                    const namePattern = new RegExp(`^${server.type}-\\d+$`);
                    validationResults.serverNames.push(namePattern.test(server.name));

                    // ì—­í•  ê²€ì¦
                    const validRoles = ['primary', 'replica', 'worker', 'standalone'];
                    validationResults.roles.push(validRoles.includes(server.role));

                    // í™˜ê²½ ê²€ì¦
                    const validEnvironments = ['production', 'staging', 'development'];
                    validationResults.environments.push(validEnvironments.includes(server.environment));

                    // ìœ„ì¹˜ ê²€ì¦
                    const validLocations = ['Seoul-DC-1', 'Seoul-DC-2', 'Busan-DC-1', 'Daegu-DC-1', 'Incheon-DC-1'];
                    validationResults.locations.push(validLocations.includes(server.location));

                    // ìƒíƒœ ê²€ì¦
                    const validStatuses = ['running', 'warning', 'error'];
                    validationResults.statuses.push(validStatuses.includes(server.status));

                    // CPU ì½”ì–´ ìˆ˜ ê²€ì¦ (4-19ê°œ)
                    const cpuCores = server.specs?.cpu?.cores || 0;
                    validationResults.cpuCores.push(cpuCores >= 4 && cpuCores <= 19);

                    // ë©”ëª¨ë¦¬ ë²”ìœ„ ê²€ì¦ (8GB-64GB)
                    const memoryGB = (server.specs?.memory?.total || 0) / 1024;
                    validationResults.memoryRanges.push(memoryGB >= 8 && memoryGB <= 64);

                    // ê±´ê°•ë„ ê²€ì¦ (60-100ì )
                    const healthScore = server.health?.score || 0;
                    validationResults.healthScores.push(healthScore >= 60 && healthScore <= 100);

                    // ì²« 5ê°œ ì„œë²„ ìƒì„¸ ì •ë³´ ì¶œë ¥
                    if (index < 5) {
                        log(`ğŸ“Š ì„œë²„ ${index + 1}: ${server.name}`, 'info');
                        log(`   íƒ€ì…: ${server.type}, ì—­í• : ${server.role}`, 'info');
                        log(`   í™˜ê²½: ${server.environment}, ìœ„ì¹˜: ${server.location}`, 'info');
                        log(`   ìƒíƒœ: ${server.status}, ê±´ê°•ë„: ${Math.round(healthScore)}%`, 'info');
                        log(`   CPU: ${cpuCores}ì½”ì–´, ë©”ëª¨ë¦¬: ${Math.round(memoryGB)}GB`, 'info');
                        log('', 'info');
                    }
                });

                // ê²€ì¦ ê²°ê³¼ ì¶œë ¥
                log('ğŸ” ì„¤ê³„ ëª…ì„¸ ê²€ì¦ ê²°ê³¼:', 'info');
                log(`   ì„œë²„ ê°œìˆ˜ (30ê°œ): ${validationResults.serverCount ? 'âœ…' : 'âŒ'}`, validationResults.serverCount ? 'success' : 'error');
                log(`   ì„œë²„ íƒ€ì…: ${validationResults.serverTypes.every(v => v) ? 'âœ…' : 'âŒ'}`, validationResults.serverTypes.every(v => v) ? 'success' : 'error');
                log(`   ì„œë²„ ì´ë¦„ í˜•ì‹: ${validationResults.serverNames.every(v => v) ? 'âœ…' : 'âŒ'}`, validationResults.serverNames.every(v => v) ? 'success' : 'error');
                log(`   ì—­í• : ${validationResults.roles.every(v => v) ? 'âœ…' : 'âŒ'}`, validationResults.roles.every(v => v) ? 'success' : 'error');
                log(`   í™˜ê²½: ${validationResults.environments.every(v => v) ? 'âœ…' : 'âŒ'}`, validationResults.environments.every(v => v) ? 'success' : 'error');
                log(`   ìœ„ì¹˜: ${validationResults.locations.every(v => v) ? 'âœ…' : 'âŒ'}`, validationResults.locations.every(v => v) ? 'success' : 'error');
                log(`   ìƒíƒœ: ${validationResults.statuses.every(v => v) ? 'âœ…' : 'âŒ'}`, validationResults.statuses.every(v => v) ? 'success' : 'error');
                log(`   CPU ì½”ì–´ ìˆ˜: ${validationResults.cpuCores.every(v => v) ? 'âœ…' : 'âŒ'}`, validationResults.cpuCores.every(v => v) ? 'success' : 'error');
                log(`   ë©”ëª¨ë¦¬ ë²”ìœ„: ${validationResults.memoryRanges.every(v => v) ? 'âœ…' : 'âŒ'}`, validationResults.memoryRanges.every(v => v) ? 'success' : 'error');
                log(`   ê±´ê°•ë„ ë²”ìœ„: ${validationResults.healthScores.every(v => v) ? 'âœ…' : 'âŒ'}`, validationResults.healthScores.every(v => v) ? 'success' : 'error');

                // í†µê³„ ì •ë³´
                const statusCounts = servers.reduce((acc, server) => {
                    acc[server.status] = (acc[server.status] || 0) + 1;
                    return acc;
                }, {});

                const typeCounts = servers.reduce((acc, server) => {
                    acc[server.type] = (acc[server.type] || 0) + 1;
                    return acc;
                }, {});

                log('', 'info');
                log('ğŸ“ˆ í†µê³„ ì •ë³´:', 'info');
                log(`   ìƒíƒœë³„ ë¶„í¬: ${JSON.stringify(statusCounts)}`, 'info');
                log(`   íƒ€ì…ë³„ ë¶„í¬: ${JSON.stringify(typeCounts)}`, 'info');

                // ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ í…ŒìŠ¤íŠ¸
                log('', 'info');
                log('ğŸ”„ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ í…ŒìŠ¤íŠ¸ (5ì´ˆ í›„ ì¬í™•ì¸)...', 'warning');

                setTimeout(async () => {
                    try {
                        const response2 = await fetch('http://localhost:3000/api/servers/realtime?type=servers');
                        const result2 = await response2.json();

                        if (result2.success) {
                            const servers2 = result2.data;

                            // ì²« ë²ˆì§¸ ì„œë²„ì˜ ë©”íŠ¸ë¦­ ë³€í™” í™•ì¸
                            const server1_before = servers[0];
                            const server1_after = servers2[0];

                            const cpuChanged = Math.abs(server1_before.metrics.cpu - server1_after.metrics.cpu) > 0.1;
                            const memoryChanged = Math.abs(server1_before.metrics.memory - server1_after.metrics.memory) > 0.1;

                            log(`   ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸: ${cpuChanged || memoryChanged ? 'âœ…' : 'âŒ'}`, cpuChanged || memoryChanged ? 'success' : 'error');
                            log(`   CPU ë³€í™”: ${server1_before.metrics.cpu.toFixed(1)}% â†’ ${server1_after.metrics.cpu.toFixed(1)}%`, 'info');
                            log(`   ë©”ëª¨ë¦¬ ë³€í™”: ${server1_before.metrics.memory.toFixed(1)}% â†’ ${server1_after.metrics.memory.toFixed(1)}%`, 'info');
                        }
                    } catch (error) {
                        log(`   ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`, 'error');
                    }

                    log('', 'info');
                    log('ğŸ‰ ì„œë²„ ë°ì´í„° ìƒì„±ê¸° ê²€ì¦ ì™„ë£Œ!', 'success');
                }, 5000);

            } catch (error) {
                log(`âŒ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`, 'error');
            }
        }
    </script>
</body>

</html>