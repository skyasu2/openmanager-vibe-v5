<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìƒˆ ë°°í¬ ë²„ì „ API í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .success {
            border-left: 4px solid #4CAF50;
            background-color: #f8fff8;
        }

        .error {
            border-left: 4px solid #f44336;
            background-color: #fff8f8;
        }

        .warning {
            border-left: 4px solid #ff9800;
            background-color: #fffaf0;
        }

        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }

        button:hover {
            background-color: #0056b3;
        }

        .result {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            margin-top: 10px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }

        .url-info {
            background-color: #e3f2fd;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ğŸ” ìƒˆ ë°°í¬ ë²„ì „ API í…ŒìŠ¤íŠ¸</h1>
        <div class="url-info">
            <h3>ğŸ“ í…ŒìŠ¤íŠ¸ ëŒ€ìƒ URL</h3>
            <p><strong>ìƒˆ ë°°í¬:</strong> <code>openmanager-vibe-v5-2kmp3u280-skyasus-projects.vercel.app</code></p>
            <p><strong>ê¸°ì¡´ ë°°í¬:</strong> <code>openmanager-vibe-v5.vercel.app</code></p>
        </div>

        <button onclick="runComparisonTest()">ğŸš€ ìƒˆ ë°°í¬ vs ê¸°ì¡´ ë°°í¬ ë¹„êµ í…ŒìŠ¤íŠ¸</button>
        <button onclick="testSpecificErrors()">ğŸ”¥ íŠ¹ì • ì˜¤ë¥˜ ì¬í˜„ í…ŒìŠ¤íŠ¸</button>
        <button onclick="clearResults()">ğŸ§¹ ê²°ê³¼ ì§€ìš°ê¸°</button>
    </div>

    <div class="container">
        <h2>ğŸ“Š í…ŒìŠ¤íŠ¸ ê²°ê³¼</h2>
        <div id="test-results" class="result" style="display: none;"></div>
    </div>

    <script>
        const newDeploymentUrl = 'https://openmanager-vibe-v5-2kmp3u280-skyasus-projects.vercel.app';
        const oldDeploymentUrl = 'https://openmanager-vibe-v5.vercel.app';

        function showResult(content, isError = false) {
            const element = document.getElementById('test-results');
            element.style.display = 'block';
            element.textContent = content;
            element.className = `result ${isError ? 'error' : 'success'}`;
        }

        function appendResult(content) {
            const element = document.getElementById('test-results');
            element.style.display = 'block';
            element.textContent += content + '\n';
        }

        async function testAPI(baseUrl, endpoint, method = 'GET', body = null) {
            try {
                const options = {
                    method: method,
                    headers: { 'Content-Type': 'application/json' }
                };

                if (body) {
                    options.body = JSON.stringify(body);
                }

                const response = await fetch(`${baseUrl}${endpoint}`, options);

                return {
                    success: response.ok,
                    status: response.status,
                    statusText: response.statusText,
                    data: response.ok ? await response.json() : null,
                    error: response.ok ? null : `HTTP ${response.status}: ${response.statusText}`
                };
            } catch (error) {
                return {
                    success: false,
                    status: 0,
                    statusText: 'Network Error',
                    data: null,
                    error: error.message
                };
            }
        }

        async function runComparisonTest() {
            showResult('ğŸ” ìƒˆ ë°°í¬ vs ê¸°ì¡´ ë°°í¬ ë¹„êµ í…ŒìŠ¤íŠ¸ ì‹œì‘...\n\n');

            const testEndpoints = [
                { path: '/api/health', method: 'GET', name: 'í—¬ìŠ¤ì²´í¬' },
                { path: '/api/ai/smart-fallback', method: 'GET', name: 'Smart Fallback ìƒíƒœ' },
                {
                    path: '/api/ai/smart-fallback',
                    method: 'POST',
                    name: 'Smart Fallback ì¿¼ë¦¬',
                    body: {
                        query: "í˜„ì¬ ì‹œìŠ¤í…œ ìƒíƒœëŠ” ì–´ë–¤ê°€ìš”?",
                        context: { sessionId: `test_${Date.now()}`, language: "ko" },
                        options: { enableThinking: false, useMCP: true, useRAG: true }
                    }
                },
                { path: '/api/ai/unified/status', method: 'GET', name: 'AI í†µí•© ìƒíƒœ' },
                { path: '/api/logs/recent?limit=50', method: 'GET', name: 'ìµœê·¼ ë¡œê·¸' }
            ];

            for (const endpoint of testEndpoints) {
                appendResult(`\nğŸ“‹ ${endpoint.name} í…ŒìŠ¤íŠ¸:`);

                // ìƒˆ ë°°í¬ í…ŒìŠ¤íŠ¸
                const newResult = await testAPI(newDeploymentUrl, endpoint.path, endpoint.method, endpoint.body);
                appendResult(`  ğŸ†• ìƒˆ ë°°í¬: ${newResult.status} ${newResult.statusText} ${newResult.success ? 'âœ…' : 'âŒ'}`);

                // ê¸°ì¡´ ë°°í¬ í…ŒìŠ¤íŠ¸
                const oldResult = await testAPI(oldDeploymentUrl, endpoint.path, endpoint.method, endpoint.body);
                appendResult(`  ğŸ”„ ê¸°ì¡´ ë°°í¬: ${oldResult.status} ${oldResult.statusText} ${oldResult.success ? 'âœ…' : 'âŒ'}`);

                // ë¹„êµ ê²°ê³¼
                if (newResult.status !== oldResult.status) {
                    appendResult(`  âš ï¸ ìƒíƒœ ì½”ë“œ ì°¨ì´ ë°œê²¬: ${newResult.status} vs ${oldResult.status}`);
                }

                if (newResult.success && endpoint.name === 'Smart Fallback ì¿¼ë¦¬') {
                    appendResult(`  ğŸ“ ì‘ë‹µ ë¯¸ë¦¬ë³´ê¸°: ${newResult.data?.response?.substring(0, 100)}...`);
                }

                await new Promise(resolve => setTimeout(resolve, 500));
            }

            appendResult('\nğŸ” ë¹„êµ í…ŒìŠ¤íŠ¸ ì™„ë£Œ!');
        }

        async function testSpecificErrors() {
            showResult('ğŸ”¥ ì‚¬ìš©ì ë³´ê³  ì˜¤ë¥˜ ì¬í˜„ í…ŒìŠ¤íŠ¸ ì‹œì‘...\n\n');

            // 1. AI ë¡œê¹… ìŠ¤íŠ¸ë¦¼ 500 ì˜¤ë¥˜ í…ŒìŠ¤íŠ¸
            appendResult('1ï¸âƒ£ AI ë¡œê¹… ìŠ¤íŠ¸ë¦¼ 500 ì˜¤ë¥˜ ì¬í˜„:');
            try {
                const streamResponse = await fetch(`${newDeploymentUrl}/api/ai/logging/stream?mode=sidebar`);
                appendResult(`   ê²°ê³¼: ${streamResponse.status} ${streamResponse.statusText} ${streamResponse.ok ? 'âœ…' : 'âŒ'}`);

                if (!streamResponse.ok) {
                    appendResult(`   âŒ 500 ì˜¤ë¥˜ ì¬í˜„ë¨! ì´ê²ƒì´ ì‚¬ìš©ìê°€ ë³´ê³ í•œ ë¬¸ì œì…ë‹ˆë‹¤.`);
                }
            } catch (error) {
                appendResult(`   âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ${error.message}`);
            }

            // 2. Smart Fallback 405 ì˜¤ë¥˜ í…ŒìŠ¤íŠ¸
            appendResult('\n2ï¸âƒ£ Smart Fallback 405 ì˜¤ë¥˜ ì¬í˜„:');
            const testQuery = {
                query: "í˜„ì¬ ì„œë²„ ìƒíƒœëŠ” ì–´ë–¤ê°€ìš”?",
                context: { sessionId: `error_test_${Date.now()}`, language: "ko" },
                options: { enableThinking: false }
            };

            try {
                const fallbackResponse = await fetch(`${newDeploymentUrl}/api/ai/smart-fallback`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(testQuery)
                });

                appendResult(`   ê²°ê³¼: ${fallbackResponse.status} ${fallbackResponse.statusText} ${fallbackResponse.ok ? 'âœ…' : 'âŒ'}`);

                if (fallbackResponse.status === 405) {
                    appendResult(`   âŒ 405 ì˜¤ë¥˜ ì¬í˜„ë¨! ì´ê²ƒì´ ì‚¬ìš©ìê°€ ë³´ê³ í•œ ë¬¸ì œì…ë‹ˆë‹¤.`);
                } else if (fallbackResponse.ok) {
                    const data = await fallbackResponse.json();
                    appendResult(`   âœ… ì •ìƒ ì‘ë™! ì‘ë‹µ: ${data.response?.substring(0, 100)}...`);
                }
            } catch (error) {
                appendResult(`   âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ${error.message}`);
            }

            // 3. ë¡œê·¸ API 404 ì˜¤ë¥˜ í…ŒìŠ¤íŠ¸
            appendResult('\n3ï¸âƒ£ ë¡œê·¸ API 404 ì˜¤ë¥˜ ì¬í˜„:');
            try {
                const logsResponse = await fetch(`${newDeploymentUrl}/api/logs/recent?limit=50`);
                appendResult(`   ê²°ê³¼: ${logsResponse.status} ${logsResponse.statusText} ${logsResponse.ok ? 'âœ…' : 'âŒ'}`);

                if (logsResponse.status === 404) {
                    appendResult(`   âŒ 404 ì˜¤ë¥˜ ì¬í˜„ë¨! ì´ API ì—”ë“œí¬ì¸íŠ¸ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.`);
                }
            } catch (error) {
                appendResult(`   âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ${error.message}`);
            }

            appendResult('\nğŸ”¥ ì˜¤ë¥˜ ì¬í˜„ í…ŒìŠ¤íŠ¸ ì™„ë£Œ!');
            appendResult('\nğŸ“‹ ê²°ë¡ : ë°°í¬ í™˜ê²½ì— ìˆ˜ì •ì‚¬í•­ì´ ë°˜ì˜ë˜ì§€ ì•Šì•˜ê±°ë‚˜ ìƒˆë¡œìš´ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }

        function clearResults() {
            const element = document.getElementById('test-results');
            element.style.display = 'none';
            element.textContent = '';
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì‹¤í–‰
        window.addEventListener('load', () => {
            console.log('ğŸ” ìƒˆ ë°°í¬ ë²„ì „ API í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ë¡œë“œë¨');
            console.log('ìƒˆ ë°°í¬ URL:', newDeploymentUrl);
            console.log('ê¸°ì¡´ ë°°í¬ URL:', oldDeploymentUrl);
        });
    </script>
</body>

</html>