<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vercel AI ìƒíƒœ í™•ì¸ í…ŒìŠ¤íŠ¸</title>
    <style>
      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        min-height: 100vh;
      }

      .container {
        background: rgba(255, 255, 255, 0.1);
        -webkit-backdrop-filter: blur(10px);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
      }

      .test-section {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 15px;
        padding: 20px;
        margin: 20px 0;
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .status {
        padding: 10px 20px;
        border-radius: 25px;
        margin: 10px 0;
        font-weight: bold;
        text-align: center;
      }

      .success {
        background: rgba(76, 175, 80, 0.3);
        border: 2px solid #4caf50;
      }

      .error {
        background: rgba(244, 67, 54, 0.3);
        border: 2px solid #f44336;
      }

      .warning {
        background: rgba(255, 193, 7, 0.3);
        border: 2px solid #ffc107;
        color: #333;
      }

      .info {
        background: rgba(33, 150, 243, 0.3);
        border: 2px solid #2196f3;
      }

      button {
        background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 25px;
        cursor: pointer;
        font-size: 16px;
        margin: 10px;
        transition: transform 0.2s;
      }

      button:hover {
        transform: translateY(-2px);
      }

      .result-box {
        background: rgba(0, 0, 0, 0.3);
        border-radius: 10px;
        padding: 15px;
        margin: 10px 0;
        font-family: 'Courier New', monospace;
        white-space: pre-wrap;
        max-height: 400px;
        overflow-y: auto;
      }

      h1,
      h2 {
        text-align: center;
        margin-bottom: 30px;
      }

      .url-display {
        background: rgba(0, 0, 0, 0.2);
        padding: 10px;
        border-radius: 10px;
        font-family: monospace;
        word-break: break-all;
        margin: 10px 0;
      }
    </style>
  </head>

  <body>
    <div class="container">
      <h1>ğŸš€ Vercel AI ìƒíƒœ í™•ì¸ í…ŒìŠ¤íŠ¸</h1>
      <div class="info status">
        <strong>ìƒˆë¡œìš´ ë°°í¬ URL:</strong>
        <div class="url-display">
          openmanager-vibe-v5-l1mk1fdy5-skyasus-projects.vercel.app
        </div>
      </div>

      <div class="test-section">
        <h2>ğŸ“¡ 1. ê¸°ë³¸ ì—°ê²° ë° í—¬ìŠ¤ì²´í¬</h2>
        <button onclick="testBasicConnection()">ê¸°ë³¸ ì—°ê²° í™•ì¸</button>
        <div id="basic-result" class="result-box"></div>
      </div>

      <div class="test-section">
        <h2>ğŸ¤– 2. AI ì—”ì§„ ìƒíƒœ í™•ì¸</h2>
        <button onclick="testAIEngineStatus()">AI ì—”ì§„ ìƒíƒœ í™•ì¸</button>
        <div id="ai-engine-result" class="result-box"></div>
      </div>

      <div class="test-section">
        <h2>ğŸ”§ 3. Smart Fallback API í…ŒìŠ¤íŠ¸</h2>
        <button onclick="testSmartFallbackAPI()">Smart Fallback í…ŒìŠ¤íŠ¸</button>
        <div id="fallback-result" class="result-box"></div>
      </div>

      <div class="test-section">
        <h2>ğŸ’¬ 4. AI ìì—°ì–´ ì§ˆì˜ í…ŒìŠ¤íŠ¸</h2>
        <button onclick="testNaturalLanguageQueries()">
          ìì—°ì–´ ì§ˆì˜ í…ŒìŠ¤íŠ¸
        </button>
        <div id="ai-query-result" class="result-box"></div>
      </div>

      <div class="test-section">
        <h2>ğŸ¯ 5. ëŒ€ì‹œë³´ë“œ ì„œë²„ ëª¨ë‹¬ í…ŒìŠ¤íŠ¸</h2>
        <button onclick="testDashboardModal()">ëŒ€ì‹œë³´ë“œ ëª¨ë‹¬ í…ŒìŠ¤íŠ¸</button>
        <div id="modal-result" class="result-box"></div>
      </div>

      <div class="test-section">
        <h2>ğŸ“Š 6. ì¢…í•© ê²°ê³¼</h2>
        <div id="summary-result" class="result-box">
          í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ë©´ ì—¬ê¸°ì— ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.
        </div>
      </div>
    </div>

    <script>
      const BASE_URL =
        'https://openmanager-vibe-v5-l1mk1fdy5-skyasus-projects.vercel.app';
      let testResults = {
        basic: null,
        aiEngine: null,
        fallback: null,
        aiQuery: null,
        modal: null,
      };

      function log(elementId, message, type = 'info') {
        const element = document.getElementById(elementId);
        const timestamp = new Date().toLocaleTimeString();
        const typeIcon = {
          success: 'âœ…',
          error: 'âŒ',
          warning: 'âš ï¸',
          info: 'â„¹ï¸',
        };
        element.innerHTML += `[${timestamp}] ${typeIcon[type]} ${message}\n`;
        element.scrollTop = element.scrollHeight;
      }

      function clearLog(elementId) {
        document.getElementById(elementId).innerHTML = '';
      }

      async function testBasicConnection() {
        clearLog('basic-result');
        log('basic-result', 'ê¸°ë³¸ ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'info');

        try {
          // 1. ë©”ì¸ í˜ì´ì§€ ì ‘ê·¼
          log('basic-result', '1. ë©”ì¸ í˜ì´ì§€ ì ‘ê·¼ í…ŒìŠ¤íŠ¸...', 'info');
          const mainResponse = await fetch(`${BASE_URL}/`);
          log(
            'basic-result',
            `ë©”ì¸ í˜ì´ì§€: ${mainResponse.status} ${mainResponse.statusText}`,
            mainResponse.ok ? 'success' : 'warning'
          );

          // 2. í—¬ìŠ¤ì²´í¬ API
          log('basic-result', '2. í—¬ìŠ¤ì²´í¬ API í…ŒìŠ¤íŠ¸...', 'info');
          const healthResponse = await fetch(`${BASE_URL}/api/health`);
          if (healthResponse.ok) {
            const healthData = await healthResponse.json();
            log(
              'basic-result',
              `í—¬ìŠ¤ì²´í¬ ì„±ê³µ: ${JSON.stringify(healthData, null, 2)}`,
              'success'
            );
            testResults.basic = true;
          } else {
            log(
              'basic-result',
              `í—¬ìŠ¤ì²´í¬ ì‹¤íŒ¨: ${healthResponse.status}`,
              'error'
            );
            testResults.basic = false;
          }

          // 3. ëŒ€ì‹œë³´ë“œ í˜ì´ì§€ ì ‘ê·¼
          log('basic-result', '3. ëŒ€ì‹œë³´ë“œ í˜ì´ì§€ ì ‘ê·¼ í…ŒìŠ¤íŠ¸...', 'info');
          const dashboardResponse = await fetch(`${BASE_URL}/dashboard`);
          log(
            'basic-result',
            `ëŒ€ì‹œë³´ë“œ: ${dashboardResponse.status} ${dashboardResponse.statusText}`,
            dashboardResponse.ok ? 'success' : 'warning'
          );
        } catch (error) {
          log('basic-result', `ì—°ê²° ì˜¤ë¥˜: ${error.message}`, 'error');
          testResults.basic = false;
        }
        updateSummary();
      }

      async function testAIEngineStatus() {
        clearLog('ai-engine-result');
        log('ai-engine-result', 'AI ì—”ì§„ ìƒíƒœ í™•ì¸ ì‹œì‘...', 'info');

        const aiEndpoints = [
          '/api/ai/engines/status',
          '/api/ai/unified/status',
          '/api/ai/google-ai/status',
          '/api/ai/health',
        ];

        let successCount = 0;

        for (const endpoint of aiEndpoints) {
          try {
            log('ai-engine-result', `í…ŒìŠ¤íŠ¸: ${endpoint}`, 'info');
            const response = await fetch(`${BASE_URL}${endpoint}`);

            if (response.ok) {
              const data = await response.json();
              log(
                'ai-engine-result',
                `âœ… ${endpoint}: ${JSON.stringify(data, null, 2)}`,
                'success'
              );
              successCount++;
            } else {
              log(
                'ai-engine-result',
                `âŒ ${endpoint}: ${response.status} ${response.statusText}`,
                'error'
              );
            }
          } catch (error) {
            log(
              'ai-engine-result',
              `âŒ ${endpoint}: ${error.message}`,
              'error'
            );
          }

          await new Promise(resolve => setTimeout(resolve, 500));
        }

        testResults.aiEngine = successCount > 0;
        log(
          'ai-engine-result',
          `\nğŸ“Š AI ì—”ì§„ ìƒíƒœ: ${successCount}/${aiEndpoints.length} ì„±ê³µ`,
          successCount > 0 ? 'success' : 'error'
        );
        updateSummary();
      }

      async function testSmartFallbackAPI() {
        clearLog('fallback-result');
        log('fallback-result', 'Smart Fallback API í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'info');

        try {
          // GET ìš”ì²­ í…ŒìŠ¤íŠ¸
          log('fallback-result', '1. GET ìš”ì²­ í…ŒìŠ¤íŠ¸...', 'info');
          const getResponse = await fetch(`${BASE_URL}/api/ai/smart-fallback`);
          log(
            'fallback-result',
            `GET ì‘ë‹µ: ${getResponse.status} ${getResponse.statusText}`,
            getResponse.ok ? 'success' : 'warning'
          );

          if (getResponse.ok) {
            const getData = await getResponse.json();
            log(
              'fallback-result',
              `GET ë°ì´í„°: ${JSON.stringify(getData, null, 2)}`,
              'success'
            );
          }

          // POST ìš”ì²­ í…ŒìŠ¤íŠ¸
          log('fallback-result', '2. POST ìš”ì²­ í…ŒìŠ¤íŠ¸...', 'info');
          const postResponse = await fetch(
            `${BASE_URL}/api/ai/smart-fallback`,
            {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({
                query: 'í˜„ì¬ ì‹œìŠ¤í…œ ìƒíƒœë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”',
                context: 'dashboard',
              }),
            }
          );

          if (postResponse.ok) {
            const postData = await postResponse.json();
            log(
              'fallback-result',
              `POST ì„±ê³µ: ${JSON.stringify(postData, null, 2)}`,
              'success'
            );
            testResults.fallback = true;
          } else {
            const errorText = await postResponse.text();
            log(
              'fallback-result',
              `POST ì‹¤íŒ¨ (${postResponse.status}): ${errorText}`,
              'error'
            );
            testResults.fallback = false;
          }
        } catch (error) {
          log('fallback-result', `ì˜¤ë¥˜: ${error.message}`, 'error');
          testResults.fallback = false;
        }
        updateSummary();
      }

      async function testNaturalLanguageQueries() {
        clearLog('ai-query-result');
        log('ai-query-result', 'AI ìì—°ì–´ ì§ˆì˜ í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'info');

        const testQueries = [
          'í˜„ì¬ ì„œë²„ ìƒíƒœëŠ” ì–´ë–¤ê°€ìš”?',
          'CPU ì‚¬ìš©ë¥ ì´ ë†’ì€ ì„œë²„ë¥¼ ì°¾ì•„ì£¼ì„¸ìš”',
          'ë©”ëª¨ë¦¬ ë¶€ì¡± ê²½ê³ ê°€ ìˆëŠ” ì„œë²„ëŠ”?',
          'ë„¤íŠ¸ì›Œí¬ ìƒíƒœë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”',
        ];

        let successCount = 0;

        for (let i = 0; i < testQueries.length; i++) {
          const query = testQueries[i];
          log('ai-query-result', `\ní…ŒìŠ¤íŠ¸ ${i + 1}: "${query}"`, 'info');

          try {
            const response = await fetch(`${BASE_URL}/api/ai/smart-fallback`, {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({
                query: query,
                context: 'dashboard',
                timestamp: new Date().toISOString(),
              }),
            });

            if (response.ok) {
              const data = await response.json();
              log(
                'ai-query-result',
                `âœ… ì„±ê³µ: ${JSON.stringify(data, null, 2)}`,
                'success'
              );
              successCount++;
            } else {
              const errorText = await response.text();
              log(
                'ai-query-result',
                `âŒ ì‹¤íŒ¨ (${response.status}): ${errorText}`,
                'error'
              );
            }
          } catch (error) {
            log('ai-query-result', `âŒ ì˜¤ë¥˜: ${error.message}`, 'error');
          }

          await new Promise(resolve => setTimeout(resolve, 1000));
        }

        testResults.aiQuery = successCount === testQueries.length;
        log(
          'ai-query-result',
          `\nğŸ“Š ìì—°ì–´ ì§ˆì˜ ê²°ê³¼: ${successCount}/${testQueries.length} ì„±ê³µ`,
          successCount === testQueries.length ? 'success' : 'warning'
        );
        updateSummary();
      }

      async function testDashboardModal() {
        clearLog('modal-result');
        log('modal-result', 'ëŒ€ì‹œë³´ë“œ ì„œë²„ ëª¨ë‹¬ í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'info');

        try {
          // ì„œë²„ ë°ì´í„° API í…ŒìŠ¤íŠ¸
          log('modal-result', '1. ì„œë²„ ë°ì´í„° API í…ŒìŠ¤íŠ¸...', 'info');
          const serversResponse = await fetch(`${BASE_URL}/api/servers`);

          if (serversResponse.ok) {
            const serversData = await serversResponse.json();
            log(
              'modal-result',
              `ì„œë²„ ë°ì´í„° ë¡œë“œ ì„±ê³µ: ${serversData.length || 0}ê°œ ì„œë²„`,
              'success'
            );

            // ì„œë²„ ìƒì„¸ ì •ë³´ API í…ŒìŠ¤íŠ¸ (ì²« ë²ˆì§¸ ì„œë²„)
            if (serversData.length > 0) {
              const firstServer = serversData[0];
              log('modal-result', '2. ì„œë²„ ìƒì„¸ ì •ë³´ API í…ŒìŠ¤íŠ¸...', 'info');

              const serverDetailResponse = await fetch(
                `${BASE_URL}/api/servers/${firstServer.id}`
              );
              if (serverDetailResponse.ok) {
                const serverDetail = await serverDetailResponse.json();
                log(
                  'modal-result',
                  `ì„œë²„ ìƒì„¸ ì •ë³´ ë¡œë“œ ì„±ê³µ: ${JSON.stringify(serverDetail, null, 2)}`,
                  'success'
                );
                testResults.modal = true;
              } else {
                log(
                  'modal-result',
                  `ì„œë²„ ìƒì„¸ ì •ë³´ ë¡œë“œ ì‹¤íŒ¨: ${serverDetailResponse.status}`,
                  'warning'
                );
                testResults.modal = false;
              }
            } else {
              log('modal-result', 'í…ŒìŠ¤íŠ¸í•  ì„œë²„ê°€ ì—†ìŠµë‹ˆë‹¤', 'warning');
              testResults.modal = false;
            }
          } else {
            log(
              'modal-result',
              `ì„œë²„ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: ${serversResponse.status}`,
              'error'
            );
            testResults.modal = false;
          }

          // ì‹¤ì‹œê°„ ë©”íŠ¸ë¦­ API í…ŒìŠ¤íŠ¸
          log('modal-result', '3. ì‹¤ì‹œê°„ ë©”íŠ¸ë¦­ API í…ŒìŠ¤íŠ¸...', 'info');
          const metricsResponse = await fetch(
            `${BASE_URL}/api/metrics/performance`
          );
          if (metricsResponse.ok) {
            const metricsData = await metricsResponse.json();
            log('modal-result', `ì‹¤ì‹œê°„ ë©”íŠ¸ë¦­ ë¡œë“œ ì„±ê³µ`, 'success');
          } else {
            log(
              'modal-result',
              `ì‹¤ì‹œê°„ ë©”íŠ¸ë¦­ ë¡œë“œ ì‹¤íŒ¨: ${metricsResponse.status}`,
              'warning'
            );
          }
        } catch (error) {
          log('modal-result', `ì˜¤ë¥˜: ${error.message}`, 'error');
          testResults.modal = false;
        }
        updateSummary();
      }

      function updateSummary() {
        const summaryElement = document.getElementById('summary-result');
        let summary = 'ğŸ“Š ì¢…í•© í…ŒìŠ¤íŠ¸ ê²°ê³¼\n\n';

        summary += `ğŸ”— ê¸°ë³¸ ì—°ê²°: ${testResults.basic === null ? 'ë¯¸ì‹¤í–‰' : testResults.basic ? 'âœ… ì„±ê³µ' : 'âŒ ì‹¤íŒ¨'}\n`;
        summary += `ğŸ¤– AI ì—”ì§„: ${testResults.aiEngine === null ? 'ë¯¸ì‹¤í–‰' : testResults.aiEngine ? 'âœ… ì •ìƒ' : 'âŒ ë¬¸ì œìˆìŒ'}\n`;
        summary += `ğŸ”§ Smart Fallback: ${testResults.fallback === null ? 'ë¯¸ì‹¤í–‰' : testResults.fallback ? 'âœ… ìˆ˜ì •ë¨' : 'âŒ ë¬¸ì œìˆìŒ'}\n`;
        summary += `ğŸ’¬ AI ìì—°ì–´ ì§ˆì˜: ${testResults.aiQuery === null ? 'ë¯¸ì‹¤í–‰' : testResults.aiQuery ? 'âœ… ì •ìƒì‘ë™' : 'âŒ ë¬¸ì œìˆìŒ'}\n`;
        summary += `ğŸ¯ ëŒ€ì‹œë³´ë“œ ëª¨ë‹¬: ${testResults.modal === null ? 'ë¯¸ì‹¤í–‰' : testResults.modal ? 'âœ… ì•ˆì •í™”ë¨' : 'âŒ ë¬¸ì œìˆìŒ'}\n\n`;

        const allPassed = Object.values(testResults).every(
          result => result === true
        );
        const anyTested = Object.values(testResults).some(
          result => result !== null
        );

        if (anyTested) {
          if (allPassed) {
            summary +=
              'ğŸ‰ ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼! AI ì‹œìŠ¤í…œê³¼ ëŒ€ì‹œë³´ë“œê°€ ì •ìƒ ì‘ë™í•©ë‹ˆë‹¤.';
          } else {
            summary += 'âš ï¸ ì¼ë¶€ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨. ì¶”ê°€ í™•ì¸ì´ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.';
          }
        }

        summaryElement.textContent = summary;
      }

      // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ìœ¼ë¡œ ê¸°ë³¸ ì—°ê²° í…ŒìŠ¤íŠ¸
      window.onload = function () {
        log(
          'summary-result',
          'ğŸš€ ìƒˆë¡œìš´ Vercel ë°°í¬ í…ŒìŠ¤íŠ¸ ì¤€ë¹„ ì™„ë£Œ\ní´ë¦­í•˜ì—¬ ê° ê¸°ëŠ¥ì„ í…ŒìŠ¤íŠ¸í•˜ì„¸ìš”.',
          'info'
        );
        setTimeout(testBasicConnection, 1000);
      };
    </script>
  </body>
</html>
