<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ§  AI ì‹œìŠ¤í…œ ë™ì‘ ì‹œë®¬ë ˆì´ì…˜</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }

        .container {
            background: rgba(255, 255, 255, 0.1);
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .test-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .test-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .full-width {
            grid-column: 1 / -1;
        }

        .test-button {
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            margin: 5px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .test-button.secondary {
            background: linear-gradient(45deg, #74b9ff, #0984e3);
        }

        .test-button.warning {
            background: linear-gradient(45deg, #fdcb6e, #e17055);
        }

        .result {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.3);
            font-size: 12px;
        }

        .status {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            margin: 5px;
            font-size: 12px;
        }

        .status.success {
            background: #4CAF50;
        }

        .status.error {
            background: #F44336;
        }

        .status.warning {
            background: #FF9800;
        }

        .status.info {
            background: #2196F3;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, .3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .query-input {
            width: 100%;
            padding: 12px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 14px;
            margin: 10px 0;
        }

        .query-input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .scenario-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }

        .log-viewer {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .intent-analysis {
            background: rgba(0, 100, 200, 0.2);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            border: 1px solid rgba(100, 150, 255, 0.5);
        }

        .learning-trace {
            background: rgba(100, 200, 0, 0.2);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            border: 1px solid rgba(150, 255, 100, 0.5);
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ğŸ§  AI ì‹œìŠ¤í…œ ë™ì‘ ì‹œë®¬ë ˆì´ì…˜</h1>
        <p style="text-align: center; font-size: 1.1em; margin-bottom: 30px;">
            ë‚ ì§œ/ë‚ ì”¨ ì§ˆì˜, ì˜¤íƒ€ ì²˜ë¦¬, ì˜ë„ íŒŒì•…, í•™ìŠµ ê³¼ì •ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ê´€ì°°
        </p>

        <div class="test-grid">
            <!-- 1. ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸ -->
            <div class="test-section">
                <h3>ğŸ­ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸</h3>
                <div class="scenario-buttons">
                    <button class="test-button" onclick="testScenario('weather')">ë‚ ì”¨ ì§ˆì˜</button>
                    <button class="test-button" onclick="testScenario('date')">ë‚ ì§œ ì§ˆì˜</button>
                    <button class="test-button" onclick="testScenario('typo')">ì˜¤íƒ€ í¬í•¨</button>
                    <button class="test-button" onclick="testScenario('mixed')">ë³µí•© ì§ˆì˜</button>
                </div>
                <input type="text" class="query-input" id="customQuery" placeholder="ì§ì ‘ ì§ˆë¬¸ ì…ë ¥ (ì˜ˆ: ì˜¤ëŠ˜ ë‚ ì‹œëŠ” ì–´ë•Œìš”?)"
                    value="ì˜¤ëŠ˜ ë‚ ì‹œëŠ” ì–´ë•Œìš”? ê·¸ë¦¬ê³  ì§€ê¸ˆ ëª‡ì‹œì¸ê°€ìš”?">
                <button class="test-button secondary" onclick="testCustomQuery()">ì»¤ìŠ¤í…€ ì§ˆì˜ í…ŒìŠ¤íŠ¸</button>
                <div id="scenarioResult" class="result" style="display: none;"></div>
            </div>

            <!-- 2. AI ì—”ì§„ ìƒíƒœ -->
            <div class="test-section">
                <h3>âš™ï¸ AI ì—”ì§„ ìƒíƒœ</h3>
                <button class="test-button" onclick="checkEngineStatus()">ì—”ì§„ ìƒíƒœ í™•ì¸</button>
                <button class="test-button secondary" onclick="checkGoogleAIStatus()">Google AI ìƒíƒœ</button>
                <button class="test-button warning" onclick="simulateGoogleAIDown()">Google AI ë‹¤ìš´ ì‹œë®¬ë ˆì´ì…˜</button>
                <div id="engineResult" class="result" style="display: none;"></div>
            </div>

            <!-- 3. ì˜ë„ ë¶„ì„ -->
            <div class="test-section full-width">
                <h3>ğŸ¯ ì˜ë„ ë¶„ì„ ë° ì²˜ë¦¬ ê³¼ì •</h3>
                <button class="test-button" onclick="analyzeIntent()">ì˜ë„ ë¶„ì„ ì‹¤í–‰</button>
                <button class="test-button secondary" onclick="showTypoCorrection()">ì˜¤íƒ€ êµì • ê³¼ì •</button>
                <button class="test-button warning" onclick="showFallbackLogic()">í´ë°± ë¡œì§ í™•ì¸</button>

                <div class="intent-analysis" id="intentAnalysis" style="display: none;">
                    <h4>ğŸ¯ ì˜ë„ ë¶„ì„ ê²°ê³¼</h4>
                    <div id="intentContent"></div>
                </div>
            </div>

            <!-- 4. í•™ìŠµ ê³¼ì • ì¶”ì  -->
            <div class="test-section full-width">
                <h3>ğŸ“š í•™ìŠµ ê³¼ì • ì¶”ì </h3>
                <button class="test-button" onclick="traceLearning()">í•™ìŠµ ê³¼ì • ì¶”ì </button>
                <button class="test-button secondary" onclick="showLearningHistory()">í•™ìŠµ íˆìŠ¤í† ë¦¬</button>

                <div class="learning-trace" id="learningTrace" style="display: none;">
                    <h4>ğŸ“š í•™ìŠµ ê³¼ì •</h4>
                    <div id="learningContent"></div>
                </div>
            </div>

            <!-- 5. ì‹¤ì‹œê°„ ë¡œê·¸ -->
            <div class="test-section full-width">
                <h3>ğŸ“‹ ì‹¤ì‹œê°„ AI ë¡œê·¸</h3>
                <button class="test-button" onclick="startLogStream()">ë¡œê·¸ ìŠ¤íŠ¸ë¦¼ ì‹œì‘</button>
                <button class="test-button secondary" onclick="clearLogs()">ë¡œê·¸ ì§€ìš°ê¸°</button>

                <div class="log-viewer" id="logViewer">
                    <div style="color: #888;">ë¡œê·¸ ìŠ¤íŠ¸ë¦¼ ëŒ€ê¸° ì¤‘...</div>
                </div>
            </div>
        </div>

        <!-- ì‹¤ì‹œê°„ ìƒíƒœ -->
        <div class="test-section">
            <h3>ğŸ“Š ì‹¤ì‹œê°„ ìƒíƒœ</h3>
            <div id="realTimeStatus">
                <span class="status info">ì‹œë®¬ë ˆì´ì…˜ ì¤€ë¹„ ì™„ë£Œ</span>
            </div>
        </div>
    </div>

    <script>
        let logStream = [];
        let isLogging = false;

        // ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateStatus(message, type = 'info') {
            const statusDiv = document.getElementById('realTimeStatus');
            statusDiv.innerHTML = `<span class="status ${type}">${message}</span>`;
            addLog(`[STATUS] ${message}`, type);
        }

        // ë¡œë”© í‘œì‹œ
        function showLoading(elementId) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.innerHTML = '<div class="loading"></div> ì²˜ë¦¬ ì¤‘...';
        }

        // ê²°ê³¼ í‘œì‹œ
        function showResult(elementId, result, isSuccess = true) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.innerHTML = `
                <span class="status ${isSuccess ? 'success' : 'error'}">
                    ${isSuccess ? 'âœ… ì™„ë£Œ' : 'âŒ ì‹¤íŒ¨'}
                </span>
                <br><br>
                ${typeof result === 'object' ? JSON.stringify(result, null, 2) : result}
            `;
        }

        // ë¡œê·¸ ì¶”ê°€
        function addLog(message, type = 'info') {
            if (!isLogging) return;

            const timestamp = new Date().toLocaleTimeString('ko-KR');
            const logEntry = `[${timestamp}] ${message}`;
            logStream.push({ timestamp, message, type });

            const logViewer = document.getElementById('logViewer');
            const logDiv = document.createElement('div');
            logDiv.style.color = type === 'error' ? '#ff6b6b' :
                type === 'warning' ? '#fdcb6e' :
                    type === 'success' ? '#4CAF50' : '#74b9ff';
            logDiv.textContent = logEntry;
            logViewer.appendChild(logDiv);
            logViewer.scrollTop = logViewer.scrollHeight;
        }

        // 1. ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸
        async function testScenario(type) {
            const scenarios = {
                weather: "ì˜¤ëŠ˜ ë‚ ì”¨ëŠ” ì–´ë•Œìš”?",
                date: "ì§€ê¸ˆ ëª‡ì‹œì¸ê°€ìš”? ì˜¤ëŠ˜ ë‚ ì§œë„ ì•Œë ¤ì£¼ì„¸ìš”.",
                typo: "ì˜¤ëŠ˜ ë‚ ì‹œëŠ” ì–´ë–„ìš”? ê·¸ë¦¬ê³  ì§€ê¸ˆ ëª‡ì‹œì¸ê°€ì—¬?",
                mixed: "ì˜¤ëŠ˜ ë‚ ì”¨ì™€ ì‹œê°„ì„ ì•Œë ¤ì£¼ì„¸ìš”. ì„œë²„ ìƒíƒœë„ í™•ì¸í•´ì£¼ì„¸ìš”."
            };

            const query = scenarios[type];
            showLoading('scenarioResult');
            updateStatus(`${type} ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸ ì¤‘...`, 'info');
            addLog(`ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸ ì‹œì‘: ${type}`, 'info');
            addLog(`ì§ˆì˜: ${query}`, 'info');

            try {
                // 1ë‹¨ê³„: ì˜ë„ ë¶„ì„
                addLog('1ë‹¨ê³„: ì˜ë„ ë¶„ì„ ì‹œì‘', 'info');
                const intentResult = await analyzeQueryIntent(query);
                addLog(`ì˜ë„ ë¶„ì„ ê²°ê³¼: ${JSON.stringify(intentResult)}`, 'success');

                // 2ë‹¨ê³„: ì˜¤íƒ€ êµì • (Google AI ì—†ì´)
                addLog('2ë‹¨ê³„: ì˜¤íƒ€ êµì • (ë¡œì»¬ NLP)', 'info');
                const correctedQuery = await correctTypos(query);
                addLog(`êµì •ëœ ì§ˆì˜: ${correctedQuery}`, 'success');

                // 3ë‹¨ê³„: AI ì—”ì§„ ì²˜ë¦¬
                addLog('3ë‹¨ê³„: AI ì—”ì§„ ì²˜ë¦¬ ì‹œì‘', 'info');
                const response = await fetch('/api/ai/unified', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: 'analyze',
                        query: correctedQuery,
                        context: {
                            scenario: type,
                            originalQuery: query,
                            intentAnalysis: intentResult,
                            timestamp: new Date().toISOString()
                        }
                    })
                });

                const data = await response.json();
                addLog(`AI ì‘ë‹µ ìˆ˜ì‹ : ${response.status}`, response.ok ? 'success' : 'error');

                // 4ë‹¨ê³„: í•™ìŠµ ë°ì´í„° ì €ì¥
                addLog('4ë‹¨ê³„: í•™ìŠµ ë°ì´í„° ì €ì¥', 'info');
                await saveLearningData(query, correctedQuery, data, intentResult);

                showResult('scenarioResult', {
                    scenario: type,
                    originalQuery: query,
                    correctedQuery: correctedQuery,
                    intentAnalysis: intentResult,
                    aiResponse: data,
                    processingSteps: [
                        'ì˜ë„ ë¶„ì„ ì™„ë£Œ',
                        'ì˜¤íƒ€ êµì • ì™„ë£Œ',
                        'AI ì—”ì§„ ì²˜ë¦¬ ì™„ë£Œ',
                        'í•™ìŠµ ë°ì´í„° ì €ì¥ ì™„ë£Œ'
                    ]
                }, response.ok);

                updateStatus(`${type} ì‹œë‚˜ë¦¬ì˜¤ ì™„ë£Œ`, response.ok ? 'success' : 'warning');

            } catch (error) {
                addLog(`ì˜¤ë¥˜ ë°œìƒ: ${error.message}`, 'error');
                showResult('scenarioResult', `ì˜¤ë¥˜: ${error.message}`, false);
                updateStatus(`${type} ì‹œë‚˜ë¦¬ì˜¤ ì‹¤íŒ¨`, 'error');
            }
        }

        // ì»¤ìŠ¤í…€ ì§ˆì˜ í…ŒìŠ¤íŠ¸ (ìŠ¤ë§ˆíŠ¸ ì²˜ë¦¬ê¸° ì‚¬ìš©)
        async function testCustomQuery() {
            const query = document.getElementById('customQuery').value;
            if (!query.trim()) {
                alert('ì§ˆë¬¸ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            showLoading('scenarioResult');
            updateStatus('ìŠ¤ë§ˆíŠ¸ ì§ˆì˜ ì²˜ë¦¬ ì¤‘...', 'info');
            addLog(`ìŠ¤ë§ˆíŠ¸ ì§ˆì˜: ${query}`, 'info');

            try {
                // ìƒˆë¡œìš´ ìŠ¤ë§ˆíŠ¸ ì§ˆì˜ ì²˜ë¦¬ê¸° ì‚¬ìš©
                const response = await fetch('/api/ai/smart-query', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ query })
                });

                const data = await response.json();

                if (data.success) {
                    addLog(`ì˜ë„ ë¶„ì„: ${data.data.analysis.intent} (ì‹ ë¢°ë„: ${data.data.analysis.confidence}%)`, 'info');
                    addLog(`ë¡œì»¬ ì²˜ë¦¬ ê°€ëŠ¥: ${data.data.capabilities.canProcessLocally}`,
                        data.data.capabilities.canProcessLocally ? 'success' : 'warning');
                    addLog(`í•™ìŠµ í•„ìš”: ${data.data.capabilities.shouldLearn}`,
                        data.data.capabilities.shouldLearn ? 'info' : 'success');
                    addLog(`ì™¸ë¶€ API í•„ìš”: ${data.data.capabilities.requiresExternalAPI}`,
                        data.data.capabilities.requiresExternalAPI ? 'warning' : 'success');

                    if (data.data.analysis.hasTypos) {
                        addLog(`ì˜¤íƒ€ êµì •: "${data.data.analysis.originalQuery}" â†’ "${data.data.analysis.correctedQuery}"`, 'info');
                    }
                }

                showResult('scenarioResult', data, response.ok);
                updateStatus('ìŠ¤ë§ˆíŠ¸ ì§ˆì˜ ì™„ë£Œ', response.ok ? 'success' : 'warning');

            } catch (error) {
                showResult('scenarioResult', `ì˜¤ë¥˜: ${error.message}`, false);
                updateStatus('ìŠ¤ë§ˆíŠ¸ ì§ˆì˜ ì‹¤íŒ¨', 'error');
            }
        }

        // AI ì—”ì§„ ìƒíƒœ í™•ì¸
        async function checkEngineStatus() {
            showLoading('engineResult');
            updateStatus('AI ì—”ì§„ ìƒíƒœ í™•ì¸ ì¤‘...', 'info');
            addLog('AI ì—”ì§„ ìƒíƒœ í™•ì¸ ì‹œì‘', 'info');

            try {
                const response = await fetch('/api/ai/engines/status');
                const data = await response.json();

                if (data.success && data.data) {
                    const engines = data.data.engines;
                    const googleAI = engines.find(e => e.name === 'GoogleAI');

                    addLog(`ì´ ${engines.length}ê°œ ì—”ì§„ í™•ì¸`, 'info');
                    addLog(`Google AI ìƒíƒœ: ${googleAI ? googleAI.status : 'ì—†ìŒ'}`,
                        googleAI && googleAI.status === 'active' ? 'success' : 'warning');

                    engines.forEach(engine => {
                        addLog(`${engine.name}: ${engine.status} (${engine.requests}ê°œ ìš”ì²­)`,
                            engine.status === 'active' ? 'success' : 'warning');
                    });
                }

                showResult('engineResult', data, response.ok);
                updateStatus('AI ì—”ì§„ ìƒíƒœ í™•ì¸ ì™„ë£Œ', response.ok ? 'success' : 'error');

            } catch (error) {
                addLog(`ì—”ì§„ ìƒíƒœ í™•ì¸ ì˜¤ë¥˜: ${error.message}`, 'error');
                showResult('engineResult', `ì˜¤ë¥˜: ${error.message}`, false);
                updateStatus('AI ì—”ì§„ ìƒíƒœ í™•ì¸ ì‹¤íŒ¨', 'error');
            }
        }

        // Google AI ìƒíƒœ í™•ì¸
        async function checkGoogleAIStatus() {
            showLoading('engineResult');
            updateStatus('Google AI ìƒíƒœ í™•ì¸ ì¤‘...', 'info');
            addLog('Google AI ìƒíƒœ í™•ì¸ ì‹œì‘', 'info');

            try {
                const response = await fetch('/api/ai/google-ai/status');
                const data = await response.json();

                if (data.success && data.data) {
                    addLog(`Google AI ì¤€ë¹„ ìƒíƒœ: ${data.data.demo.ready}`,
                        data.data.demo.ready ? 'success' : 'warning');
                    addLog(`API í‚¤ ì†ŒìŠ¤: ${data.data.apiKey.source}`, 'info');
                    addLog(`í™˜ê²½ë³€ìˆ˜ QUOTA_PROTECTION: ${data.data.environment.GOOGLE_AI_QUOTA_PROTECTION}`, 'info');
                }

                showResult('engineResult', data, response.ok);
                updateStatus('Google AI ìƒíƒœ í™•ì¸ ì™„ë£Œ', response.ok ? 'success' : 'error');

            } catch (error) {
                addLog(`Google AI ìƒíƒœ í™•ì¸ ì˜¤ë¥˜: ${error.message}`, 'error');
                showResult('engineResult', `ì˜¤ë¥˜: ${error.message}`, false);
                updateStatus('Google AI ìƒíƒœ í™•ì¸ ì‹¤íŒ¨', 'error');
            }
        }

        // Google AI ë‹¤ìš´ ì‹œë®¬ë ˆì´ì…˜
        async function simulateGoogleAIDown() {
            updateStatus('Google AI ë‹¤ìš´ ì‹œë®¬ë ˆì´ì…˜ ì¤‘...', 'warning');
            addLog('Google AI ë‹¤ìš´ ìƒí™© ì‹œë®¬ë ˆì´ì…˜ ì‹œì‘', 'warning');

            // í´ë°± ë¡œì§ í…ŒìŠ¤íŠ¸
            const testQuery = "ì˜¤ëŠ˜ ë‚ ì”¨ëŠ” ì–´ë•Œìš”?";
            addLog(`í…ŒìŠ¤íŠ¸ ì§ˆì˜: ${testQuery}`, 'info');
            addLog('Google AI ì—†ì´ ë¡œì»¬ NLP ì—”ì§„ë§Œ ì‚¬ìš©', 'warning');

            try {
                // ë¡œì»¬ NLP ì²˜ë¦¬ ì‹œë®¬ë ˆì´ì…˜
                const localResult = await processWithLocalNLP(testQuery);
                addLog('ë¡œì»¬ NLP ì²˜ë¦¬ ì™„ë£Œ', 'success');

                showResult('engineResult', {
                    scenario: 'Google AI Down Simulation',
                    query: testQuery,
                    localNLPResult: localResult,
                    fallbackEngines: ['KoreanNLP', 'EnhancedAI', 'IntegratedAI'],
                    message: 'Google AI ì—†ì´ë„ ê¸°ë³¸ì ì¸ ì˜ë„ íŒŒì•…ê³¼ ì‘ë‹µ ìƒì„± ê°€ëŠ¥'
                }, true);

                updateStatus('Google AI ë‹¤ìš´ ì‹œë®¬ë ˆì´ì…˜ ì™„ë£Œ', 'success');

            } catch (error) {
                addLog(`ì‹œë®¬ë ˆì´ì…˜ ì˜¤ë¥˜: ${error.message}`, 'error');
                updateStatus('ì‹œë®¬ë ˆì´ì…˜ ì‹¤íŒ¨', 'error');
            }
        }

        // ì˜ë„ ë¶„ì„
        async function analyzeIntent() {
            const query = document.getElementById('customQuery').value || "ì˜¤ëŠ˜ ë‚ ì‹œëŠ” ì–´ë–„ìš”?";
            updateStatus('ì˜ë„ ë¶„ì„ ì¤‘...', 'info');
            addLog(`ì˜ë„ ë¶„ì„ ëŒ€ìƒ: ${query}`, 'info');

            const intentAnalysis = await analyzeQueryIntent(query);

            document.getElementById('intentAnalysis').style.display = 'block';
            document.getElementById('intentContent').innerHTML = `
                <strong>ì›ë³¸ ì§ˆì˜:</strong> ${query}<br>
                <strong>ê°ì§€ëœ ì˜ë„:</strong> ${intentAnalysis.intent}<br>
                <strong>ì‹ ë¢°ë„:</strong> ${intentAnalysis.confidence}%<br>
                <strong>í‚¤ì›Œë“œ:</strong> ${intentAnalysis.keywords.join(', ')}<br>
                <strong>ì¹´í…Œê³ ë¦¬:</strong> ${intentAnalysis.category}<br>
                <strong>ì˜¤íƒ€ ê°ì§€:</strong> ${intentAnalysis.hasTypos ? 'ìˆìŒ' : 'ì—†ìŒ'}<br>
                <strong>ì²˜ë¦¬ ë°©ë²•:</strong> ${intentAnalysis.processingMethod}
            `;

            updateStatus('ì˜ë„ ë¶„ì„ ì™„ë£Œ', 'success');
        }

        // ì˜¤íƒ€ êµì • ê³¼ì • í‘œì‹œ
        async function showTypoCorrection() {
            const query = "ì˜¤ëŠ˜ ë‚ ì‹œëŠ” ì–´ë–„ìš”? ê·¸ë¦¬ê³  ì§€ê¸ˆ ëª‡ì‹œì¸ê°€ì—¬?";
            updateStatus('ì˜¤íƒ€ êµì • ê³¼ì • ë¶„ì„ ì¤‘...', 'info');
            addLog(`ì˜¤íƒ€ êµì • ëŒ€ìƒ: ${query}`, 'info');

            const corrected = await correctTypos(query);

            document.getElementById('intentAnalysis').style.display = 'block';
            document.getElementById('intentContent').innerHTML = `
                <strong>ì›ë³¸:</strong> ${query}<br>
                <strong>êµì •ë¨:</strong> ${corrected}<br>
                <strong>êµì • ë°©ë²•:</strong> ë¡œì»¬ í•œêµ­ì–´ ì‚¬ì „ + ìœ ì‚¬ë„ ë§¤ì¹­<br>
                <strong>êµì •ëœ ë‹¨ì–´:</strong><br>
                - "ë‚ ì‹œ" â†’ "ë‚ ì”¨"<br>
                - "ì–´ë–„ìš”" â†’ "ì–´ë•Œìš”"<br>
                - "ëª‡ì‹œì¸ê°€ì—¬" â†’ "ëª‡ì‹œì¸ê°€ìš”"<br>
                <strong>ì‚¬ìš© ì—”ì§„:</strong> KoreanNLP (Google AI ë¶ˆí•„ìš”)
            `;

            updateStatus('ì˜¤íƒ€ êµì • ë¶„ì„ ì™„ë£Œ', 'success');
        }

        // í´ë°± ë¡œì§ í™•ì¸
        async function showFallbackLogic() {
            updateStatus('í´ë°± ë¡œì§ ë¶„ì„ ì¤‘...', 'info');

            document.getElementById('intentAnalysis').style.display = 'block';
            document.getElementById('intentContent').innerHTML = `
                <strong>í´ë°± ë¡œì§ ìˆœì„œ:</strong><br>
                1. Google AI (Gemini) - í˜„ì¬ ìƒíƒœ: ${await checkGoogleAIAvailable() ? 'í™œì„±' : 'ë¹„í™œì„±'}<br>
                2. UnifiedAI Engine (MCP + RAG)<br>
                3. HybridEngine (ë‹¤ì¤‘ ì—”ì§„ ì¡°í•©)<br>
                4. ë¡œì»¬ NLP ì—”ì§„ë“¤ (KoreanNLP, EnhancedAI, IntegratedAI)<br>
                5. ì •ì  ì‘ë‹µ í…œí”Œë¦¿<br><br>
                
                <strong>Google AI ì—†ì´ ì²˜ë¦¬ ê°€ëŠ¥í•œ ê¸°ëŠ¥:</strong><br>
                - í•œêµ­ì–´ ì˜¤íƒ€ êµì • (hangul-js + korean-utils)<br>
                - ê¸°ë³¸ ì˜ë„ íŒŒì•… (compromise + natural)<br>
                - í‚¤ì›Œë“œ ì¶”ì¶œ ë° ë¶„ë¥˜<br>
                - ì„œë²„ ëª¨ë‹ˆí„°ë§ ê´€ë ¨ ì§ˆì˜ ì²˜ë¦¬<br>
                - ì •ì  ì •ë³´ ì œê³µ (ë‚ ì§œ, ì‹œê°„ ë“±)<br><br>
                
                <strong>ì œí•œì‚¬í•­:</strong><br>
                - ì‹¤ì‹œê°„ ë‚ ì”¨ ì •ë³´ (ì™¸ë¶€ API í•„ìš”)<br>
                - ë³µì¡í•œ ìì—°ì–´ ìƒì„±<br>
                - ê³ ê¸‰ ì¶”ë¡  ë° ë¶„ì„
            `;

            updateStatus('í´ë°± ë¡œì§ ë¶„ì„ ì™„ë£Œ', 'success');
        }

        // í•™ìŠµ ê³¼ì • ì¶”ì 
        async function traceLearning() {
            updateStatus('í•™ìŠµ ê³¼ì • ì¶”ì  ì¤‘...', 'info');
            addLog('í•™ìŠµ ê³¼ì • ì¶”ì  ì‹œì‘', 'info');

            const query = "ì˜¤ëŠ˜ ë‚ ì”¨ ì•Œë ¤ì¤˜";
            addLog(`í•™ìŠµ ëŒ€ìƒ ì§ˆì˜: ${query}`, 'info');

            document.getElementById('learningTrace').style.display = 'block';
            document.getElementById('learningContent').innerHTML = `
                <strong>í•™ìŠµ ë‹¨ê³„:</strong><br>
                1. ì§ˆì˜ ìˆ˜ì§‘: "${query}"<br>
                2. ì „ì²˜ë¦¬: í† í°í™”, ì •ê·œí™”<br>
                3. ì˜ë„ ë¶„ë¥˜: weather_inquiry (ì‹ ë¢°ë„: 95%)<br>
                4. ì‘ë‹µ ìƒì„±: ë‹¤ì¤‘ ì—”ì§„ ì¡°í•©<br>
                5. í”¼ë“œë°± ìˆ˜ì§‘: ì‚¬ìš©ì ë§Œì¡±ë„<br>
                6. ëª¨ë¸ ì—…ë°ì´íŠ¸: ê°€ì¤‘ì¹˜ ì¡°ì •<br><br>
                
                <strong>í•™ìŠµ ë°ì´í„° ì €ì¥:</strong><br>
                - ì§ˆì˜-ì‘ë‹µ ìŒ ì €ì¥<br>
                - ì˜ë„ ë¶„ë¥˜ ì •í™•ë„ ê¸°ë¡<br>
                - ì‘ë‹µ í’ˆì§ˆ í‰ê°€<br>
                - ì˜¤íƒ€ êµì • íŒ¨í„´ í•™ìŠµ<br><br>
                
                <strong>ì‹¤ì‹œê°„ í•™ìŠµ:</strong><br>
                - ìƒˆë¡œìš´ ì§ˆì˜ íŒ¨í„´ ê°ì§€<br>
                - ì‘ë‹µ í’ˆì§ˆ ìë™ í‰ê°€<br>
                - ì‚¬ìš©ì í”¼ë“œë°± ë°˜ì˜<br>
                - ëª¨ë¸ ì„±ëŠ¥ ì§€ì† ê°œì„ 
            `;

            addLog('í•™ìŠµ ê³¼ì • ì¶”ì  ì™„ë£Œ', 'success');
            updateStatus('í•™ìŠµ ê³¼ì • ì¶”ì  ì™„ë£Œ', 'success');
        }

        // í•™ìŠµ íˆìŠ¤í† ë¦¬ í‘œì‹œ
        async function showLearningHistory() {
            updateStatus('í•™ìŠµ íˆìŠ¤í† ë¦¬ ì¡°íšŒ ì¤‘...', 'info');

            try {
                // ì‹¤ì œ í•™ìŠµ íˆìŠ¤í† ë¦¬ API í˜¸ì¶œ (ìˆë‹¤ë©´)
                const mockHistory = {
                    totalQueries: 1247,
                    weatherQueries: 89,
                    dateTimeQueries: 156,
                    typoCorrections: 234,
                    averageAccuracy: 87.3,
                    recentLearning: [
                        { query: "ì˜¤ëŠ˜ ë‚ ì”¨", corrected: "ì˜¤ëŠ˜ ë‚ ì”¨", accuracy: 95 },
                        { query: "ì§€ê¸ˆ ëª‡ì‹œ", corrected: "ì§€ê¸ˆ ëª‡ì‹œ", accuracy: 98 },
                        { query: "ë‚ ì‹œ ì–´ë•Œ", corrected: "ë‚ ì”¨ ì–´ë•Œ", accuracy: 92 }
                    ]
                };

                document.getElementById('learningTrace').style.display = 'block';
                document.getElementById('learningContent').innerHTML = `
                    <strong>í•™ìŠµ í†µê³„:</strong><br>
                    - ì´ ì²˜ë¦¬ ì§ˆì˜: ${mockHistory.totalQueries}ê°œ<br>
                    - ë‚ ì”¨ ê´€ë ¨: ${mockHistory.weatherQueries}ê°œ<br>
                    - ì‹œê°„/ë‚ ì§œ ê´€ë ¨: ${mockHistory.dateTimeQueries}ê°œ<br>
                    - ì˜¤íƒ€ êµì •: ${mockHistory.typoCorrections}ê°œ<br>
                    - í‰ê·  ì •í™•ë„: ${mockHistory.averageAccuracy}%<br><br>
                    
                    <strong>ìµœê·¼ í•™ìŠµ ì‚¬ë¡€:</strong><br>
                    ${mockHistory.recentLearning.map(item =>
                    `- "${item.query}" â†’ "${item.corrected}" (ì •í™•ë„: ${item.accuracy}%)`
                ).join('<br>')}
                `;

                updateStatus('í•™ìŠµ íˆìŠ¤í† ë¦¬ ì¡°íšŒ ì™„ë£Œ', 'success');

            } catch (error) {
                addLog(`í•™ìŠµ íˆìŠ¤í† ë¦¬ ì¡°íšŒ ì˜¤ë¥˜: ${error.message}`, 'error');
                updateStatus('í•™ìŠµ íˆìŠ¤í† ë¦¬ ì¡°íšŒ ì‹¤íŒ¨', 'error');
            }
        }

        // ë¡œê·¸ ìŠ¤íŠ¸ë¦¼ ì‹œì‘
        function startLogStream() {
            isLogging = !isLogging;
            const button = event.target;

            if (isLogging) {
                button.textContent = 'ë¡œê·¸ ìŠ¤íŠ¸ë¦¼ ì¤‘ì§€';
                button.style.background = 'linear-gradient(45deg, #e17055, #d63031)';
                updateStatus('ë¡œê·¸ ìŠ¤íŠ¸ë¦¼ ì‹œì‘ë¨', 'success');
                addLog('ë¡œê·¸ ìŠ¤íŠ¸ë¦¼ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
            } else {
                button.textContent = 'ë¡œê·¸ ìŠ¤íŠ¸ë¦¼ ì‹œì‘';
                button.style.background = 'linear-gradient(45deg, #FF6B6B, #4ECDC4)';
                updateStatus('ë¡œê·¸ ìŠ¤íŠ¸ë¦¼ ì¤‘ì§€ë¨', 'info');
            }
        }

        // ë¡œê·¸ ì§€ìš°ê¸°
        function clearLogs() {
            logStream = [];
            document.getElementById('logViewer').innerHTML = '<div style="color: #888;">ë¡œê·¸ê°€ ì§€ì›Œì¡ŒìŠµë‹ˆë‹¤.</div>';
            updateStatus('ë¡œê·¸ ì§€ì›Œì§', 'info');
        }

        // í—¬í¼ í•¨ìˆ˜ë“¤
        async function analyzeQueryIntent(query) {
            // ë¡œì»¬ ì˜ë„ ë¶„ì„ ì‹œë®¬ë ˆì´ì…˜
            const weatherKeywords = ['ë‚ ì”¨', 'ë‚ ì‹œ', 'ê¸°ì˜¨', 'ì˜¨ë„', 'ë¹„', 'ëˆˆ', 'ë§‘ìŒ'];
            const timeKeywords = ['ì‹œê°„', 'ëª‡ì‹œ', 'ë‚ ì§œ', 'ì˜¤ëŠ˜', 'ì§€ê¸ˆ'];

            const hasWeather = weatherKeywords.some(keyword => query.includes(keyword));
            const hasTime = timeKeywords.some(keyword => query.includes(keyword));
            const hasTypos = query.includes('ë‚ ì‹œ') || query.includes('ì–´ë–„') || query.includes('ëª‡ì‹œì¸ê°€ì—¬');

            return {
                intent: hasWeather && hasTime ? 'weather_and_time' : hasWeather ? 'weather' : hasTime ? 'time' : 'general',
                confidence: hasWeather || hasTime ? 90 : 60,
                keywords: query.split(' ').filter(word => word.length > 1),
                category: hasWeather ? 'weather' : hasTime ? 'datetime' : 'general',
                hasTypos: hasTypos,
                processingMethod: 'local_nlp'
            };
        }

        async function correctTypos(query) {
            // ë¡œì»¬ ì˜¤íƒ€ êµì • ì‹œë®¬ë ˆì´ì…˜
            return query
                .replace(/ë‚ ì‹œ/g, 'ë‚ ì”¨')
                .replace(/ì–´ë–„ìš”/g, 'ì–´ë•Œìš”')
                .replace(/ëª‡ì‹œì¸ê°€ì—¬/g, 'ëª‡ì‹œì¸ê°€ìš”')
                .replace(/ì–´ë–„/g, 'ì–´ë•Œ');
        }

        async function processWithLocalNLP(query) {
            // ë¡œì»¬ NLP ì²˜ë¦¬ ì‹œë®¬ë ˆì´ì…˜
            const intent = await analyzeQueryIntent(query);
            const corrected = await correctTypos(query);

            return {
                originalQuery: query,
                correctedQuery: corrected,
                intent: intent,
                response: intent.category === 'weather' ?
                    'ì£„ì†¡í•©ë‹ˆë‹¤. ì‹¤ì‹œê°„ ë‚ ì”¨ ì •ë³´ëŠ” ì™¸ë¶€ APIê°€ í•„ìš”í•©ë‹ˆë‹¤. í˜„ì¬ ì‹œê°„ì€ ' + new Date().toLocaleString('ko-KR') + ' ì…ë‹ˆë‹¤.' :
                    intent.category === 'datetime' ?
                        'í˜„ì¬ ì‹œê°„: ' + new Date().toLocaleString('ko-KR') :
                        'ì§ˆë¬¸ì„ ì´í•´í–ˆì§€ë§Œ êµ¬ì²´ì ì¸ ë‹µë³€ì„ ìœ„í•´ì„œëŠ” ì¶”ê°€ ì •ë³´ê°€ í•„ìš”í•©ë‹ˆë‹¤.',
                engines: ['KoreanNLP', 'EnhancedAI', 'IntegratedAI']
            };
        }

        async function saveLearningData(original, corrected, response, intent) {
            // í•™ìŠµ ë°ì´í„° ì €ì¥ ì‹œë®¬ë ˆì´ì…˜
            addLog('í•™ìŠµ ë°ì´í„° ì €ì¥ ì¤‘...', 'info');
            await new Promise(resolve => setTimeout(resolve, 500));
            addLog('í•™ìŠµ ë°ì´í„° ì €ì¥ ì™„ë£Œ', 'success');
        }

        async function checkGoogleAIAvailable() {
            try {
                const response = await fetch('/api/ai/google-ai/status');
                const data = await response.json();
                return data.success && data.data && data.data.demo.ready;
            } catch {
                return false;
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.addEventListener('load', function () {
            updateStatus('ğŸ§  AI ì‹œìŠ¤í…œ ì‹œë®¬ë ˆì´ì…˜ ì¤€ë¹„ ì™„ë£Œ', 'success');
            addLog('ì‹œë®¬ë ˆì´ì…˜ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì™„ë£Œ', 'success');
        });
    </script>
</body>

</html>