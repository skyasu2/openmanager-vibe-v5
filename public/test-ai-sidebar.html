<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¤– AI ì‚¬ì´ë“œë°” & MCP ì„œë²„ ì—°ë™ í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }

        .container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #4f46e5;
            text-align: center;
            margin-bottom: 30px;
        }

        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            background: #f9fafb;
        }

        .test-button {
            background: #4f46e5;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
            transition: background 0.2s;
        }

        .test-button:hover {
            background: #3730a3;
        }

        .test-button:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }

        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 6px;
            background: #f3f4f6;
            border-left: 4px solid #10b981;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }

        .error {
            border-left-color: #ef4444;
            background: #fef2f2;
            color: #dc2626;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-online {
            background: #10b981;
        }

        .status-offline {
            background: #ef4444;
        }

        .status-warning {
            background: #f59e0b;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #4f46e5;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 8px;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ğŸ¤– AI ì‚¬ì´ë“œë°” & MCP ì„œë²„ ì—°ë™ í…ŒìŠ¤íŠ¸</h1>

        <div class="test-section">
            <h3>ğŸ“Š ì‹œìŠ¤í…œ ìƒíƒœ í™•ì¸</h3>
            <p>í˜„ì¬ ì‹œìŠ¤í…œì˜ ì „ë°˜ì ì¸ ìƒíƒœë¥¼ í™•ì¸í•©ë‹ˆë‹¤.</p>
            <button class="test-button" onclick="checkSystemStatus()">ì‹œìŠ¤í…œ ìƒíƒœ í™•ì¸</button>
            <div id="system-status-result" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ”— MCP ì„œë²„ ì—°ê²° í…ŒìŠ¤íŠ¸</h3>
            <p>Renderì—ì„œ ì‹¤í–‰ ì¤‘ì¸ MCP ì„œë²„ì™€ì˜ ì—°ê²°ì„ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.</p>
            <button class="test-button" onclick="testMCPConnection()">MCP ì—°ê²° í…ŒìŠ¤íŠ¸</button>
            <div id="mcp-result" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ§  AI ì—”ì§„ ìƒíƒœ í™•ì¸</h3>
            <p>AI ì—”ì§„ë“¤ì˜ ìƒíƒœì™€ ì„±ëŠ¥ì„ í™•ì¸í•©ë‹ˆë‹¤.</p>
            <button class="test-button" onclick="checkAIEngines()">AI ì—”ì§„ ìƒíƒœ</button>
            <div id="ai-engines-result" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ’¬ ìì—°ì–´ ì‘ë‹µ í…ŒìŠ¤íŠ¸</h3>
            <p>AI ì‚¬ì´ë“œë°”ì˜ ìì—°ì–´ ì‘ë‹µ ê¸°ëŠ¥ì„ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.</p>
            <div class="grid">
                <button class="test-button" onclick="testNaturalLanguage('í˜„ì¬ ì„œë²„ ìƒíƒœë¥¼ ë¶„ì„í•´ì£¼ì„¸ìš”')">ì„œë²„ ìƒíƒœ ë¶„ì„</button>
                <button class="test-button" onclick="testNaturalLanguage('CPU ì‚¬ìš©ëŸ‰ì´ ë†’ì€ ì„œë²„ë¥¼ ì°¾ì•„ì£¼ì„¸ìš”')">CPU ë¶„ì„</button>
                <button class="test-button" onclick="testNaturalLanguage('ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ë¶„ì„í•´ì£¼ì„¸ìš”')">ë©”ëª¨ë¦¬ ë¶„ì„</button>
                <button class="test-button" onclick="testNaturalLanguage('ìµœê·¼ ì—ëŸ¬ ë¡œê·¸ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”')">ì—ëŸ¬ ë¡œê·¸ í™•ì¸</button>
            </div>
            <div id="natural-language-result" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ“‹ ì¥ì• ë³´ê³ ì„œ ìƒì„± í…ŒìŠ¤íŠ¸</h3>
            <p>ìë™ ì¥ì• ë³´ê³ ì„œ ìƒì„± ê¸°ëŠ¥ì„ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.</p>
            <button class="test-button" onclick="testIncidentReport()">ì¥ì• ë³´ê³ ì„œ ìƒì„±</button>
            <div id="incident-report-result" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ”„ ì‹¤ì‹œê°„ ì„œë²„ ë°ì´í„° í™•ì¸</h3>
            <p>ì„œë²„ë°ì´í„° ìƒì„±ê¸°ê°€ ìƒì„±í•˜ëŠ” ì‹¤ì‹œê°„ ë°ì´í„°ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.</p>
            <button class="test-button" onclick="checkServerData()">ì„œë²„ ë°ì´í„° í™•ì¸</button>
            <div id="server-data-result" class="result" style="display: none;"></div>
        </div>
    </div>

    <script>
        const BASE_URL = window.location.origin;

        function showLoading(elementId) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.innerHTML = '<span class="loading"></span>í…ŒìŠ¤íŠ¸ ì§„í–‰ ì¤‘...';
            element.className = 'result';
        }

        function showResult(elementId, data, isError = false) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.innerHTML = typeof data === 'string' ? data : JSON.stringify(data, null, 2);
            element.className = isError ? 'result error' : 'result';
        }

        async function checkSystemStatus() {
            showLoading('system-status-result');
            try {
                const response = await fetch(`${BASE_URL}/api/health`);
                const data = await response.json();
                showResult('system-status-result', `âœ… ì‹œìŠ¤í…œ ì •ìƒ ì‘ë™
ì‹œê°„: ${new Date().toLocaleString()}
ìƒíƒœ: ${data.status || 'ì •ìƒ'}
ì‘ë‹µì‹œê°„: ${response.headers.get('x-response-time') || 'N/A'}

ìƒì„¸ ì •ë³´:
${JSON.stringify(data, null, 2)}`);
            } catch (error) {
                showResult('system-status-result', `âŒ ì‹œìŠ¤í…œ ìƒíƒœ í™•ì¸ ì‹¤íŒ¨: ${error.message}`, true);
            }
        }

        async function testMCPConnection() {
            showLoading('mcp-result');
            try {
                const response = await fetch(`${BASE_URL}/api/system/mcp-status`);
                const data = await response.json();

                const renderStatus = data.mcp?.servers?.render;
                const statusText = renderStatus?.healthy ? 'âœ… ì •ìƒ' : 'âŒ ì˜¤ë¥˜';

                showResult('mcp-result', `ğŸ”— MCP ì„œë²„ ì—°ê²° í…ŒìŠ¤íŠ¸ ê²°ê³¼

Render MCP ì„œë²„: ${statusText}
URL: ${renderStatus?.url || 'N/A'}
IPs: ${renderStatus?.ips?.join(', ') || 'N/A'}
í¬íŠ¸: ${renderStatus?.port || 'N/A'}
ì§€ì—°ì‹œê°„: ${renderStatus?.latency || 'N/A'}ms
ì—…íƒ€ì„: ${renderStatus?.uptime || 'N/A'}ì´ˆ
ë²„ì „: ${renderStatus?.version || 'N/A'}

ì „ì²´ ì‘ë‹µ:
${JSON.stringify(data, null, 2)}`);
            } catch (error) {
                showResult('mcp-result', `âŒ MCP ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`, true);
            }
        }

        async function checkAIEngines() {
            showLoading('ai-engines-result');
            try {
                const response = await fetch(`${BASE_URL}/api/ai/engines/status`);
                const data = await response.json();

                if (data.success) {
                    const engines = data.data.engines;
                    const activeEngines = engines.filter(e => e.status === 'active').length;

                    let result = `ğŸ§  AI ì—”ì§„ ìƒíƒœ (${activeEngines}/${engines.length} í™œì„±í™”)

`;
                    engines.forEach(engine => {
                        const statusIcon = engine.status === 'active' ? 'âœ…' : 'âš ï¸';
                        result += `${statusIcon} ${engine.name}: ${engine.status} (${engine.responseTime}ms)
   íƒ€ì…: ${engine.type} | ë²„ì „: ${engine.version}
   ì„¤ëª…: ${engine.description}

`;
                    });

                    result += `ğŸ“Š ì „ì²´ ë©”íŠ¸ë¦­:
- ì´ ì—”ì§„: ${data.data.metrics.totalEngines}ê°œ
- í™œì„± ì—”ì§„: ${data.data.metrics.activeEngines}ê°œ
- í‰ê·  ì‘ë‹µì‹œê°„: ${data.data.metrics.averageResponseTime}ms
- ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: ${data.data.metrics.lastUpdated}`;

                    showResult('ai-engines-result', result);
                } else {
                    showResult('ai-engines-result', `âŒ AI ì—”ì§„ ìƒíƒœ í™•ì¸ ì‹¤íŒ¨: ${data.error}`, true);
                }
            } catch (error) {
                showResult('ai-engines-result', `âŒ AI ì—”ì§„ ìƒíƒœ í™•ì¸ ì‹¤íŒ¨: ${error.message}`, true);
            }
        }

        async function testNaturalLanguage(query) {
            showLoading('natural-language-result');
            try {
                const response = await fetch(`${BASE_URL}/api/ai/smart-query?q=${encodeURIComponent(query)}`);

                if (response.ok) {
                    const data = await response.json();
                    showResult('natural-language-result', `ğŸ’¬ ìì—°ì–´ ì‘ë‹µ í…ŒìŠ¤íŠ¸ ì„±ê³µ

ì§ˆë¬¸: "${query}"

ì‘ë‹µ:
${data.answer || data.response || JSON.stringify(data, null, 2)}`);
                } else {
                    showResult('natural-language-result', `âš ï¸ ì‘ë‹µ ìƒíƒœ: ${response.status}
ë‚´ìš©: ${await response.text()}`, true);
                }
            } catch (error) {
                showResult('natural-language-result', `âŒ ìì—°ì–´ ì‘ë‹µ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`, true);
            }
        }

        async function testIncidentReport() {
            showLoading('incident-report-result');
            try {
                // ì¥ì• ë³´ê³ ì„œ API í…ŒìŠ¤íŠ¸ (ì‹¤ì œ êµ¬í˜„ì— ë”°ë¼ ì¡°ì • í•„ìš”)
                const response = await fetch(`${BASE_URL}/api/ai/auto-report`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        type: 'incident',
                        context: 'ai_sidebar_test'
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    showResult('incident-report-result', `ğŸ“‹ ì¥ì• ë³´ê³ ì„œ ìƒì„± í…ŒìŠ¤íŠ¸ ì„±ê³µ

${JSON.stringify(data, null, 2)}`);
                } else {
                    showResult('incident-report-result', `âš ï¸ ì‘ë‹µ ìƒíƒœ: ${response.status}
ë‚´ìš©: ${await response.text()}`, true);
                }
            } catch (error) {
                showResult('incident-report-result', `âŒ ì¥ì• ë³´ê³ ì„œ ìƒì„± ì‹¤íŒ¨: ${error.message}`, true);
            }
        }

        async function checkServerData() {
            showLoading('server-data-result');
            try {
                const response = await fetch(`${BASE_URL}/api/servers/realtime?type=servers`);
                const data = await response.json();

                if (data.success && data.data) {
                    const servers = data.data;
                    const runningServers = servers.filter(s => s.status === 'running').length;
                    const errorServers = servers.filter(s => s.status === 'error').length;
                    const warningServers = servers.filter(s => s.status === 'warning').length;

                    showResult('server-data-result', `ğŸ”„ ì„œë²„ë°ì´í„° ìƒì„±ê¸° ìƒíƒœ

ì´ ì„œë²„: ${servers.length}ê°œ
- ì •ìƒ: ${runningServers}ê°œ
- ì˜¤ë¥˜: ${errorServers}ê°œ  
- ê²½ê³ : ${warningServers}ê°œ

ìµœê·¼ ì„œë²„ ìƒ˜í”Œ (ì²˜ìŒ 3ê°œ):
${servers.slice(0, 3).map(server =>
                        `- ${server.name}: ${server.status} (CPU: ${server.metrics?.cpu || 'N/A'}%, Memory: ${server.metrics?.memory || 'N/A'}%)`
                    ).join('\n')}

ë°ì´í„° ìƒì„± ì‹œê°„: ${new Date().toLocaleString()}`);
                } else {
                    showResult('server-data-result', `âŒ ì„œë²„ ë°ì´í„° í™•ì¸ ì‹¤íŒ¨: ${data.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`, true);
                }
            } catch (error) {
                showResult('server-data-result', `âŒ ì„œë²„ ë°ì´í„° í™•ì¸ ì‹¤íŒ¨: ${error.message}`, true);
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ìœ¼ë¡œ ì‹œìŠ¤í…œ ìƒíƒœ í™•ì¸
        window.addEventListener('load', () => {
            checkSystemStatus();
        });
    </script>
</body>

</html>