<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google AI API í…ŒìŠ¤íŠ¸ - OpenManager VIBE</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 8px;
            padding: 24px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 24px;
            padding: 16px;
            border: 1px solid #e1e5e9;
            border-radius: 6px;
        }
        textarea {
            width: 100%;
            min-height: 80px;
            padding: 12px;
            border: 1px solid #d0d7de;
            border-radius: 6px;
            font-family: inherit;
            resize: vertical;
        }
        button {
            background: #0969da;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            margin: 8px 4px 8px 0;
        }
        button:hover {
            background: #0860ca;
        }
        button:disabled {
            background: #8c959f;
            cursor: not-allowed;
        }
        .result {
            margin-top: 16px;
            padding: 12px;
            border-radius: 6px;
            white-space: pre-wrap;
            font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;
            font-size: 14px;
            max-height: 300px;
            overflow-y: auto;
        }
        .result.success {
            background: #dafbe1;
            border: 1px solid #28a745;
        }
        .result.error {
            background: #ffeaea;
            border: 1px solid #dc3545;
        }
        .result.loading {
            background: #e1f5fe;
            border: 1px solid #0969da;
        }
        .preset-buttons {
            margin: 12px 0;
        }
        .preset-buttons button {
            font-size: 12px;
            padding: 4px 8px;
        }
        .status {
            text-align: center;
            padding: 12px;
            margin-bottom: 20px;
            border-radius: 6px;
            font-weight: 500;
        }
        .status.ready {
            background: #dafbe1;
            color: #1a7f37;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¤– í†µí•© AI API í…ŒìŠ¤íŠ¸</h1>
        <div class="status ready">âœ… ë² ë¥´ì…€ í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œ í…ŒìŠ¤íŠ¸ ì¤‘</div>

        <div class="test-section">
            <h3>ğŸ’¬ ìì—°ì–´ ì§ˆì˜ í…ŒìŠ¤íŠ¸</h3>
            <textarea id="promptInput" placeholder="ìì—°ì–´ ì§ˆì˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”...">ì•ˆë…•í•˜ì„¸ìš”! í˜„ì¬ ì„œë²„ ìƒíƒœë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.</textarea>

            <div class="preset-buttons">
                <button onclick="setPreset('ì„œë²„ ìƒíƒœ')">ì„œë²„ ìƒíƒœ í™•ì¸</button>
                <button onclick="setPreset('ì„±ëŠ¥ ë¶„ì„')">ì„±ëŠ¥ ë¶„ì„</button>
                <button onclick="setPreset('ë¬¸ì œ í•´ê²°')">ë¬¸ì œ í•´ê²°</button>
                <button onclick="setPreset('ì¼ë°˜ ì§ˆë¬¸')">ì¼ë°˜ ì§ˆë¬¸</button>
            </div>

            <button onclick="testUnifiedAI()" id="testBtn">ğŸš€ í†µí•© AI í…ŒìŠ¤íŠ¸</button>
            <button onclick="clearResult()">ğŸ—‘ï¸ ê²°ê³¼ ì§€ìš°ê¸°</button>

            <div id="result" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ“Š í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤</h3>
            <button onclick="runAllTests()">ğŸ”„ ì „ì²´ ì‹œë‚˜ë¦¬ì˜¤ ì‹¤í–‰</button>
            <div id="scenarioResults"></div>
        </div>
    </div>

    <script>
        const API_BASE = window.location.origin;

        const presets = {
            'ì„œë²„ ìƒíƒœ': 'í˜„ì¬ ì„œë²„ë“¤ì˜ ìƒíƒœë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”. CPU, ë©”ëª¨ë¦¬, ë„¤íŠ¸ì›Œí¬ ì‚¬ìš©ë¥ ì€ ì–´ë–¤ê°€ìš”?',
            'ì„±ëŠ¥ ë¶„ì„': 'ì‹œìŠ¤í…œ ì„±ëŠ¥ì— ë¬¸ì œê°€ ìˆë‚˜ìš”? ì‘ë‹µì‹œê°„ì´ ëŠë¦° ì„œë²„ê°€ ìˆëŠ”ì§€ ë¶„ì„í•´ì£¼ì„¸ìš”.',
            'ë¬¸ì œ í•´ê²°': 'ìµœê·¼ì— ë°œìƒí•œ ì¥ì• ë‚˜ ê²½ê³ ê°€ ìˆë‚˜ìš”? í•´ê²° ë°©ë²•ì„ ì œì•ˆí•´ì£¼ì„¸ìš”.',
            'ì¼ë°˜ ì§ˆë¬¸': 'OpenManager VIBE ì‹œìŠ¤í…œì— ëŒ€í•´ ì„¤ëª…í•´ì£¼ì„¸ìš”.'
        };

        function setPreset(type) {
            document.getElementById('promptInput').value = presets[type];
        }

        async function testUnifiedAI() {
            const prompt = document.getElementById('promptInput').value.trim();
            if (!prompt) {
                alert('ì§ˆì˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            await sendRequest('/api/ai/unified-stream', {
                messages: [{ role: 'user', content: prompt }]
            }, 'Unified AI');
        }

        async function sendRequest(endpoint, payload, mode) {
            const resultDiv = document.getElementById('result');
            const testBtn = document.getElementById('testBtn');

            resultDiv.style.display = 'block';
            resultDiv.className = 'result loading';
            resultDiv.textContent = `ğŸ”„ ${mode} í…ŒìŠ¤íŠ¸ ì¤‘...`;

            testBtn.disabled = true;

            try {
                const startTime = Date.now();

                const response = await fetch(API_BASE + endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-AI-Assistant': 'true'
                    },
                    body: JSON.stringify(payload)
                });

                const responseTime = Date.now() - startTime;
                const data = await response.json();

                if (response.ok) {
                    resultDiv.className = 'result success';
                    resultDiv.textContent = `âœ… ${mode} ì‘ë‹µ ì„±ê³µ (${responseTime}ms)\n\n` +
                        `ğŸ“ ì‘ë‹µ:\n${data.response || data.data || JSON.stringify(data, null, 2)}`;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `âŒ ${mode} ì˜¤ë¥˜ (${response.status})\n\n` +
                        `${data.error || data.message || JSON.stringify(data, null, 2)}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `âŒ ${mode} ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜:\n${error.message}`;
            } finally {
                testBtn.disabled = false;
            }
        }

        async function runAllTests() {
            const scenarios = [
                { query: 'ì•ˆë…•í•˜ì„¸ìš”!', category: 'greeting', name: 'ì¸ì‚¬ í…ŒìŠ¤íŠ¸' },
                { query: 'ì„œë²„ ìƒíƒœë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”', category: 'server_status', name: 'ì„œë²„ ìƒíƒœ' },
                { query: 'ì„±ëŠ¥ì´ ì €í•˜ëœ ì„œë²„ê°€ ìˆë‚˜ìš”?', category: 'performance', name: 'ì„±ëŠ¥ ë¶„ì„' },
                { query: 'ë„¤íŠ¸ì›Œí¬ ì—°ê²° ì˜¤ë¥˜ë¥¼ í•´ê²°í•´ì£¼ì„¸ìš”', category: 'troubleshooting', name: 'ë¬¸ì œ í•´ê²°' }
            ];

            const resultsDiv = document.getElementById('scenarioResults');
            resultsDiv.innerHTML = '<h4>ğŸ”„ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘...</h4>';

            for (const scenario of scenarios) {
                resultsDiv.innerHTML += `<p>â³ ${scenario.name} í…ŒìŠ¤íŠ¸ ì¤‘...</p>`;

                try {
                    const startTime = Date.now();
                    const response = await fetch(API_BASE + '/api/ai/unified-stream', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-AI-Assistant': 'true'
                        },
                        body: JSON.stringify({
                            messages: [{ role: 'user', content: scenario.query }]
                        })
                    });

                    const responseTime = Date.now() - startTime;
                    const data = await response.json();

                    if (response.ok) {
                        resultsDiv.innerHTML += `<p>âœ… ${scenario.name}: ì„±ê³µ (${responseTime}ms)</p>`;
                    } else {
                        resultsDiv.innerHTML += `<p>âŒ ${scenario.name}: ì‹¤íŒ¨ (${response.status})</p>`;
                    }
                } catch (error) {
                    resultsDiv.innerHTML += `<p>âŒ ${scenario.name}: ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜</p>`;
                }
            }

            resultsDiv.innerHTML += '<h4>âœ… ì „ì²´ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸ ì™„ë£Œ</h4>';
        }

        function clearResult() {
            const resultDiv = document.getElementById('result');
            resultDiv.style.display = 'none';
            resultDiv.textContent = '';

            const scenarioDiv = document.getElementById('scenarioResults');
            scenarioDiv.innerHTML = '';
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ API ìƒíƒœ í™•ì¸
        window.onload = async function() {
            try {
                const response = await fetch(API_BASE + '/api/ai/google-ai/generate');
                if (response.status === 200) {
                    console.log('âœ… Google AI API ì—”ë“œí¬ì¸íŠ¸ ì ‘ê·¼ ê°€ëŠ¥');
                }
            } catch (error) {
                console.error('âŒ API ìƒíƒœ í™•ì¸ ì‹¤íŒ¨:', error);
            }
        };
    </script>
</body>
</html>
