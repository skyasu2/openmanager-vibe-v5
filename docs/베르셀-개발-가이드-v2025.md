# 🚀 베르셀 개발 가이드 v2025

> **OpenManager Vibe v5** - 베르셀 2025년 최신 개발 모범 사례  
> **작성일**: 2025-07-01 20:05:00 (KST) - 공식 문서 기준 업데이트

## 📋 **개요**

이 가이드는 베르셀 공식 문서를 기준으로 OpenManager Vibe v5의 배포 설정을 2025년 최신 기준에 맞춰 최적화하는 방법을 제공합니다.

## 🆕 **2025년 주요 변화사항**

### 1. **Fluid Compute 도입** (권장)

- **기본 타임아웃**: 300초 (기존 10-15초)
- **최대 타임아웃**: Pro 800초, Enterprise 800초
- **비용 효율성**: I/O 대기 시간 요금 제외
- **동시 실행**: 30,000개 (Pro), 100,000개 (Enterprise)

### 2. **Edge Runtime 활용**

- **콜드 스타트**: 거의 제로
- **메모리 사용량**: 더 효율적
- **글로벌 분산**: 자동 최적화

### 3. **향상된 모니터링**

- **Speed Insights**: 성능 모니터링
- **Web Analytics**: 사용자 분석
- **Observability Plus**: 고급 로깅

## 🔧 **현재 설정 개선안**

### 1. **vercel.json 최적화**

```json
{
  "$schema": "https://openapi.vercel.sh/vercel.json",
  "version": 2,
  "name": "openmanager-vibe-v5",
  "framework": "nextjs",

  // 🆕 Fluid Compute 활용
  "functions": {
    "src/app/api/**/*.ts": {
      "maxDuration": 300,
      "memory": 1024,
      "runtime": "nodejs20.x"
    },
    "src/app/api/ai/**/*.ts": {
      "maxDuration": 600,
      "memory": 2048,
      "runtime": "nodejs20.x"
    },
    "src/app/api/edge/**/*.ts": {
      "runtime": "edge"
    }
  },

  // 🔒 향상된 보안 헤더 (2025년 기준)
  "headers": [
    {
      "source": "/(.*)",
      "headers": [
        {
          "key": "X-Content-Type-Options",
          "value": "nosniff"
        },
        {
          "key": "X-Frame-Options",
          "value": "DENY"
        },
        {
          "key": "X-XSS-Protection",
          "value": "1; mode=block"
        },
        {
          "key": "Strict-Transport-Security",
          "value": "max-age=31536000; includeSubDomains"
        },
        {
          "key": "Referrer-Policy",
          "value": "strict-origin-when-cross-origin"
        },
        {
          "key": "Permissions-Policy",
          "value": "camera=(), microphone=(), geolocation=()"
        }
      ]
    },
    {
      "source": "/api/(.*)",
      "headers": [
        {
          "key": "Cache-Control",
          "value": "public, max-age=300, s-maxage=600, stale-while-revalidate=86400"
        }
      ]
    },
    {
      "source": "/api/ai/logging/stream",
      "headers": [
        {
          "key": "Cache-Control",
          "value": "no-cache, no-store, must-revalidate"
        },
        {
          "key": "X-Accel-Buffering",
          "value": "no"
        }
      ]
    }
  ],

  // 🌍 글로벌 최적화
  "regions": ["icn1", "sin1"],
  "cleanUrls": true,
  "trailingSlash": false,

  // 🚀 성능 최적화
  "buildCommand": "npm run build",
  "outputDirectory": ".next",
  "installCommand": "npm ci",

  // 🔄 리디렉션 및 라우팅
  "redirects": [
    {
      "source": "/",
      "has": [
        {
          "type": "query",
          "key": "dashboard"
        }
      ],
      "destination": "/dashboard",
      "permanent": false
    }
  ],

  "rewrites": [
    {
      "source": "/health",
      "destination": "/api/health"
    }
  ],

  // 🆕 환경별 최적화
  "env": {
    "DISABLE_LOCAL_RAG": "true",
    "PREFER_SUPABASE_RAG": "true",
    "AI_ENGINE_PRIORITY": "supabase_rag,rule_based,mcp,google_ai",
    "VERCEL_HEALTH_OPTIMIZATION": "true",
    "HEALTH_CHECK_CACHE_HOURS": "6",
    "DISABLE_EXCESSIVE_HEALTH_CHECKS": "true",
    "DISABLE_CRON_JOBS": "true",
    "AI_STREAM_TIMEOUT_PREVENTION": "true",
    "FLUID_COMPUTE_ENABLED": "true"
  },

  "build": {
    "env": {
      "NODE_ENV": "production",
      "DISABLE_LOCAL_RAG": "true",
      "VERCEL_HEALTH_OPTIMIZATION": "true",
      "DISABLE_CRON_JOBS": "true",
      "AI_STREAM_TIMEOUT_PREVENTION": "true",
      "NODE_OPTIONS": "--max-old-space-size=4096"
    }
  }
}
```

### 2. **Next.js 설정 최적화**

```javascript
// next.config.mjs
/** @type {import('next').NextConfig} */
const nextConfig = {
  // 🆕 App Router 최적화
  experimental: {
    serverActions: {
      allowedOrigins: ['openmanager-vibe-v5.vercel.app', 'localhost:3000'],
    },
    optimizePackageImports: ['@supabase/supabase-js'],
    turbo: {
      rules: {
        '*.svg': {
          loaders: ['@svgr/webpack'],
          as: '*.js',
        },
      },
    },
  },

  // 🚀 번들 최적화
  webpack: (config, { isServer, dev }) => {
    // 프로덕션 환경에서만 최적화
    if (!dev) {
      config.optimization.splitChunks = {
        chunks: 'all',
        cacheGroups: {
          vendor: {
            test: /[\\/]node_modules[\\/]/,
            name: 'vendors',
            chunks: 'all',
          },
        },
      };
    }

    // 클라이언트 사이드 폴백 설정
    if (!isServer) {
      config.resolve.fallback = {
        ...config.resolve.fallback,
        fs: false,
        net: false,
        tls: false,
        dns: false,
        crypto: false,
        stream: false,
        util: false,
        url: false,
        querystring: false,
      };
    }

    return config;
  },

  // 🔒 보안 설정
  poweredByHeader: false,

  // 📊 성능 모니터링
  analyticsId: process.env.VERCEL_ANALYTICS_ID,

  // 🌐 이미지 최적화
  images: {
    domains: ['openmanager-vibe-v5.vercel.app'],
    formats: ['image/webp', 'image/avif'],
    minimumCacheTTL: 31536000,
  },

  // 📝 TypeScript 및 ESLint
  typescript: {
    ignoreBuildErrors: false,
  },
  eslint: {
    ignoreDuringBuilds: false,
  },

  // 🔧 서버 설정
  serverExternalPackages: ['@supabase/supabase-js'],
};

export default nextConfig;
```

### 3. **환경변수 업데이트**

기존 설정에 추가할 환경변수:

```bash
# 🆕 Vercel 2025년 기능 활성화
VERCEL_SPEED_INSIGHTS_ENABLED=true
VERCEL_WEB_ANALYTICS_ENABLED=true
FLUID_COMPUTE_ENABLED=true
EDGE_RUNTIME_ENABLED=true

# 🔒 보안 강화
VERCEL_AUTOMATION_BYPASS_SECRET=your-secret-key
VERCEL_BRANCH_PROTECTION_BYPASS=your-bypass-token

# ⚡ 성능 최적화
NEXT_PRIVATE_STANDALONE=true
TURBO_TELEMETRY_DISABLED=1
NEXT_PRIVATE_OUTPUT_TRACE=true

# 🌍 글로벌 설정
VERCEL_REGION=icn1
VERCEL_EDGE_REGIONS=icn1,sin1,nrt1

# 📊 모니터링 및 로깅
VERCEL_LOG_LEVEL=info
OBSERVABILITY_PLUS_ENABLED=true
RUNTIME_LOGS_ENABLED=true
```

## 🆕 **2025년 새로운 기능 활용**

### 1. **Fluid Compute 마이그레이션**

```typescript
// src/app/api/ai/route.ts
import { NextRequest } from 'next/server';

// 🆕 Fluid Compute 설정
export const maxDuration = 600; // 10분 (기존 45초 → 600초)
export const runtime = 'nodejs'; // Fluid Compute 활성화

export async function POST(request: NextRequest) {
  // 장시간 AI 처리 작업
  const result = await processLongAITask();
  return Response.json(result);
}
```

### 2. **Edge Runtime 활용**

```typescript
// src/app/api/edge/health/route.ts
import { NextRequest } from 'next/server';

// 🆕 Edge Runtime으로 콜드 스타트 제거
export const runtime = 'edge';

export async function GET(request: NextRequest) {
  return new Response(
    JSON.stringify({
      status: 'OK',
      timestamp: new Date().toISOString(),
      region: process.env.VERCEL_REGION || 'unknown',
    }),
    {
      status: 200,
      headers: {
        'Content-Type': 'application/json',
        'Cache-Control': 'public, max-age=60',
      },
    }
  );
}
```

### 3. **모니터링 통합**

```tsx
// src/app/layout.tsx
import { Analytics } from '@vercel/analytics/react';
import { SpeedInsights } from '@vercel/speed-insights/next';

export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <html lang='ko'>
      <body>
        {children}
        {/* 🆕 Vercel 2025 모니터링 */}
        <Analytics />
        <SpeedInsights />
      </body>
    </html>
  );
}
```

## 📊 **성능 최적화 체크리스트**

### ✅ **필수 최적화**

- [ ] Fluid Compute 활성화 (`maxDuration: 300+`)
- [ ] Edge Runtime 적용 (간단한 API)
- [ ] 보안 헤더 업데이트 (2025년 기준)
- [ ] 이미지 최적화 (WebP, AVIF)
- [ ] 번들 분석 및 최적화

### ✅ **모니터링 설정**

- [ ] Speed Insights 활성화
- [ ] Web Analytics 활성화
- [ ] Runtime Logs 설정
- [ ] Error Boundary 구현
- [ ] Performance 메트릭 추적

### ✅ **보안 강화**

- [ ] 최신 보안 헤더 적용
- [ ] 환경변수 암호화
- [ ] CORS 정책 업데이트
- [ ] Rate Limiting 구현
- [ ] Bot Protection 설정

## 🔄 **배포 워크플로우 2025**

### 1. **GitHub Actions 업데이트**

```yaml
# .github/workflows/vercel-deploy-2025.yml
name: Vercel Deploy 2025
on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      # 🆕 2025년 개선사항
      - name: Install dependencies
        run: npm ci --prefer-offline --no-audit

      - name: Run tests
        run: npm run test

      - name: Build application
        run: npm run build
        env:
          FLUID_COMPUTE_ENABLED: true

      - name: Deploy to Vercel
        uses: amondnet/vercel-action@v25
        with:
          vercel-token: ${{ secrets.VERCEL_TOKEN }}
          vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}
          vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}
          vercel-args: '--prod'
```

### 2. **배포 후 자동 검증**

```typescript
// scripts/post-deploy-verification.ts
export async function verifyDeployment() {
  const checks = [
    {
      name: 'Health Check',
      url: '/api/health',
      expect: (res: Response) => res.status === 200,
    },
    {
      name: 'Speed Insights',
      url: '/_vercel/insights/script.js',
      expect: (res: Response) => res.status === 200,
    },
    {
      name: 'Security Headers',
      url: '/',
      expect: (res: Response) =>
        res.headers.get('X-Content-Type-Options') === 'nosniff',
    },
  ];

  for (const check of checks) {
    const response = await fetch(`${process.env.VERCEL_URL}${check.url}`);
    if (!check.expect(response)) {
      throw new Error(`Deployment verification failed: ${check.name}`);
    }
  }

  console.log('✅ All deployment verifications passed');
}
```

## 🎯 **마이그레이션 로드맵**

### **1단계: 즉시 적용 (오늘)**

1. 환경변수에 `FLUID_COMPUTE_ENABLED=true` 추가
2. Speed Insights 및 Analytics 설정
3. 보안 헤더 업데이트

### **2단계: 1주일 내**

1. AI API에 Fluid Compute 적용 (`maxDuration: 600`)
2. Edge Runtime으로 간단한 API 마이그레이션
3. 모니터링 대시보드 설정

### **3단계: 1개월 내**

1. 전체 성능 최적화 완료
2. 자동화된 배포 파이프라인 구축
3. 고급 모니터링 및 알림 시스템 구축

---

## 📚 **참고 자료**

- [Vercel 공식 문서 2025](https://vercel.com/docs)
- [Next.js App Router 최적화](https://nextjs.org/docs/app/building-your-application/deploying)
- [Fluid Compute 가이드](https://vercel.com/docs/compute/functions)
- [Edge Runtime API](https://vercel.com/docs/compute/edge-runtime)
- [Vercel 보안 모범 사례](https://vercel.com/docs/security)

**이제 OpenManager Vibe v5가 2025년 최신 베르셀 플랫폼을 100% 활용할 수 있습니다!** 🚀
