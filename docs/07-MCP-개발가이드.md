# ğŸ§  MCP ê¸°ë°˜ í†µí•© AI ì—”ì§„ ê°œë°œ ê°€ì´ë“œ

## ğŸ“‹ ê°œìš”

**OpenManager Vibe v5**ì˜ í•µì‹¬ì¸ **MCP (Model Context Protocol) ê¸°ë°˜ í†µí•© AI ì—”ì§„** ê°œë°œ ê°€ì´ë“œì…ë‹ˆë‹¤.

> **ğŸ¯ 4ë‹¨ê³„ ì™„ì„±**: ì§€ëŠ¥í˜• ë„êµ¬ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜, ì»¨í…ìŠ¤íŠ¸ ì¸ì‹ ì²˜ë¦¬, í•˜ì´ë¸Œë¦¬ë“œ AI ì²˜ë¦¬, ì™„ë²½í•œ ë³µì›ë ¥

---

## ğŸ—ï¸ MCP ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            ğŸ§  MCP Orchestrator (Model Context Protocol)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ¯ Intelligent Tool Selection  â”‚  âš¡ Hybrid Tool Execution   â”‚
â”‚  - Natural Language â†’ Tools     â”‚  - Parallel: stats, anomaly â”‚
â”‚  - Context-aware Selection      â”‚  - Sequential: root cause   â”‚
â”‚  - Auto-optimization             â”‚  - Adaptive Processing      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“Š 6 Specialized Tools          â”‚  ğŸ§  Context Manager        â”‚
â”‚  - statistical_analysis         â”‚  - Short/Long-term Memory  â”‚
â”‚  - anomaly_detection            â”‚  - Pattern Learning        â”‚
â”‚  - time_series_forecast         â”‚  - Session Tracking        â”‚
â”‚  - pattern_recognition          â”‚  - Trend Calculation       â”‚
â”‚  - root_cause_analysis          â”‚  - Business Rules Engine   â”‚
â”‚  - optimization_advisor         â”‚  - Auto Memory Cleanup     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ Python ML Bridge            â”‚  ğŸ’¾ Advanced Caching       â”‚
â”‚  - Render Service Primary       â”‚  - Hash-based Keys         â”‚
â”‚  - Local JS Fallback           â”‚  - TTL Management (5min)   â”‚
â”‚  - Exponential Backoff         â”‚  - Performance Tracking    â”‚
â”‚  - AbortController Timeout     â”‚  - Hit Rate Optimization   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§  í•µì‹¬ ì»´í¬ë„ŒíŠ¸

### 1. MCP ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´í„° (`src/core/mcp/mcp-orchestrator.ts`)

#### ğŸ¯ ì£¼ìš” ê¸°ëŠ¥
- **ìì—°ì–´ ì¿¼ë¦¬ ë¶„ì„**: í‚¤ì›Œë“œ ê¸°ë°˜ ë„êµ¬ ìë™ ì„ íƒ
- **ì»¨í…ìŠ¤íŠ¸ ì¸ì‹ ì²˜ë¦¬**: ì—…ë¬´ì‹œê°„, ì‹œìŠ¤í…œ ë¶€í•˜, ì´ì „ ê²°ê³¼ ë°˜ì˜
- **í•˜ì´ë¸Œë¦¬ë“œ ì‹¤í–‰**: ë³‘ë ¬/ìˆœì°¨ ì‹¤í–‰ ì „ëµ ìë™ ì„ íƒ
- **ê²°ê³¼ í†µí•©**: ë‹¤ì¤‘ ë„êµ¬ ê²°ê³¼ì˜ ì§€ëŠ¥í˜• ê²°í•©

#### ğŸ”§ ì‚¬ìš©ë²•
```typescript
import { MCPOrchestrator, MCPRequest } from '@/core/mcp/mcp-orchestrator';

const orchestrator = new MCPOrchestrator();

const request: MCPRequest = {
  query: "ì‹œìŠ¤í…œ ì„±ëŠ¥ì„ ë¶„ì„í•˜ê³  ìµœì í™” ë°©ì•ˆì„ ì œì•ˆí•´ì£¼ì„¸ìš”",
  parameters: {
    metrics: serverMetrics,
    data: historicalData
  },
  context: {
    session_id: "user_session_123",
    urgency: "high"
  }
};

const result = await orchestrator.process(request);
console.log('ë¶„ì„ ê²°ê³¼:', result);
```

### 2. ì»¨í…ìŠ¤íŠ¸ ê´€ë¦¬ì (`src/core/context/context-manager.ts`)

#### ğŸ§  ì§€ëŠ¥í˜• ë©”ëª¨ë¦¬ ì‹œìŠ¤í…œ
- **ë‹¨ê¸° ë©”ëª¨ë¦¬**: Map ê¸°ë°˜, 1ì‹œê°„ TTL
- **ì¥ê¸° ë©”ëª¨ë¦¬**: ì¤‘ìš” íŒ¨í„´ ì˜êµ¬ ì €ì¥ (ì¤‘ìš”ë„ 0.8+)
- **ì„¸ì…˜ ì»¨í…ìŠ¤íŠ¸**: ì‚¬ìš©ìë³„ ì¿¼ë¦¬/ê²°ê³¼ íˆìŠ¤í† ë¦¬

#### ğŸ“ˆ ì‹¤ì‹œê°„ íŠ¸ë Œë“œ ê³„ì‚°
```typescript
import { ContextManager } from '@/core/context/context-manager';

const contextManager = new ContextManager();

// ë©”íŠ¸ë¦­ ì¶”ê°€ ë° íŠ¸ë Œë“œ ê³„ì‚°
await contextManager.addMetric('cpu_usage', cpuData);
const trend = await contextManager.calculateTrend('cpu_usage');

console.log('CPU íŠ¸ë Œë“œ:', trend.direction, trend.confidence);
```

### 3. Python ML ë¸Œë¦¿ì§€ (`src/services/python-bridge/ml-bridge.ts`)

#### ğŸŒ í•˜ì´ë¸Œë¦¬ë“œ ì²˜ë¦¬
- **Primary**: Render Python ì„œë¹„ìŠ¤ (ê³ ê¸‰ ML)
- **Fallback**: ë¡œì»¬ JavaScript (ê¸°ë³¸ í†µê³„)
- **ìë™ ì „í™˜**: ë„¤íŠ¸ì›Œí¬ ìƒíƒœ ê¸°ë°˜

#### ğŸ”§ ì‚¬ìš©ë²•
```typescript
import { PythonMLBridge } from '@/services/python-bridge/ml-bridge';

const bridge = new PythonMLBridge(process.env.AI_ENGINE_URL!);

// ê³ ê¸‰ ë¶„ì„ (Python ìš°ì„ , ì‹¤íŒ¨ì‹œ ë¡œì»¬ í´ë°±)
const result = await bridge.call('statistical_analysis', {
  data: timeSeriesData,
  detailed: true
});

console.log('ë¶„ì„ ê²°ê³¼:', result);
console.log('ë¸Œë¦¿ì§€ í†µê³„:', bridge.getMetrics());
```

---

## ğŸ› ï¸ ê°œë°œ ê°€ì´ë“œ

### 1. ìƒˆë¡œìš´ MCP ë„êµ¬ ì¶”ê°€

```typescript
// src/core/mcp/tools/custom-tool.ts
export class CustomAnalysisTool implements MCPTool {
  name = 'custom_analysis';
  description = 'ì‚¬ìš©ì ì •ì˜ ë¶„ì„ ë„êµ¬';

  async execute(params: any, context: any): Promise<any> {
    // ë„êµ¬ ë¡œì§ êµ¬í˜„
    return {
      analysis_type: 'custom',
      result: analysisResult,
      confidence: 0.85
    };
  }
}

// ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´í„°ì— ë“±ë¡
orchestrator.registerTool(new CustomAnalysisTool());
```

### 2. ì»¨í…ìŠ¤íŠ¸ ê·œì¹™ ì¶”ê°€

```typescript
// src/core/context/business-rules.ts
export class CustomBusinessRule implements BusinessRule {
  name = 'high_cpu_alert';
  condition = (context: any) => context.cpu_usage > 90;
  
  apply(context: any): any {
    return {
      priority: 'critical',
      recommended_tools: ['anomaly_detection', 'optimization_advisor'],
      alert_level: 'high'
    };
  }
}
```

### 3. ë¡œì»¬ í´ë°± ê¸°ëŠ¥ í™•ì¥

```typescript
// Python ë¸Œë¦¿ì§€ì— ìƒˆë¡œìš´ ë¡œì»¬ ë¶„ì„ ì¶”ê°€
private async localCustomAnalysis(params: any): Promise<any> {
  // JavaScript ê¸°ë°˜ ë¶„ì„ êµ¬í˜„
  const result = performLocalAnalysis(params.data);
  
  return {
    analysis_type: 'custom_local',
    result,
    fallback_used: true,
    confidence: 0.6
  };
}
```

---

## ğŸ“Š API ì‚¬ìš©ë²•

### 1. MCP ì „ìš© ì—”ë“œí¬ì¸íŠ¸ (`/api/ai/mcp`)

```bash
# POST ìš”ì²­ - AI ë¶„ì„
curl -X POST http://localhost:3000/api/ai/mcp \
  -H "Content-Type: application/json" \
  -d '{
    "query": "CPU ì‚¬ìš©ë¥  ê¸‰ì¦ ì›ì¸ ë¶„ì„",
    "parameters": {
      "metrics": {
        "cpu": [45, 67, 89, 95, 92],
        "memory": [60, 65, 70, 75, 80]
      }
    },
    "context": {
      "session_id": "analysis_session",
      "urgency": "high"
    }
  }'

# GET ìš”ì²­ - ì‹œìŠ¤í…œ ìƒíƒœ
curl http://localhost:3000/api/ai/mcp?action=health
```

### 2. V1 í†µí•© ì—”ë“œí¬ì¸íŠ¸ (`/api/v1/ai/query`)

```bash
# MCP ìš°ì„  ì‹¤í–‰, ì‹¤íŒ¨ì‹œ UnifiedAIEngine í´ë°±
curl -X POST http://localhost:3000/api/v1/ai/query \
  -H "Content-Type: application/json" \
  -d '{
    "query": "ì„œë²„ ì„±ëŠ¥ ì˜ˆì¸¡ ë¶„ì„",
    "context": {
      "serverMetrics": [...],
      "timeRange": {...}
    }
  }'
```

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ê°œë°œ

### 1. MCP ë„êµ¬ í…ŒìŠ¤íŠ¸

```typescript
// tests/mcp/tool.test.ts
import { MCPOrchestrator } from '@/core/mcp/mcp-orchestrator';

describe('MCP Tool Tests', () => {
  let orchestrator: MCPOrchestrator;

  beforeEach(() => {
    orchestrator = new MCPOrchestrator();
  });

  test('í†µê³„ ë¶„ì„ ë„êµ¬ í…ŒìŠ¤íŠ¸', async () => {
    const result = await orchestrator.process({
      query: 'ë°ì´í„° í†µê³„ ë¶„ì„',
      parameters: { data: [1, 2, 3, 4, 5] },
      context: { session_id: 'test' }
    });

    expect(result.success).toBe(true);
    expect(result.tools_used).toContain('statistical_analysis');
  });
});
```

### 2. í†µí•© í…ŒìŠ¤íŠ¸

```bash
# MCP í…ŒìŠ¤íŠ¸ ì‹¤í–‰
npm run test:mcp

# íŠ¹ì • ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸
curl -X POST http://localhost:3000/api/ai/mcp/test \
  -H "Content-Type: application/json" \
  -d '{"testType": "advanced"}'
```

---

## âš¡ ì„±ëŠ¥ ìµœì í™”

### 1. ìºì‹± ì „ëµ

```typescript
// ì¤‘ìš”ë„ ê¸°ë°˜ ìºì‹±
if (result.confidence > 0.8) {
  contextManager.storePattern(patternData, 'permanent');
} else {
  contextManager.storePattern(patternData, 'temporary');
}
```

### 2. ë³‘ë ¬ ì²˜ë¦¬ ìµœì í™”

```typescript
// ë³‘ë ¬ ì‹¤í–‰ ê°€ëŠ¥í•œ ë„êµ¬ë“¤
const parallelTools = ['statistical_analysis', 'anomaly_detection', 'pattern_recognition'];
const parallelResults = await Promise.all(
  parallelTools.map(tool => tool.execute(params, context))
);
```

### 3. ë©”ëª¨ë¦¬ ê´€ë¦¬

```typescript
// ìë™ ë©”ëª¨ë¦¬ ì •ë¦¬
setInterval(() => {
  contextManager.cleanupExpiredData();
  bridge.clearCache();
}, 600000); // 10ë¶„ë§ˆë‹¤
```

---

## ğŸ”§ ë””ë²„ê¹… ë° ëª¨ë‹ˆí„°ë§

### 1. ë¡œê¹… ì„¤ì •

```typescript
// MCP ì²˜ë¦¬ ê³¼ì • ë¡œê¹…
console.log('ğŸ§  MCP ìš”ì²­:', {
  query: request.query.substring(0, 50) + '...',
  toolsSelected: selectedTools.map(t => t.name),
  contextId: context.id
});
```

### 2. ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§

```typescript
// ë„êµ¬ë³„ ì„±ëŠ¥ ì¶”ì 
const toolMetrics = {
  execution_time: Date.now() - startTime,
  confidence: result.confidence,
  cache_hit: result.cached || false
};
```

### 3. í—¬ìŠ¤ì²´í¬

```bash
# ì‹œìŠ¤í…œ ìƒíƒœ í™•ì¸
curl http://localhost:3000/api/ai/mcp?action=health

# ë„êµ¬ ëª©ë¡ í™•ì¸
curl http://localhost:3000/api/ai/mcp?action=tools
```

---

## ğŸš€ ë°°í¬ ê°€ì´ë“œ

### 1. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

```bash
# .env.local
AI_ENGINE_URL=https://your-python-service.onrender.com
MCP_CACHE_TTL=300000
MCP_MAX_PARALLEL_TOOLS=3
```

### 2. í”„ë¡œë•ì…˜ ìµœì í™”

```typescript
// í”„ë¡œë•ì…˜ í™˜ê²½ ì„¤ì •
const mcpConfig = {
  enablePythonFallback: process.env.NODE_ENV === 'production',
  cacheStrategy: 'aggressive',
  timeoutMs: 30000
};
```

---

## ğŸ¯ ëª¨ë²” ì‚¬ë¡€

### 1. ì¿¼ë¦¬ ì„¤ê³„
- **êµ¬ì²´ì ì¸ ì§ˆë¬¸**: "CPU ì‚¬ìš©ë¥  ë¶„ì„" â†’ "ì§€ë‚œ 1ì‹œê°„ CPU ê¸‰ì¦ ì›ì¸ ë¶„ì„"
- **ì»¨í…ìŠ¤íŠ¸ ì œê³µ**: ì‹œê°„ ë²”ìœ„, ìš°ì„ ìˆœìœ„, ì„¸ì…˜ ì •ë³´ í¬í•¨
- **ê¸°ëŒ€ ê²°ê³¼ ëª…ì‹œ**: í†µê³„, ì˜ˆì¸¡, ìµœì í™” ë°©ì•ˆ ë“±

### 2. ì„±ëŠ¥ ìµœì í™”
- **ì ì ˆí•œ TTL ì„¤ì •**: ë°ì´í„° íŠ¹ì„±ì— ë§ëŠ” ìºì‹œ ì‹œê°„
- **ì ì§„ì  ë¶„ì„**: ê°„ë‹¨í•œ ë„êµ¬ë¶€í„° ë³µì¡í•œ ë¶„ì„ ìˆœìœ¼ë¡œ
- **ê²°ê³¼ ì¬ì‚¬ìš©**: ì„¸ì…˜ ë‚´ ìœ ì‚¬í•œ ì¿¼ë¦¬ ìµœì í™”

### 3. ì˜¤ë¥˜ ì²˜ë¦¬
- **Graceful Degradation**: Python ì‹¤íŒ¨ì‹œ ë¡œì»¬ í´ë°±
- **ì‚¬ìš©ì í”¼ë“œë°±**: ë¶„ì„ ì‹ ë¢°ë„ ë° ì œí•œì‚¬í•­ ëª…ì‹œ
- **ì¬ì‹œë„ ë¡œì§**: ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ì— ëŒ€í•œ ì§€ìˆ˜ ë°±ì˜¤í”„

---

## ğŸ“š ì¶”ê°€ ìë£Œ

- **[MCP ì™„ì„± ë³´ê³ ì„œ](../MCP_COMPLETION_REPORT.md)** - 4ë‹¨ê³„ êµ¬í˜„ ìƒì„¸ ë‚´ìš©
- **[API ë¬¸ì„œ](./03-API-ë°°í¬-ê°€ì´ë“œ.md)** - REST API ìƒì„¸ ê°€ì´ë“œ  
- **[ë¬¸ì œí•´ê²° ê°€ì´ë“œ](./06-ë¬¸ì œí•´ê²°-ê°€ì´ë“œ.md)** - ì¼ë°˜ì ì¸ ë¬¸ì œ í•´ê²°

---

*MCP ê°œë°œ ê°€ì´ë“œ - OpenManager Vibe v5 - 2025ë…„ 1ì›” 28ì¼* 