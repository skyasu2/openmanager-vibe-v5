# 시스템 구조

## 🏗 아키텍처 개요

OpenManager Vibe V5는 다음과 같은 핵심 구성 요소로 이루어진 서버리스 아키텍처를 사용합니다:

```
                                   ┌─────────────┐
                                   │             │
                ┌─────────────────►│  Vercel UI  │◄────────────────┐
                │                  │             │                  │
                │                  └─────────────┘                  │
                │                                                   │
                │                                                   │
     ┌──────────▼─────────┐                           ┌────────────▼─────────┐
     │                    │                           │                      │
     │  Vercel Functions  │◄─────────────────────────►│  Upstash Redis      │
     │  (Serverless API)  │                           │  (Cache/KV Store)    │
     │                    │                           │                      │
     └──────────▲─────────┘                           └──────────────────────┘
                │
                │
                │                  ┌─────────────┐
                │                  │             │
                └─────────────────►│  Supabase   │
                                   │  (Database) │
                                   │             │
                                   └─────────────┘
```

## 🧩 주요 구성 요소

### 1. 프론트엔드 (Vercel UI)
- **기술 스택**: Next.js 15, React, TypeScript, Tailwind CSS
- **구조**: App Router 기반 페이지 및 컴포넌트
- **주요 기능**: 서버 모니터링 대시보드, MCP 채팅 인터페이스, 실시간 알림

### 2. 백엔드 (Vercel Functions)
- **기술 스택**: TypeScript, Next.js API Routes
- **구조**: 경로 기반 API 엔드포인트
- **주요 기능**: 서버 상태 모니터링, MCP 쿼리 처리, 성능 분석

### 3. 스토리지 시스템
- **캐시 레이어**: Upstash Redis (KV 스토어)
- **데이터베이스**: Supabase (PostgreSQL)
- **하이브리드 접근 방식**: 
  - 실시간/임시 데이터 → Redis
  - 영구/구조화 데이터 → Supabase

## 📂 모듈별 구조

### 1. MCP 엔진 (자연어 처리)
```
modules/
└── mcp/
    ├── core/
    │   ├── processor.ts       # 자연어 처리 로직
    │   ├── patterns.ts        # 패턴 매칭 규칙
    │   └── responder.ts       # 응답 생성기
    ├── npu/
    │   ├── intent.ts          # 의도 분류
    │   └── extractor.ts       # 엔티티 추출
    └── knowledge/
        ├── servers.ts         # 서버 관련 지식
        └── troubleshooting.ts # 문제 해결 지식
```

### 2. 모니터링 시스템
```
lib/
└── monitoring/
    ├── collectors/
    │   ├── server-stats.ts    # 서버 상태 수집
    │   └── error-tracker.ts   # 오류 추적
    ├── analyzers/
    │   ├── performance.ts     # 성능 분석
    │   └── anomaly.ts         # 이상 탐지
    └── alerts/
        ├── threshold.ts       # 임계값 기반 알림
        └── notifier.ts        # 알림 전송
```

### 3. 데이터 스토리지
```
modules/
└── storage/
    ├── redis/
    │   ├── client.ts         # Redis 클라이언트
    │   └── cache.ts          # 캐싱 로직
    ├── supabase/
    │   ├── client.ts         # Supabase 클라이언트
    │   └── queries.ts        # 데이터 쿼리
    └── hybrid/
        └── storage.ts        # 하이브리드 스토리지 전략
```

## 🔄 데이터 흐름

### 1. 서버 모니터링 흐름
```
에이전트 → API 엔드포인트 → 데이터 처리 → Redis(캐싱) → Supabase(저장) → 대시보드 UI
```

### 2. MCP 쿼리 처리 흐름
```
사용자 쿼리 → API 엔드포인트 → 의도 분석 → 데이터 검색 → 응답 생성 → UI 표시
```

### 3. 알림 처리 흐름
```
모니터링 → 이상 탐지 → 알림 생성 → Redis(임시 저장) → 푸시 알림 → UI 표시
```

## 🔐 보안 아키텍처

### 1. 인증 및 권한
- JWT 기반 사용자 인증
- API 키 기반 서버 인증
- 역할 기반 액세스 제어 (RBAC)

### 2. 데이터 보안
- 저장 데이터 암호화 (Supabase)
- 전송 데이터 암호화 (HTTPS)
- 민감 정보 처리를 위한 환경 변수 사용

### 3. 인프라 보안
- Vercel Edge Network 보호
- 요청 제한 및 속도 제한
- IP 기반 액세스 제어

## 📱 확장성 고려사항

### 1. 수평적 확장
- 서버리스 아키텍처로 자동 확장
- 독립적인 기능별 모듈화

### 2. 성능 최적화
- Redis 캐싱으로 빈번한 쿼리 최적화
- Edge Functions 활용 (지역적 근접성)

### 3. 미래 확장 계획
- 추가 모니터링 에이전트 지원
- 머신러닝 기반 예측 분석
- 다중 클라우드 공급자 지원 