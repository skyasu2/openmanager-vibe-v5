# ë°°í¬ ë° ìš´ì˜ ê°€ì´ë“œ

## ğŸš€ ë°°í¬ ê°œìš”

OpenManager Vibe v5ë¥¼ í”„ë¡œë•ì…˜ í™˜ê²½ì— ë°°í¬í•˜ê³  ìš´ì˜í•˜ëŠ” ë°©ë²•ì„ ì„¤ëª…í•©ë‹ˆë‹¤.

## ğŸ—ï¸ ë°°í¬ ì•„í‚¤í…ì²˜

```
Internet
    â†“
Load Balancer
    â†“
Next.js App (Vercel/Docker)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Supabase      â”‚     Redis       â”‚
â”‚ (PostgreSQL)    â”‚   (Upstash)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
Data Collectors
â”œâ”€â”€ Prometheus (Kubernetes)
â”œâ”€â”€ CloudWatch (AWS)
â””â”€â”€ Custom API (On-premise)
```

## ğŸ“‹ ë°°í¬ ì „ ì¤€ë¹„ì‚¬í•­

### 1. í™˜ê²½ ìš”êµ¬ì‚¬í•­
- Node.js 18+
- PostgreSQL 14+ (Supabase ê¶Œì¥)
- Redis 6+ (Upstash ê¶Œì¥)
- Docker (ì„ íƒì‚¬í•­)

### 2. ì™¸ë¶€ ì„œë¹„ìŠ¤ ì„¤ì •
- **Supabase í”„ë¡œì íŠ¸** ìƒì„±
- **Redis ì¸ìŠ¤í„´ìŠ¤** ì¤€ë¹„ (Upstash ë“±)
- **ë„ë©”ì¸** ë° **SSL ì¸ì¦ì„œ** ì¤€ë¹„

### 3. ìˆ˜ì§‘ê¸° ì ‘ê·¼ ê¶Œí•œ
- **Prometheus**: í´ëŸ¬ìŠ¤í„° ì ‘ê·¼ URL
- **AWS CloudWatch**: IAM í‚¤ ë° ê¶Œí•œ
- **Custom API**: ì„œë²„ ì ‘ê·¼ ì—”ë“œí¬ì¸íŠ¸

## ğŸ”§ Vercel ë°°í¬ (ê¶Œì¥)

### 1. Vercel í”„ë¡œì íŠ¸ ì„¤ì •
```bash
# Vercel CLI ì„¤ì¹˜
npm i -g vercel

# í”„ë¡œì íŠ¸ ì—°ê²°
vercel link

# í™˜ê²½ë³€ìˆ˜ ì„¤ì •
vercel env add
```

### 2. í™˜ê²½ë³€ìˆ˜ ì„¤ì •
Vercel ëŒ€ì‹œë³´ë“œì—ì„œ ë‹¤ìŒ í™˜ê²½ë³€ìˆ˜ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤:

```env
# ê¸°ë³¸ ì„¤ì •
NEXT_PUBLIC_SITE_URL=https://your-domain.vercel.app
COLLECTOR_MODE=production

# Supabase
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

# Redis (Upstash)
REDIS_URL=rediss://default:xxx@xxx.upstash.io:6379

# í”„ë¡œë•ì…˜ ìˆ˜ì§‘ê¸°
PROMETHEUS_URL=https://prometheus.your-k8s.com
AWS_ACCESS_KEY_ID=AKIAIOSFODNN7EXAMPLE
AWS_SECRET_ACCESS_KEY=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY
AWS_REGION=ap-northeast-2
CUSTOM_API_ENDPOINTS=https://server1.com/metrics,https://server2.com/metrics
```

### 3. ë°°í¬ ì‹¤í–‰
```bash
# í”„ë¡œë•ì…˜ ë°°í¬
vercel --prod
```

## ğŸ³ Docker ë°°í¬

### 1. Dockerfile ì„¤ì •
```dockerfile
FROM node:18-alpine AS base

# ì˜ì¡´ì„± ì„¤ì¹˜
FROM base AS deps
WORKDIR /app
COPY package*.json ./
RUN npm ci

# ë¹Œë“œ ë‹¨ê³„
FROM base AS builder
WORKDIR /app
COPY --from=deps /app/node_modules ./node_modules
COPY . .
RUN npm run build

# í”„ë¡œë•ì…˜ ë‹¨ê³„
FROM base AS runner
WORKDIR /app

ENV NODE_ENV=production

RUN addgroup --system --gid 1001 nodejs
RUN adduser --system --uid 1001 nextjs

COPY --from=builder /app/public ./public
COPY --from=builder --chown=nextjs:nodejs /app/.next/standalone ./
COPY --from=builder --chown=nextjs:nodejs /app/.next/static ./.next/static

USER nextjs

EXPOSE 3000
ENV PORT=3000

CMD ["node", "server.js"]
```

### 2. Docker Compose ì„¤ì •
```yaml
# docker-compose.yml
version: '3.8'

services:
  app:
    build: .
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - SUPABASE_URL=${SUPABASE_URL}
      - SUPABASE_ANON_KEY=${SUPABASE_ANON_KEY}
      - REDIS_URL=${REDIS_URL}
      - COLLECTOR_MODE=production
    depends_on:
      - redis
    
  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data

  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
      - ./ssl:/etc/ssl
    depends_on:
      - app

volumes:
  redis_data:
```

### 3. ë°°í¬ ì‹¤í–‰
```bash
# ì´ë¯¸ì§€ ë¹Œë“œ ë° ì‹¤í–‰
docker-compose up -d

# ë¡œê·¸ í™•ì¸
docker-compose logs -f app
```

## â˜ï¸ AWS EC2 ë°°í¬

### 1. EC2 ì¸ìŠ¤í„´ìŠ¤ ì¤€ë¹„
```bash
# Ubuntu 22.04 LTS ì¸ìŠ¤í„´ìŠ¤ì—ì„œ
sudo apt update
sudo apt install -y nodejs npm nginx

# PM2 ì„¤ì¹˜ (í”„ë¡œì„¸ìŠ¤ ê´€ë¦¬)
sudo npm install -g pm2
```

### 2. ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬
```bash
# ì½”ë“œ ë°°í¬
git clone https://github.com/your-repo/openmanager-vibe-v5.git
cd openmanager-vibe-v5

# ì˜ì¡´ì„± ì„¤ì¹˜
npm install

# í”„ë¡œë•ì…˜ ë¹Œë“œ
npm run build

# PM2ë¡œ ì‹¤í–‰
pm2 start npm --name "openmanager" -- start
pm2 save
pm2 startup
```

---

## ğŸš¨ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### 1. ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ì‹¤íŒ¨

**ë¬¸ì œ**: `npm run dev` ì‹¤í–‰ ì‹œ ì˜¤ë¥˜ ë°œìƒ
```bash
Error: Cannot find module 'next'
```

**í•´ê²°ì±…**:
```bash
# ì˜ì¡´ì„± ì¬ì„¤ì¹˜
rm -rf node_modules package-lock.json
npm install

# ë˜ëŠ” ìºì‹œ ì •ë¦¬
npm cache clean --force
npm install
```

**ë¬¸ì œ**: í¬íŠ¸ 3000ì´ ì´ë¯¸ ì‚¬ìš© ì¤‘
```bash
Error: listen EADDRINUSE: address already in use :::3000
```

**í•´ê²°ì±…**:
```bash
# ì‹¤í–‰ ì¤‘ì¸ í”„ë¡œì„¸ìŠ¤ í™•ì¸
lsof -i :3000

# í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ
kill -9 [PID]

# ë˜ëŠ” ë‹¤ë¥¸ í¬íŠ¸ ì‚¬ìš©
PORT=3001 npm run dev
```

### 2. í™˜ê²½ë³€ìˆ˜ ì„¤ì • ë¬¸ì œ

**ë¬¸ì œ**: í™˜ê²½ë³€ìˆ˜ê°€ ì½íˆì§€ ì•ŠìŒ
```bash
Error: Environment variable SUPABASE_URL is not defined
```

**í•´ê²°ì±…**:
```bash
# .env.local íŒŒì¼ í™•ì¸
cat .env.local

# íŒŒì¼ ê¶Œí•œ í™•ì¸
chmod 644 .env.local

# í™˜ê²½ë³€ìˆ˜ í˜•ì‹ í™•ì¸ (ë”°ì˜´í‘œ ì—†ì´)
SUPABASE_URL=https://your-project.supabase.co
```

**ë¬¸ì œ**: Next.jsì—ì„œ í™˜ê²½ë³€ìˆ˜ ì ‘ê·¼ ë¶ˆê°€
```javascript
// âŒ ì˜ëª»ëœ ë°©ë²•
process.env.SUPABASE_URL // undefined in browser

// âœ… ì˜¬ë°”ë¥¸ ë°©ë²•
process.env.NEXT_PUBLIC_SUPABASE_URL // ë¸Œë¼ìš°ì €ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥
```

### 3. ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ë¬¸ì œ

**ë¬¸ì œ**: Supabase ì—°ê²° ì‹œ ì¸ì¦ ì˜¤ë¥˜
```bash
Error: Invalid API key
```

**í•´ê²°ì±…**:
```bash
# API í‚¤ í™•ì¸
# Supabase ëŒ€ì‹œë³´ë“œ â†’ Settings â†’ API
# anon (public) keyì™€ service_role key êµ¬ë¶„

# .env.localì—ì„œ ì˜¬ë°”ë¥¸ í‚¤ ì‚¬ìš©
SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

**ë¬¸ì œ**: Redis ì—°ê²° ì‹¤íŒ¨
```bash
Error: connect ECONNREFUSED 127.0.0.1:6379
```

**í•´ê²°ì±…**:
```bash
# Redis ì„œë²„ ìƒíƒœ í™•ì¸
redis-cli ping

# Redis ì„œë²„ ì‹œì‘
sudo systemctl start redis-server

# ë˜ëŠ” Dockerë¡œ ì‹¤í–‰
docker run -d -p 6379:6379 redis:alpine

# í™˜ê²½ë³€ìˆ˜ í™•ì¸
REDIS_URL=redis://localhost:6379
```

### 4. ìˆ˜ì§‘ê¸° ê´€ë ¨ ë¬¸ì œ

**ë¬¸ì œ**: Prometheus ì„œë²„ ì—°ê²° ì‹¤íŒ¨
```bash
Error: connect ECONNREFUSED prometheus:9090
```

**í•´ê²°ì±…**:
```bash
# Prometheus URL í™•ì¸
curl http://prometheus:9090/api/v1/query?query=up

# ë„¤íŠ¸ì›Œí¬ ì ‘ê·¼ í™•ì¸
ping prometheus

# í™˜ê²½ë³€ìˆ˜ ìˆ˜ì •
PROMETHEUS_URL=http://localhost:9090  # ë¡œì»¬ í…ŒìŠ¤íŠ¸ìš©
PROMETHEUS_URL=https://prometheus.your-domain.com  # í”„ë¡œë•ì…˜ìš©
```

**ë¬¸ì œ**: CloudWatch ìˆ˜ì§‘ê¸° ì˜¤ë¥˜
```bash
Error: The security token included in the request is invalid
```

**í•´ê²°ì±…**:
```bash
# AWS ìê²© ì¦ëª… í™•ì¸
aws sts get-caller-identity

# í™˜ê²½ë³€ìˆ˜ ì„¤ì •
AWS_ACCESS_KEY_ID=AKIAIOSFODNN7EXAMPLE
AWS_SECRET_ACCESS_KEY=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY
AWS_REGION=ap-northeast-2

# IAM ê¶Œí•œ í™•ì¸ (CloudWatch ì½ê¸° ê¶Œí•œ í•„ìš”)
```

### 5. ì„±ëŠ¥ ìµœì í™”

**ë¬¸ì œ**: ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ê³¼ë‹¤
```bash
# Node.js ë©”ëª¨ë¦¬ ì œí•œ ì¦ê°€
NODE_OPTIONS="--max-old-space-size=4096" npm start

# PM2 í´ëŸ¬ìŠ¤í„° ëª¨ë“œ
pm2 start ecosystem.config.js
```

**ë¬¸ì œ**: ë¹Œë“œ ì‹œê°„ ê³¼ë‹¤
```bash
# ë³‘ë ¬ ë¹Œë“œ í™œì„±í™”
npm run build -- --parallel

# ìºì‹œ í™œìš©
npm run build -- --cache
```

### 6. ë³´ì•ˆ ì„¤ì •

**SSL ì¸ì¦ì„œ ì„¤ì •**:
```bash
# Let's Encrypt ì¸ì¦ì„œ
sudo certbot --nginx -d your-domain.com
```

**ë°©í™”ë²½ ì„¤ì •**:
```bash
# UFW ë°©í™”ë²½
sudo ufw allow 80
sudo ufw allow 443
sudo ufw allow 22
sudo ufw enable
```

### 7. ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹…

**ë¡œê·¸ ê´€ë¦¬**:
```bash
# PM2 ë¡œê·¸ í™•ì¸
pm2 logs openmanager

# ë¡œê·¸ ë¡œí…Œì´ì…˜
pm2 install pm2-logrotate
```

**ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§**:
```bash
# PM2 ëª¨ë‹ˆí„°ë§
pm2 monit

# ì‹œìŠ¤í…œ ë¦¬ì†ŒìŠ¤ í™•ì¸
htop
iotop
```

## ğŸ” ìƒíƒœ ì ê²€ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ë°°í¬ í›„ í™•ì¸ì‚¬í•­
- [ ] ì›¹ì‚¬ì´íŠ¸ ì ‘ì† í™•ì¸
- [ ] AI ì—ì´ì „íŠ¸ ì‘ë‹µ í…ŒìŠ¤íŠ¸
- [ ] ë°ì´í„° ìˆ˜ì§‘ê¸° ë™ì‘ í™•ì¸
- [ ] SSL ì¸ì¦ì„œ ìœ íš¨ì„± ê²€ì‚¬
- [ ] ë°±ì—… ì‹œìŠ¤í…œ ì‘ë™ í™•ì¸

### ì •ê¸° ì ê²€ì‚¬í•­
- [ ] ë°ì´í„°ë² ì´ìŠ¤ ìš©ëŸ‰ í™•ì¸
- [ ] ë¡œê·¸ íŒŒì¼ í¬ê¸° ê´€ë¦¬
- [ ] ë³´ì•ˆ ì—…ë°ì´íŠ¸ ì ìš©
- [ ] ì„±ëŠ¥ ë©”íŠ¸ë¦­ ê²€í† 
- [ ] ë°±ì—… ë°ì´í„° ë³µì› í…ŒìŠ¤íŠ¸

---

**Copyright(c) ì €ì‘ì. All rights reserved.** 