%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#3b82f6', 'primaryTextColor': '#fff', 'primaryBorderColor': '#2563eb', 'lineColor': '#64748b', 'secondaryColor': '#10b981', 'tertiaryColor': '#f59e0b'}}}%%
%% Dashboard Architecture - Updated 2025-12-04 based on live inspection
flowchart TB
    subgraph Pages["ğŸ“„ Pages (Next.js App Router)"]
        Page["/dashboard/page.tsx<br/>Server Component"]
        Layout["/dashboard/layout.tsx"]
        Loading["/dashboard/loading.tsx"]
        ErrorPage["/dashboard/error.tsx"]
    end

    subgraph ClientLayer["ğŸ–¥ï¸ Client Components"]
        DashboardClient["DashboardClient.tsx<br/>ë©”ì¸ í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸"]

        subgraph HeaderSection["í—¤ë” ì˜ì—­"]
            DashboardHeader["DashboardHeader<br/>Logo + Time + AI Button + Profile"]
            DemoModeBanner["DemoModeBanner<br/>ğŸ­ Demo Mode í‘œì‹œ"]
        end

        subgraph ContentSection["ì½˜í…ì¸  ì˜ì—­"]
            DashboardContent["DashboardContent"]
            DashboardSummary["DashboardSummary<br/>ì„œë²„ í†µê³„ (Total/Online/Warning/Offline)"]
            ResourceOverview["ResourceOverview<br/>CPU/Memory/Disk/Network í‰ê· "]
            ServerDashboard["ServerDashboard<br/>(Dynamic Import)"]
        end

        subgraph ServerList["ì„œë²„ ëª©ë¡"]
            Controls["ServerDashboardControls"]
            ServerGrid["ServerGrid<br/>2-Column Responsive"]
            ExpandButton["ë”ë³´ê¸° Button<br/>(ë™ì  í™•ì¥)"]
            ServerCard["ServerCard<br/>3-Level Metrics"]
        end

        subgraph Modals["ëª¨ë‹¬ (Dynamic)"]
            ServerModal["EnhancedServerModal"]
            OverviewTab["OverviewTab"]
            MetricsTab["MetricsTab"]
            LogsTab["LogsTab"]
            ProcessesTab["ProcessesTab"]
            NetworkTab["NetworkTab"]
        end

        subgraph AISidebar["AI ì‚¬ì´ë“œë°” (Unified)"]
            AISidebarV4["AISidebarV4<br/>(Unified Interface)"]
            AIFeature1["ìì—°ì–´ ì§ˆì˜<br/>Natural Language Query"]
            AIFeature2["ìë™ì¥ì•  ë³´ê³ ì„œ<br/>Auto Failure Report"]
            AIFeature3["ì´ìƒê°ì§€/ì˜ˆì¸¡<br/>Anomaly Detection"]
            AIFeature4["AI ê³ ê¸‰ê´€ë¦¬<br/>ML Training & Settings"]
        end

        subgraph SystemControls["ì‹œìŠ¤í…œ ì œì–´"]
            FloatingControl["FloatingSystemControl"]
            Notification["NotificationToast"]
            AutoLogout["AutoLogoutWarning"]
        end
    end

    subgraph Hooks["ğŸª Custom Hooks"]
        useServerDashboard["useServerDashboard<br/>ë©”ì¸ ë°ì´í„° í›…"]
        useServerDataCache["useServerDataCache"]
        useServerFilter["useServerFilter"]
        useServerPagination["useServerPagination"]
        useServerStats["useServerStats"]
        useServerMetrics["useServerMetrics"]
        useResponsivePageSize["useResponsivePageSize"]
        useAutoLogout["useAutoLogout"]
        useSystemStatus["useSystemStatus"]
        useUserPermissions["useUserPermissions"]
    end

    subgraph Stores["ğŸ“¦ Zustand Stores"]
        ServerDataStore["useServerDataStore<br/>ì„œë²„ ë°ì´í„°"]
        AISidebarStore["useAISidebarStore<br/>AI ìƒíƒœ"]
        SystemStatusStore["useSystemStatusStore<br/>ì‹œìŠ¤í…œ ìƒíƒœ"]
        AdminStore["useUnifiedAdminStore<br/>ê´€ë¦¬ì"]
    end

    subgraph API["ğŸŒ API Routes"]
        DashboardAPI["/api/dashboard<br/>ëŒ€ì‹œë³´ë“œ ë°ì´í„°"]
        ServersAPI["/api/servers-unified<br/>ì„œë²„ í†µí•© API"]
        AIAPI["/api/ai/query<br/>AI ì¿¼ë¦¬"]
    end

    subgraph DataSources["ğŸ’¾ Data Sources"]
        Supabase[(Supabase<br/>Primary Database)]
        MockData["Mock Providers<br/>(Testing/Fallback)"]
    end

    %% í˜ì´ì§€ íë¦„
    Page --> DashboardClient
    Layout --> Page
    Loading -.-> Page
    ErrorPage -.-> Page

    %% í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ íë¦„
    DashboardClient --> DashboardHeader
    DashboardClient --> DemoModeBanner
    DashboardClient --> DashboardContent
    DashboardClient --> AISidebarV4
    DashboardClient --> FloatingControl
    DashboardClient --> Notification
    DashboardClient --> AutoLogout
    DashboardClient --> ServerModal

    DashboardContent --> DashboardSummary
    DashboardContent --> ResourceOverview
    DashboardContent --> ServerDashboard

    ServerDashboard --> Controls
    ServerDashboard --> ServerGrid
    ServerGrid --> ExpandButton
    ServerGrid --> ServerCard

    %% AI Sidebar ë‚´ë¶€ ê¸°ëŠ¥
    AISidebarV4 --> AIFeature1
    AISidebarV4 --> AIFeature2
    AISidebarV4 --> AIFeature3
    AISidebarV4 --> AIFeature4

    ServerModal --> OverviewTab
    ServerModal --> MetricsTab
    ServerModal --> LogsTab
    ServerModal --> ProcessesTab
    ServerModal --> NetworkTab

    %% Hooks ì—°ê²°
    DashboardClient --> useServerDashboard
    DashboardClient --> useAutoLogout
    DashboardClient --> useSystemStatus
    DashboardClient --> useUserPermissions

    useServerDashboard --> useServerDataCache
    useServerDashboard --> useServerFilter
    useServerDashboard --> useServerPagination
    useServerDashboard --> useServerStats
    useServerDashboard --> useServerMetrics
    useServerDashboard --> useResponsivePageSize

    %% Store ì—°ê²°
    useServerDashboard --> ServerDataStore
    DashboardClient --> AISidebarStore
    DashboardClient --> SystemStatusStore
    DashboardClient --> AdminStore

    %% API ì—°ê²°
    ServerDataStore --> ServersAPI
    AISidebarV4 --> AIAPI
    DashboardAPI --> Supabase

    ServersAPI --> Supabase
    ServersAPI --> MockData

    %% ìŠ¤íƒ€ì¼
    classDef pageStyle fill:#3b82f6,stroke:#2563eb,color:#fff
    classDef clientStyle fill:#10b981,stroke:#059669,color:#fff
    classDef hookStyle fill:#8b5cf6,stroke:#7c3aed,color:#fff
    classDef storeStyle fill:#f59e0b,stroke:#d97706,color:#fff
    classDef apiStyle fill:#ef4444,stroke:#dc2626,color:#fff
    classDef dataStyle fill:#06b6d4,stroke:#0891b2,color:#fff

    class Page,Layout,Loading,ErrorPage pageStyle
    class DashboardClient,DashboardHeader,DemoModeBanner,DashboardContent,DashboardSummary,ResourceOverview,ServerDashboard,Controls,ServerGrid,ExpandButton,ServerCard,ServerModal,OverviewTab,MetricsTab,LogsTab,ProcessesTab,NetworkTab,AISidebarV4,AIFeature1,AIFeature2,AIFeature3,AIFeature4,FloatingControl,Notification,AutoLogout clientStyle
    class useServerDashboard,useServerDataCache,useServerFilter,useServerPagination,useServerStats,useServerMetrics,useResponsivePageSize,useAutoLogout,useSystemStatus,useUserPermissions hookStyle
    class ServerDataStore,AISidebarStore,SystemStatusStore,AdminStore storeStyle
    class DashboardAPI,ServersAPI,AIAPI apiStyle
    class Supabase,MockData dataStyle
