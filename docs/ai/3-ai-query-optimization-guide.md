# 3-AI 쿼리 최적화 가이드

**Codex 타임아웃 방지 및 효율적 교차검증을 위한 실전 가이드**

최종 업데이트: 2025-10-16

---

## 📊 Executive Summary

### 문제점
- **Codex 타임아웃**: 포괄적 쿼리 시 300초 이상 소요 (실패율 높음)
- **비효율적 교차검증**: 중복 분석, 과도한 입력 크기
- **3-AI 성공률**: 67% (2/3, Codex 실패)

### 해결 방법
- **쿼리 간소화**: 500+ 단어 → 250 단어 (50% 축소)
- **역할 명확화**: "종합 평가" → "실무 관점 추가"
- **Executive Summary 방식**: 2-AI 결과 요약 제공

### 성과
- **Codex 응답 시간**: 300초+ (타임아웃) → 13초 (23배 개선)
- **3-AI 성공률**: 67% → 100% (3/3 성공)
- **토큰 사용**: 효율성 유지 (4,056 토큰)

---

## 🔍 근본 원인 분석 (Sequential Thinking)

### 타임아웃 발생 원인 (우선순위)

#### 1차 원인: 쿼리 복잡도 과다
- "포괄적 평가" 요청 → Codex가 모든 측면을 분석하려 시도
- 500+ 단어 쿼리 → 처리 시간 급증
- 명확한 범위 없음 → 불필요한 심층 분석

#### 2차 원인: 입력 크기 과다
- CLAUDE.md (255줄) + multi-ai-strategy.md (600줄) + subagents-complete-guide.md (700줄)
- 총 1,500+ 줄 입력 → 컨텍스트 처리 부하
- 전체 문서 제공 → 필요 정보 추출 시간 증가

#### 3차 원인: Codex 특성 (완벽주의)
- GPT-5 기반: "사용자 지침을 정확히 따르고 결과를 재현 가능하게"
- 모든 요구사항 충족 시도 → 처리 시간 증가
- 실무 관점 = 상세한 보고서 작성 → 시간 소요

### AI별 처리 방식 차이

| AI | 접근 방식 | 응답 시간 | 특징 |
|----|-----------|-----------|------|
| **Gemini** | Top-down 구조 분석 | 70초 | 아키텍처 패턴 인식 우선 |
| **Qwen** | 수치 중심 데이터 분석 | 102초 | 목표 달성 여부 확인 중심 |
| **Codex** | Bottom-up 상세 구현 분석 | 300초+ | 실무 문제점 구체적 발굴 |

**결론**: Codex는 구체적이고 좁은 범위의 질문에 최적화됨

---

## 🎯 쿼리 간소화 전략

### 전략 A: 직접 간소화 (일반적)

**Before (비효율적)**:
```markdown
CLAUDE.md, multi-ai-strategy.md, subagents-complete-guide.md를
읽고 전체 Claude Code 세팅을 종합적으로 평가해주세요.

다음을 포함하여:
- 문서 품질, 구조, 일관성
- 서브에이전트 설계, 역할 분담
- MCP 통합 상태, 성능
- AI 교차검증 시스템
- 개선 방안 제시
...
```
- 문제: 500+ 단어, 1,500줄 입력, 명확한 범위 없음

**After (효율적)**:
```markdown
Claude Code 세팅의 실무적 문제점을 3가지만 식별해주세요:
1. 1인 개발 환경에서의 실용성
2. 유지보수 복잡도
3. 즉시 개선 가능한 방안 (ROI 중심)

컨텍스트: CLAUDE.md 핵심만 (100줄)
```
- 개선: 250 단어 (50% 축소), 100줄 입력, 명확한 3가지 질문

### 전략 B: Executive Summary 방식 ⭐ (교차검증)

**3-AI 교차검증 시 최적화 패턴**

#### Step 1: Gemini/Qwen 먼저 실행

```bash
# 1. Gemini (아키텍처)
./scripts/ai-subagents/gemini-wrapper.sh "아키텍처 관점에서 평가"

# 2. Qwen (성능)
./scripts/ai-subagents/qwen-wrapper.sh -p "성능 관점에서 평가"
```

#### Step 2: 결과 요약 추출 (95% 축소)

```markdown
**Gemini 의견 (아키텍처)**:
- 전체 평가: 매우 성숙 (A-, 88점)
- 강점: SRP 준수, 체계적 문서
- 약점: 설정 분산, OCP 위반 우려
- 제안: 설정 중앙화 (중장기)

**Qwen 의견 (성능)**:
- 전체 평가: 목표 달성 (A, 90점)
- 강점: 토큰 82%, MCP 9/9
- 약점: MCP 활용도 65/100
- 제안: MCP 극대화 (즉시)
```
- 1,500줄 → 75 단어 (95% 축소)

#### Step 3: Codex에게 역할 명확화 쿼리

```markdown
Gemini와 Qwen이 Claude Code 세팅을 평가했습니다.
당신은 실무 관점에서 추가 의견을 제시해주세요.

[Gemini/Qwen 요약 75단어]

**당신의 역할 (실무 관점)**:
1. 1인 개발 환경에서 이 세팅의 실용성 평가
2. Gemini/Qwen이 놓친 실무적 문제점 식별
3. 즉시 적용 가능한 개선 방안 3-5개 제안
4. ROI 관점에서 우선순위 제시
```

**결과**:
- 쿼리: 250 단어 (50% 축소)
- Codex 응답: 13초 ✅ (23배 개선)
- 토큰: 4,056 (효율적)

---

## 🤖 AI별 특성 및 최적화 팁

### Codex (GPT-5 기반, 실무 검증)

**특성**:
- "사용자 지침을 정확히 따르고 결과를 재현 가능하게"
- 완벽주의 경향 → 모든 요구사항 충족 시도
- 실무 관점 = 구체적 개선 방안 + 라인 단위 보고

**최적화 팁**:
```markdown
✅ 좋은 쿼리:
- "3가지 실무적 문제점만 식별"
- "즉시 적용 가능한 개선 방안 (2시간 이내)"
- "ROI 중심으로 우선순위 제시"

❌ 나쁜 쿼리:
- "종합적으로 평가" (범위 불명확)
- "모든 측면을 분석" (완벽주의 유발)
- "자세히 설명" (과도한 상세화)
```

**권장 타임아웃**: 300초 (5분)

### Gemini (2.5 Flash, 아키텍처 검증)

**특성**:
- Senior Code Architect 역할
- Top-down 구조적 분석
- SOLID 원칙, 디자인 패턴 중심

**최적화 팁**:
```markdown
✅ 좋은 쿼리:
- "SOLID 원칙 준수 여부 확인"
- "아키텍처 설계 개선 방향"
- "확장성 관점에서 구조 검토"

❌ 나쁜 쿼리:
- "성능 병목점 분석" (Qwen 전문)
- "실무적 문제점" (Codex 전문)
```

**권장 타임아웃**: 300초 (5분)

### Qwen (2.5 Coder, 성능 검증)

**특성**:
- Performance Engineer 역할
- 수치 중심 데이터 분석
- "1ms라도 빨라야 함" 철학

**최적화 팁**:
```markdown
✅ 좋은 쿼리:
- "성능 지표 측정 및 개선 방안"
- "알고리즘 시간 복잡도 분석"
- "병목점 식별 및 최적화"

❌ 나쁜 쿼리:
- "아키텍처 설계 검토" (Gemini 전문)
- "포괄적 평가" (범위 불명확)
```

**권장 타임아웃**: 600초 (10분, YOLO Mode)
**권장 모드**: Plan Mode (`-p` 플래그)

---

## 📝 쿼리 템플릿 라이브러리

### 템플릿 1: 버그 분석 (Codex)

```markdown
**버그 정보**:
- 파일: [파일명]
- 에러: [에러 메시지]
- 재현 방법: [간단히]

**질문**:
1. 근본 원인은 무엇인가?
2. 즉시 수정 가능한 방법은?
3. 유사 버그 재발 방지 방법은?

**제약 조건**: 3가지 답변만, 각 100단어 이내
```

**예상 응답 시간**: 10-20초
**타임아웃**: 300초

---

### 템플릿 2: 아키텍처 검토 (Gemini)

```markdown
**검토 대상**:
- 컴포넌트: [컴포넌트명]
- 역할: [간단히]
- 의존성: [주요 3개]

**질문**:
1. SOLID 원칙 준수 여부는?
2. 응집도/결합도 개선 방안은?
3. 확장 시 문제가 될 부분은?

**출력 형식**: 각 질문당 3줄 이내 요약
```

**예상 응답 시간**: 30-60초
**타임아웃**: 300초

---

### 템플릿 3: 성능 최적화 (Qwen)

```markdown
**성능 정보**:
- 함수: [함수명]
- 현재 시간: [초]
- 목표 시간: [초]
- 데이터 크기: [N]

**질문**:
1. 시간 복잡도는? (Big-O)
2. 병목점은 어디인가?
3. 최적화 알고리즘은? (구체적으로)

**제약 조건**: Plan Mode (-p), 수치 중심 답변
```

**예상 응답 시간**: 30-60초
**타임아웃**: 600초
**권장 플래그**: `-p` (Plan Mode)

---

### 템플릿 4: 3-AI 교차검증 (Executive Summary) ⭐

```markdown
**Phase 1: Gemini + Qwen 실행**

# Gemini 쿼리
"[대상]의 아키텍처를 SOLID 관점에서 검토해주세요:
1. 구조적 강점 3가지
2. 구조적 약점 3가지
3. 개선 방향 (중장기)"

# Qwen 쿼리 (Plan Mode)
"[대상]의 성능을 분석해주세요:
1. 현재 지표 (토큰, 속도, 효율)
2. 병목점 3가지
3. 최적화 방안 (즉시 적용 가능)"

---

**Phase 2: Codex에 Executive Summary 제공**

# Codex 쿼리
"Gemini와 Qwen이 [대상]을 평가했습니다.
당신은 실무 관점에서 추가 의견만 제시해주세요.

**Gemini 의견 (아키텍처)**:
- 평가: [점수]
- 강점: [3가지 요약]
- 약점: [3가지 요약]
- 제안: [간단히]

**Qwen 의견 (성능)**:
- 평가: [점수]
- 강점: [3가지 요약]
- 약점: [3가지 요약]
- 제안: [간단히]

**당신의 역할**:
1. 1인 개발 환경 실용성 평가
2. 2-AI가 놓친 실무 문제점 3가지
3. 즉시 개선 방안 (ROI 중심, 2시간 이내)
4. 우선순위 제시"
```

**예상 응답 시간**:
- Gemini: 60-90초
- Qwen: 60-120초
- Codex: 10-20초 ✅
- 총합: 130-230초 (3-AI 병렬 실행 시 60-120초)

**성공률**: 100% (3/3)

---

## 🛠️ Before/After 실전 예시

### 사례 1: Claude Code 세팅 평가

#### ❌ Before (타임아웃 발생)

**쿼리**:
```markdown
다음 3개 파일을 읽고 전체 Claude Code 세팅을 종합적으로 평가해주세요:

1. CLAUDE.md (255줄) - 프로젝트 메모리
2. multi-ai-strategy.md (600줄) - AI 전략
3. subagents-complete-guide.md (700줄) - 서브에이전트 가이드

다음을 모두 포함하여:
- 문서 품질 (명확성, 일관성, 정확성)
- 아키텍처 설계 (SOLID, 확장성)
- 서브에이전트 (18개 역할 분담)
- MCP 통합 (9개 서버 활용도)
- AI 교차검증 시스템
- 워크플로우 효율성
- 개선 방안 제시 (즉시, 중장기)
- 우선순위 및 ROI 분석

출력 형식: 종합 보고서 (10-15페이지)
```

**문제점**:
- 쿼리 크기: 500+ 단어
- 입력 크기: 1,555줄
- 요구사항: 8개 항목 (범위 불명확)
- 출력 형식: 과도한 상세화

**결과**: Codex 300초 타임아웃 ❌

---

#### ✅ After (13초 성공)

**Phase 1: Gemini + Qwen 실행** (병렬)

```markdown
# Gemini 쿼리 (60초)
"Claude Code 세팅의 아키텍처를 검토해주세요:
1. 구조적 강점 3가지
2. 구조적 약점 3가지
3. 개선 방향 (중장기)

컨텍스트: CLAUDE.md 핵심만"

# Qwen 쿼리 (90초, Plan Mode)
"Claude Code 세팅의 성능을 분석해주세요:
1. 현재 지표 (토큰 82%, MCP 9/9, 속도 3-5배)
2. 병목점 3가지
3. 최적화 방안 (즉시 적용)

컨텍스트: CLAUDE.md 핵심만"
```

**Phase 2: Codex에 Executive Summary 제공**

```markdown
# Codex 쿼리 (13초 ✅)
"Gemini와 Qwen이 Claude Code 세팅을 평가했습니다.
당신은 실무 관점에서 추가 의견을 제시해주세요.

**Gemini 의견 (아키텍처)**:
- 전체 평가: 매우 성숙한 아키텍처 (A-, 88점)
- 강점: SRP 준수, 18개 서브에이전트, 체계적 문서
- 약점: 설정 분산, OCP 위반 우려
- 제안: 설정 중앙화, 플러그인 아키텍처 (중장기)

**Qwen 의견 (성능)**:
- 전체 평가: 목표 달성 (A, 90점)
- 강점: 토큰 82%, MCP 9/9, 속도 3-5배
- 약점: MCP 활용도 65/100 (35% 개선 가능)
- 제안: MCP 극대화, 워크플로우 최적화 (즉시)

**당신의 역할 (실무 관점)**:
1. 1인 개발 환경에서 이 세팅의 실용성 평가
2. Gemini/Qwen이 놓친 실무적 문제점 식별
3. 즉시 적용 가능한 개선 방안 3-5개 제안
4. ROI 관점에서 우선순위 제시"
```

**개선점**:
- 쿼리 크기: 250 단어 (50% 축소)
- 입력 크기: 75 단어 (95% 축소, Executive Summary)
- 역할 명확화: "실무 관점 추가"로 제한
- 출력 형식: 간결한 실무 보고서

**결과**: Codex 13초 성공 ✅ (4,056 토큰)

---

## 🚨 트러블슈팅

### 문제 1: Codex 여전히 타임아웃

**증상**:
```
❌ Codex 타임아웃 (300초 = 5분 초과)
```

**해결 방법**:

1. **쿼리 더 간소화** (3가지로 제한)
```markdown
# Before: 5가지 질문 (복잡)
# After: 3가지 핵심 질문만
```

2. **역할 더 명확히**
```markdown
# Before: "추가 의견"
# After: "1인 개발 실용성만 평가"
```

3. **Executive Summary 더 축소**
```markdown
# Before: 75단어
# After: 50단어 (각 AI 2줄 요약)
```

4. **최후 수단: 분할 쿼리**
```markdown
# 쿼리 1: 실무적 강점 3가지만
# 쿼리 2: 실무적 문제점 3가지만
# 쿼리 3: 개선 방안 3가지만
```

---

### 문제 2: Gemini/Qwen도 느림

**증상**:
- Gemini: 100초 이상
- Qwen: 200초 이상

**해결 방법**:

1. **입력 크기 축소**
```markdown
# Before: 전체 파일 제공
# After: 핵심 섹션만 (100줄 이내)
```

2. **질문 개수 제한**
```markdown
# Before: 5-7개 질문
# After: 3개 질문만
```

3. **Plan Mode 사용** (Qwen)
```bash
# Before: qwen "복잡한 분석"
# After: qwen -p "복잡한 분석"
```

---

### 문제 3: 3-AI 답변이 중복됨

**증상**:
- Gemini/Qwen/Codex 모두 비슷한 내용

**해결 방법**:

1. **역할 명확히 분리**
```markdown
# Gemini: "아키텍처 관점만"
# Qwen: "성능 지표만"
# Codex: "실무 문제점만"
```

2. **서로 다른 질문**
```markdown
# Gemini: "확장성은?"
# Qwen: "병목점은?"
# Codex: "실용성은?"
```

---

## 📈 효과 측정

### 쿼리 최적화 전후 비교

| 지표 | Before | After | 개선 |
|------|--------|-------|------|
| **Codex 응답 시간** | 300초+ (타임아웃) | 13초 | 23배 빠름 |
| **3-AI 성공률** | 67% (2/3) | 100% (3/3) | +33% |
| **쿼리 크기** | 500+ 단어 | 250 단어 | -50% |
| **입력 크기** | 1,555줄 | 75 단어 | -95% |
| **토큰 효율** | N/A (실패) | 4,056 토큰 | 효율적 |

### ROI 분석

**투입 시간**:
- 쿼리 최적화 설계: 1시간
- 템플릿 작성: 1시간
- 총 투입: 2시간

**절약 효과**:
- Codex 타임아웃 제거: ∞ (실패 → 성공)
- 3-AI 병렬 실행 시간: 300초 → 120초 (3분 절약/회)
- 월 30회 교차검증 가정: 90분 절약/월

**ROI**: 2시간 투입 → 월 90분 절약 + 성공률 100%

---

## 🎯 체크리스트

### 쿼리 작성 전 (5분 소요)

- [ ] **목표 명확화**: 무엇을 알고 싶은가? (3가지로 제한)
- [ ] **AI 선택**: Codex(실무) vs Gemini(설계) vs Qwen(성능)
- [ ] **범위 제한**: "종합" 대신 "실무적 문제점 3가지만"
- [ ] **입력 최소화**: 전체 파일 대신 핵심 섹션 (100줄 이내)
- [ ] **출력 형식**: "상세히" 대신 "각 3줄 요약"

### 3-AI 교차검증 전 (10분 소요)

- [ ] **Gemini/Qwen 먼저**: Executive Summary 수집
- [ ] **요약 추출**: 각 AI당 3줄로 축소 (총 6줄)
- [ ] **Codex 역할 명확화**: "추가 의견만" 명시
- [ ] **타임아웃 설정**: Codex 300초, Gemini 300초, Qwen 600초
- [ ] **병렬 실행**: 3-AI 동시 실행으로 시간 절약

### 타임아웃 발생 시 (즉시 조치)

- [ ] **쿼리 50% 축소**: 5가지 → 3가지 질문
- [ ] **입력 50% 축소**: 200줄 → 100줄
- [ ] **역할 재정의**: "종합 평가" → "실무 문제점만"
- [ ] **분할 쿼리 고려**: 3개 별도 쿼리로 분할
- [ ] **최후 수단**: 간단한 쿼리로 재시작

---

## 📚 참고 문서

- **Decision Log**: logs/ai-decisions/2025-10-16-claude-code-setup-evaluation.md
  - Codex 타임아웃 해결 과정 상세 기록
  - Sequential Thinking 근본 원인 분석 (9 thoughts)
  - Executive Summary 방식 성공 사례

- **Multi-AI 전략**: docs/claude/environment/multi-ai-strategy.md
  - 3-AI 역할 분담 원칙
  - Bash Wrapper 사용법
  - 병렬 실행 패턴

- **서브에이전트 가이드**: docs/ai/subagents-complete-guide.md
  - multi-ai-verification-specialist 활용법
  - codex/gemini/qwen-specialist 호출 방법

---

## 💡 핵심 원칙

1. **간소화 우선**: 500단어 → 250단어 (50% 축소)
2. **역할 명확화**: "종합" 대신 "실무 관점만"
3. **Executive Summary**: 1,500줄 → 75단어 (95% 축소)
4. **AI별 최적화**: Codex(구체적), Gemini(구조적), Qwen(수치)
5. **측정 및 개선**: 타임아웃 → 13초 성공 (23배 개선)

---

**💬 피드백**: 이 가이드가 도움이 되었다면 Decision Log에 사용 사례를 기록해주세요!

🤖 Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>
