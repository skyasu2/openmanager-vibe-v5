# AI Assistant & AI Sidebar Architecture Design

> **ë¬¸ì„œ ëª©ì **: OpenManager VIBE v5ì˜ AI Assistant ë° AI Sidebar ì•„í‚¤í…ì²˜ ì„¤ê³„ë„
> **ì‘ì„±ì¼**: 2025-12-04
> **ë²„ì „**: v2.0 (V4 Architecture)
> **í™˜ê²½**: Next.js 15.4.5, TypeScript 5.7.2, React 18, Vercel AI SDK 4.x

## ğŸ“‹ ì•„í‚¤í…ì²˜ ê°œìš”

### ì‹œìŠ¤í…œ êµ¬ì„±ë„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Frontend Layer (Next.js)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  AISidebarV4    â”‚  â”‚ EnhancedAIChat  â”‚  â”‚ Dashboard UI    â”‚  â”‚
â”‚  â”‚  (useChat hook) â”‚  â”‚   Components    â”‚  â”‚   Components    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    State Management Layer                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ useChat (Vercel â”‚  â”‚ AISidebar Store â”‚  â”‚ Global Store    â”‚  â”‚
â”‚  â”‚   AI SDK)       â”‚  â”‚   (Zustand)     â”‚  â”‚   (Zustand)     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    API Layer (Streaming)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚          /api/ai/unified-stream (POST)                    â”‚  â”‚
â”‚  â”‚     streamText + tool() (Vercel AI SDK)                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    Tool Layer (Hybrid Engine)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ analyze   â”‚ â”‚ getServer â”‚ â”‚ searchRAG â”‚ â”‚ analyze   â”‚       â”‚
â”‚  â”‚ Request   â”‚ â”‚ Metrics   â”‚ â”‚ Knowledge â”‚ â”‚ Pattern   â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚  â”‚ recommend â”‚ â”‚ unified   â”‚                                    â”‚
â”‚  â”‚ Commands  â”‚ â”‚ Processor â”‚                                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    External AI Services                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Google AI       â”‚  â”‚ Supabase RAG    â”‚  â”‚ GCP Cloud       â”‚  â”‚
â”‚  â”‚ (Gemini 1.5)    â”‚  â”‚ (pgvector)      â”‚  â”‚ Functions       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ—ï¸ í•µì‹¬ ì•„í‚¤í…ì²˜ íŒ¨í„´

### 1. Vercel AI SDK Integration (v4.0 í•µì‹¬ ë³€ê²½)

- **useChat Hook**: í´ë¼ì´ì–¸íŠ¸ ë©”ì‹œì§€ ê´€ë¦¬ ë° ìŠ¤íŠ¸ë¦¬ë°
- **streamText**: ì„œë²„ ì¸¡ ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ ìƒì„±
- **tool()**: AI ê¸°ëŠ¥ í™•ì¥ì„ ìœ„í•œ ë„êµ¬ ì‹œìŠ¤í…œ

### 2. Domain-Driven Design (DDD)

- **AI Sidebar Domain**: `src/domains/ai-sidebar/`
  - hooks, types, utils ë¶„ë¦¬
- **Shared Domain**: ê³µí†µ ìœ í‹¸ë¦¬í‹° ë° íƒ€ì…

### 3. Hybrid Engine Strategy (ë³µì¡ë„ ê¸°ë°˜ ë¼ìš°íŒ…)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Query Complexity Router                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  analyzeRequest (Thinking Tool)                              â”‚
â”‚       â†“                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ Simple(1-2) â”‚Moderate(3)  â”‚ Complex(4-5)â”‚                â”‚
â”‚  â”‚   â†“         â”‚    â†“        â”‚     â†“       â”‚                â”‚
â”‚  â”‚ Offline     â”‚ Single Tool â”‚ GCP Unified â”‚                â”‚
â”‚  â”‚ Tools       â”‚ (RAG/Metric)â”‚ Processor   â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ ë””ë ‰í„°ë¦¬ êµ¬ì¡° (V4 ì—…ë°ì´íŠ¸)

```
src/
â”œâ”€â”€ domains/
â”‚   â””â”€â”€ ai-sidebar/                    # AI ì‚¬ì´ë“œë°” ë„ë©”ì¸
â”‚       â”œâ”€â”€ components/
â”‚       â”‚   â”œâ”€â”€ AISidebarV4.tsx       # ë©”ì¸ (Vercel AI SDK useChat)
â”‚       â”‚   â”œâ”€â”€ EnhancedAIChat.tsx    # í–¥ìƒëœ ì±„íŒ… (thinking ì‹œê°í™”)
â”‚       â”‚   â””â”€â”€ MessageComponent.tsx  # ë©”ì‹œì§€ ë Œë”ë§
â”‚       â”œâ”€â”€ hooks/
â”‚       â”‚   â”œâ”€â”€ useAIEngine.ts        # AI ì—”ì§„ ìƒíƒœ ê´€ë¦¬
â”‚       â”‚   â”œâ”€â”€ useAIThinking.ts      # ì‚¬ê³  ê³¼ì • í›…
â”‚       â”‚   â””â”€â”€ index.ts              # í›… export
â”‚       â”œâ”€â”€ types/
â”‚       â”‚   â”œâ”€â”€ ai-sidebar-types.ts   # íƒ€ì… ì •ì˜
â”‚       â”‚   â””â”€â”€ index.ts              # íƒ€ì… export
â”‚       â””â”€â”€ utils/
â”‚           â”œâ”€â”€ aiQueryHandlers.ts    # í”„ë¦¬ì…‹ ì¿¼ë¦¬ í•¸ë“¤ëŸ¬
â”‚           â””â”€â”€ index.ts              # ìœ í‹¸ë¦¬í‹° export
â”œâ”€â”€ stores/
â”‚   â””â”€â”€ useAISidebarStore.ts          # Zustand (persist + devtools)
â”œâ”€â”€ services/
â”‚   â””â”€â”€ ai/
â”‚       â””â”€â”€ supabase-rag-engine.ts    # RAG ê²€ìƒ‰ ì—”ì§„
â””â”€â”€ app/
    â””â”€â”€ api/
        â””â”€â”€ ai/
            â””â”€â”€ unified-stream/
                â””â”€â”€ route.ts          # ìŠ¤íŠ¸ë¦¬ë° API (í•µì‹¬)
```

## ğŸ”§ í•µì‹¬ ì»´í¬ë„ŒíŠ¸ ìƒì„¸ ì„¤ê³„

### 1. AISidebarV4 (ë©”ì¸ ì»´í¬ë„ŒíŠ¸)

**ì—­í• **: Vercel AI SDK ê¸°ë°˜ AI ì‚¬ì´ë“œë°”
**í•µì‹¬ ë³€ê²½ (V3 â†’ V4)**:
- âœ… `useChat` hookìœ¼ë¡œ ë©”ì‹œì§€ ê´€ë¦¬ í†µí•©
- âœ… ìˆ˜ë™ ì—”ì§„ ì„ íƒ UI ì œê±° (UNIFIED ìë™ ëª¨ë“œ)
- âœ… ESC í‚¤ ì‚¬ì´ë“œë°” ë‹«ê¸°
- âœ… ê¶Œí•œ ì²´í¬ (useUserPermissions + guestFullAccess)

**ì½”ë“œ íŒ¨í„´**:

```typescript
// AISidebarV4.tsx (í•µì‹¬ êµ¬ì¡°)
const AISidebarV4 = ({ isOpen, onClose }: AISidebarV4Props) => {
  const { messages, input, handleSubmit, isLoading, setInput } = useChat({
    api: '/api/ai/unified-stream',
    id: sessionId,
  });

  // ê¶Œí•œ ì²´í¬
  const permissions = useUserPermissions();
  const hasPermission = permissions.canUseAIChat || isGuestFullAccessEnabled();

  // ESC í‚¤ í•¸ë“¤ë§
  useEffect(() => {
    const handler = (e: KeyboardEvent) => {
      if (e.key === 'Escape') onClose();
    };
    window.addEventListener('keydown', handler);
    return () => window.removeEventListener('keydown', handler);
  }, [onClose]);

  return (
    <EnhancedAIChat
      messages={enhancedMessages}
      onSubmit={handleSubmit}
      isLoading={isLoading}
    />
  );
};
```

### 2. Unified Stream API (Tool ê¸°ë°˜)

**ì—­í• **: AI ì¿¼ë¦¬ ì²˜ë¦¬ ë° ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ
**ê¸°ìˆ  ìŠ¤íƒ**:
- Vercel AI SDK (`streamText`, `tool`)
- Google AI SDK (`@ai-sdk/google` - gemini-1.5-flash)
- Zod ìŠ¤í‚¤ë§ˆ ê²€ì¦

**Tool ëª©ë¡**:

| Tool | ìœ í˜• | ì„¤ëª… | ë³µì¡ë„ |
|------|------|------|--------|
| `analyzeRequest` | Thinking | ì˜ë„+ë³µì¡ë„ ë¶„ì„ | í•­ìƒ |
| `analyzePattern` | Offline | íŒ¨í„´ ë§¤ì¹­ | 1-2 |
| `recommendCommands` | Offline | CLI ëª…ë ¹ì–´ ì¶”ì²œ | 1-2 |
| `getServerMetrics` | Local | ì„œë²„ ë©”íŠ¸ë¦­ ì¡°íšŒ | 2-3 |
| `searchKnowledgeBase` | RAG | ì§€ì‹ë² ì´ìŠ¤ ê²€ìƒ‰ | 3 |
| `callUnifiedProcessor` | GCP | ë³µì¡ ë¶„ì„ (NLP+ML) | 4-5 |

**ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸**:

```
User Query
    â†“
analyzeRequest (Thinking)
    â†“ intent, complexity, recommendation
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ complexity = 1-2: analyzePattern     â”‚
â”‚ complexity = 3: getServerMetrics/RAG â”‚
â”‚ complexity = 4-5: unifiedProcessor   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
streamText Response (Gemini 1.5 Flash)
    â†“
Client (useChat messages)
```

### 3. State Management (V4 ì—…ë°ì´íŠ¸)

**AISidebar Store (Zustand)**:

```typescript
interface AISidebarState {
  // UI ìƒíƒœ
  isOpen: boolean;
  isMinimized: boolean;
  activeTab: 'chat' | 'functions' | 'docs';
  functionTab: 'presets' | 'custom' | 'mcp';

  // ë©”ì‹œì§€ (100ê°œ ì œí•œ, ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°©ì§€)
  messages: AIMessage[];
  sessionId: string;
  selectedContext: AIContext | null;

  // âŒ ì œê±°ë¨ (V4): currentEngine, selectedEngine
  // â†’ UNIFIED ìë™ ëª¨ë“œë¡œ ì „í™˜
}

// Persist ì„¤ì •
const useAISidebarStore = create<AISidebarState>()(
  devtools(
    persist(
      (set, get) => ({...}),
      {
        name: 'ai-sidebar-storage',
        skipHydration: true, // SSR ì•ˆì „
        partialize: (state) => ({
          activeTab: state.activeTab,
          functionTab: state.functionTab,
        }),
      }
    )
  )
);
```

**V4 ì£¼ìš” ë³€ê²½**:
- âœ… `currentEngine` í•„ë“œ ì œê±° (6ê°œ ìœ„ì¹˜)
- âœ… `skipHydration: true` (SSR í˜¸í™˜ì„±)
- âœ… ë©”ì‹œì§€ 100ê°œ ì œí•œ (ë©”ëª¨ë¦¬ ê´€ë¦¬)
- âœ… `partialize`ë¡œ ì„ íƒì  persist

## ğŸ”„ ë°ì´í„° íë¦„ ì•„í‚¤í…ì²˜

### 1. ì‚¬ìš©ì ì¿¼ë¦¬ ì²˜ë¦¬ íë¦„ (V4)

```
1. ì‚¬ìš©ì ì…ë ¥ â†’ AISidebarV4
2. useChat.handleSubmit â†’ ë©”ì‹œì§€ ì¶”ê°€
3. POST /api/ai/unified-stream
4. streamText(gemini-1.5-flash, tools)
5. Tool ì‹¤í–‰ â†’ analyzeRequest â†’ ì „ëµ ê²°ì •
6. ì¶”ê°€ Tool ì‹¤í–‰ (ë³µì¡ë„ ê¸°ë°˜)
7. ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ â†’ toTextStreamResponse()
8. useChat.messages ìë™ ì—…ë°ì´íŠ¸
9. UI ë¦¬ë Œë”ë§
```

### 2. Tool ì‹¤í–‰ íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 AI Model (Gemini)                    â”‚
â”‚                       â†“                              â”‚
â”‚              "analyzeRequest" í˜¸ì¶œ                   â”‚
â”‚                       â†“                              â”‚
â”‚     { intent: "analysis", complexity: 4 }           â”‚
â”‚                       â†“                              â”‚
â”‚     recommendation: "unified-processor"              â”‚
â”‚                       â†“                              â”‚
â”‚         "callUnifiedProcessor" í˜¸ì¶œ                  â”‚
â”‚                       â†“                              â”‚
â”‚  GCP Cloud Function â†’ NLP + ML ë¶„ì„                  â”‚
â”‚                       â†“                              â”‚
â”‚             ê²°ê³¼ + ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ›¡ï¸ ë³´ì•ˆ ì•„í‚¤í…ì²˜

### 1. ì¸ì¦

- **withAuth Middleware**: API ë¼ìš°íŠ¸ ë³´í˜¸
- **useUserPermissions**: í´ë¼ì´ì–¸íŠ¸ ê¶Œí•œ ì²´í¬
- **Guest Full Access**: ë°ëª¨ ëª¨ë“œ ì§€ì›

### 2. API ë³´ì•ˆ

- **Rate Limiting**: maxDuration 30ì´ˆ
- **Input Validation**: Zod ìŠ¤í‚¤ë§ˆ
- **Error Handling**: ì—ëŸ¬ ë…¸ì¶œ ë°©ì§€

## ğŸš€ ì„±ëŠ¥ ìµœì í™”

### 1. í”„ë¡ íŠ¸ì—”ë“œ

- **useChat ìµœì í™”**: Vercel AI SDK ìë™ ìµœì í™”
- **SSR ì•ˆì „**: `skipHydration: true`
- **ë©”ëª¨ë¦¬ ê´€ë¦¬**: ë©”ì‹œì§€ 100ê°œ ì œí•œ

### 2. ë„¤íŠ¸ì›Œí¬

- **ìŠ¤íŠ¸ë¦¬ë°**: ì‹¤ì‹œê°„ í† í° ì „ì†¡
- **Hybrid Engine**: ë³µì¡ë„ ê¸°ë°˜ ë¼ìš°íŒ…ìœ¼ë¡œ ì‘ë‹µ ì‹œê°„ ìµœì í™”
- **íƒ€ì„ì•„ì›ƒ**: GCP 15ì´ˆ, ì „ì²´ 30ì´ˆ

### 3. ì„œë²„

- **Edge Runtime**: Vercel Edge í™œìš©
- **Tool ìºì‹±**: ì˜¤í”„ë¼ì¸ ë„êµ¬ ì¦‰ì‹œ ì‘ë‹µ
- **ì‹œë‚˜ë¦¬ì˜¤ ë¡œë”**: ì‹œë®¬ë ˆì´ì…˜ ë°ì´í„° íš¨ìœ¨ì  ë¡œë“œ

## ğŸ“Š API ì—”ë“œí¬ì¸íŠ¸

### POST /api/ai/unified-stream

**ìš”ì²­**:
```json
{
  "messages": [
    { "role": "user", "content": "ì„œë²„ ìƒíƒœ í™•ì¸í•´ì¤˜" }
  ]
}
```

**ì‘ë‹µ**: Text Stream (SSE)

**Tool ì‹¤í–‰ ìˆœì„œ**:
1. `analyzeRequest` â†’ ì „ëµ ìˆ˜ë¦½
2. ë³µì¡ë„ ê¸°ë°˜ Tool ì„ íƒ
3. ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ ìƒì„±

## ğŸ“ ê¸°ìˆ  ìŠ¤íƒ ìš”ì•½

### Frontend
- **Framework**: Next.js 15.4.5 (App Router)
- **AI SDK**: @ai-sdk/react v1.2.12 (`useChat`)
- **State**: Zustand (persist + devtools)
- **UI**: Radix UI + TailwindCSS

### Backend
- **AI SDK**: ai v4.x (`streamText`, `tool`)
- **Model**: @ai-sdk/google (gemini-1.5-flash)
- **Auth**: withAuth middleware
- **Database**: Supabase (pgvector RAG)

### External Services
- **AI**: Google Generative AI
- **RAG**: Supabase Vector Search
- **Processing**: GCP Cloud Functions

## ğŸ”® V3 â†’ V4 ë§ˆì´ê·¸ë ˆì´ì…˜ ìš”ì•½

| í•­ëª© | V3 | V4 |
|------|----|----|
| ë©”ì‹œì§€ ê´€ë¦¬ | ì»¤ìŠ¤í…€ ìƒíƒœ | useChat hook |
| ì—”ì§„ ì„ íƒ | ìˆ˜ë™ UI | UNIFIED ìë™ |
| API | /api/ai/query | /api/ai/unified-stream |
| ìŠ¤íŠ¸ë¦¬ë° | ì»¤ìŠ¤í…€ êµ¬í˜„ | Vercel AI SDK |
| Tool | - | 6ê°œ tool() ì‹œìŠ¤í…œ |
| ë³µì¡ë„ ë¼ìš°íŒ… | - | Hybrid Engine |

---

> **ë¬¸ì„œ ìœ ì§€ë³´ìˆ˜**: ì´ ì•„í‚¤í…ì²˜ ë¬¸ì„œëŠ” ì‹œìŠ¤í…œ ë³€ê²½ ì‹œ ì¦‰ì‹œ ì—…ë°ì´íŠ¸ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
> **ë²„ì „ ê´€ë¦¬**: v2.0 (2025-12-04) - V4 ì•„í‚¤í…ì²˜ ë°˜ì˜
