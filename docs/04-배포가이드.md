# ë°°í¬ ê°€ì´ë“œ

## ğŸš€ ë°°í¬ ê°œìš”

OpenManager Vibe v5ë¥¼ í”„ë¡œë•ì…˜ í™˜ê²½ì— ë°°í¬í•˜ëŠ” ë°©ë²•ì„ ì„¤ëª…í•©ë‹ˆë‹¤.

## ğŸ—ï¸ ë°°í¬ ì•„í‚¤í…ì²˜

```
Internet
    â†“
Load Balancer
    â†“
Next.js App (Vercel/Docker)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Supabase      â”‚     Redis       â”‚
â”‚ (PostgreSQL)    â”‚   (Upstash)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
Data Collectors
â”œâ”€â”€ Prometheus (Kubernetes)
â”œâ”€â”€ CloudWatch (AWS)
â””â”€â”€ Custom API (On-premise)
```

## ğŸ“‹ ë°°í¬ ì „ ì¤€ë¹„ì‚¬í•­

### 1. í™˜ê²½ ìš”êµ¬ì‚¬í•­
- Node.js 18+
- PostgreSQL 14+ (Supabase ê¶Œì¥)
- Redis 6+ (Upstash ê¶Œì¥)
- Docker (ì„ íƒì‚¬í•­)

### 2. ì™¸ë¶€ ì„œë¹„ìŠ¤ ì„¤ì •
- **Supabase í”„ë¡œì íŠ¸** ìƒì„±
- **Redis ì¸ìŠ¤í„´ìŠ¤** ì¤€ë¹„ (Upstash ë“±)
- **ë„ë©”ì¸** ë° **SSL ì¸ì¦ì„œ** ì¤€ë¹„

### 3. ìˆ˜ì§‘ê¸° ì ‘ê·¼ ê¶Œí•œ
- **Prometheus**: í´ëŸ¬ìŠ¤í„° ì ‘ê·¼ URL
- **AWS CloudWatch**: IAM í‚¤ ë° ê¶Œí•œ
- **Custom API**: ì„œë²„ ì ‘ê·¼ ì—”ë“œí¬ì¸íŠ¸

## ğŸ”§ Vercel ë°°í¬ (ê¶Œì¥)

### 1. Vercel í”„ë¡œì íŠ¸ ì„¤ì •
```bash
# Vercel CLI ì„¤ì¹˜
npm i -g vercel

# í”„ë¡œì íŠ¸ ì—°ê²°
vercel link

# í™˜ê²½ë³€ìˆ˜ ì„¤ì •
vercel env add
```

### 2. í™˜ê²½ë³€ìˆ˜ ì„¤ì •
Vercel ëŒ€ì‹œë³´ë“œì—ì„œ ë‹¤ìŒ í™˜ê²½ë³€ìˆ˜ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤:

```env
# ê¸°ë³¸ ì„¤ì •
NEXT_PUBLIC_SITE_URL=https://your-domain.vercel.app
COLLECTOR_MODE=production

# Supabase
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

# Redis (Upstash)
REDIS_URL=rediss://default:xxx@xxx.upstash.io:6379

# í”„ë¡œë•ì…˜ ìˆ˜ì§‘ê¸°
PROMETHEUS_URL=https://prometheus.your-k8s.com
AWS_ACCESS_KEY_ID=AKIAIOSFODNN7EXAMPLE
AWS_SECRET_ACCESS_KEY=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY
AWS_REGION=ap-northeast-2
CUSTOM_API_ENDPOINTS=https://server1.com/metrics,https://server2.com/metrics
```

### 3. ë°°í¬ ì‹¤í–‰
```bash
# í”„ë¡œë•ì…˜ ë°°í¬
vercel --prod
```

### 4. ë„ë©”ì¸ ì„¤ì •
```bash
# ì»¤ìŠ¤í…€ ë„ë©”ì¸ ì¶”ê°€
vercel domains add your-domain.com
```

## ğŸ³ Docker ë°°í¬

### 1. Dockerfile ìƒì„±
```dockerfile
FROM node:18-alpine AS base

# ì˜ì¡´ì„± ì„¤ì¹˜
FROM base AS deps
WORKDIR /app
COPY package*.json ./
RUN npm ci

# ë¹Œë“œ ë‹¨ê³„
FROM base AS builder
WORKDIR /app
COPY --from=deps /app/node_modules ./node_modules
COPY . .
RUN npm run build

# í”„ë¡œë•ì…˜ ë‹¨ê³„
FROM base AS runner
WORKDIR /app

ENV NODE_ENV=production

RUN addgroup --system --gid 1001 nodejs
RUN adduser --system --uid 1001 nextjs

COPY --from=builder /app/public ./public
COPY --from=builder --chown=nextjs:nodejs /app/.next/standalone ./
COPY --from=builder --chown=nextjs:nodejs /app/.next/static ./.next/static

USER nextjs

EXPOSE 3000
ENV PORT=3000

CMD ["node", "server.js"]
```

### 2. Docker Compose ì„¤ì •
```yaml
# docker-compose.yml
version: '3.8'

services:
  app:
    build: .
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - SUPABASE_URL=${SUPABASE_URL}
      - SUPABASE_ANON_KEY=${SUPABASE_ANON_KEY}
      - REDIS_URL=${REDIS_URL}
      - COLLECTOR_MODE=production
    depends_on:
      - redis
    
  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data

  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
      - ./ssl:/etc/ssl
    depends_on:
      - app

volumes:
  redis_data:
```

### 3. ë°°í¬ ì‹¤í–‰
```bash
# ì´ë¯¸ì§€ ë¹Œë“œ ë° ì‹¤í–‰
docker-compose up -d

# ë¡œê·¸ í™•ì¸
docker-compose logs -f app
```

## â˜ï¸ AWS EC2 ë°°í¬

### 1. EC2 ì¸ìŠ¤í„´ìŠ¤ ì¤€ë¹„
```bash
# Ubuntu 22.04 LTS ì¸ìŠ¤í„´ìŠ¤ì—ì„œ
sudo apt update
sudo apt install -y nodejs npm nginx

# PM2 ì„¤ì¹˜ (í”„ë¡œì„¸ìŠ¤ ê´€ë¦¬)
sudo npm install -g pm2
```

### 2. ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬
```bash
# ì½”ë“œ ë°°í¬
git clone https://github.com/your-repo/openmanager-vibe-v5.git
cd openmanager-vibe-v5

# ì˜ì¡´ì„± ì„¤ì¹˜ ë° ë¹Œë“œ
npm install
npm run build

# í™˜ê²½ë³€ìˆ˜ ì„¤ì •
cp .env.example .env.local
# .env.local í¸ì§‘

# PM2ë¡œ ì‹¤í–‰
pm2 start npm --name "openmanager" -- start
pm2 save
pm2 startup
```

### 3. Nginx ì„¤ì •
```nginx
# /etc/nginx/sites-available/openmanager
server {
    listen 80;
    server_name your-domain.com;
    
    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }
}
```

```bash
# Nginx ì„¤ì • í™œì„±í™”
sudo ln -s /etc/nginx/sites-available/openmanager /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl restart nginx

# SSL ì¸ì¦ì„œ ì„¤ì • (Let's Encrypt)
sudo apt install certbot python3-certbot-nginx
sudo certbot --nginx -d your-domain.com
```

## ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •

### 1. Supabase í”„ë¡œì íŠ¸ ìƒì„±
1. https://supabase.com ì—ì„œ ìƒˆ í”„ë¡œì íŠ¸ ìƒì„±
2. ë°ì´í„°ë² ì´ìŠ¤ ë¹„ë°€ë²ˆí˜¸ ì„¤ì •
3. API í‚¤ ë³µì‚¬

### 2. ìŠ¤í‚¤ë§ˆ ì„¤ì •
```bash
# ë¡œì»¬ì—ì„œ ìŠ¤í‚¤ë§ˆ ì ìš©
psql -h db.your-project.supabase.co -U postgres -d postgres -f scripts/setup-database.sql
```

### 3. RLS (Row Level Security) ì„¤ì •
Supabase ëŒ€ì‹œë³´ë“œì—ì„œ:
1. Authentication â†’ Settings â†’ "Enable RLS" ì²´í¬
2. Table Editorì—ì„œ ì •ì±… ì„¤ì •

## ğŸ”„ Redis ì„¤ì •

### 1. Upstash Redis (ê¶Œì¥)
1. https://upstash.com ì—ì„œ ë°ì´í„°ë² ì´ìŠ¤ ìƒì„±
2. ì—°ê²° URL ë³µì‚¬
3. í™˜ê²½ë³€ìˆ˜ì— ì„¤ì •

### 2. ìì²´ Redis ì„œë²„
```bash
# Ubuntuì—ì„œ Redis ì„¤ì¹˜
sudo apt install redis-server

# ì„¤ì • í¸ì§‘
sudo nano /etc/redis/redis.conf

# ë³´ì•ˆ ì„¤ì •
requirepass your-strong-password
bind 127.0.0.1

# ì„œë¹„ìŠ¤ ì¬ì‹œì‘
sudo systemctl restart redis-server
```

## ğŸ“Š ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹…

### 1. ì• í”Œë¦¬ì¼€ì´ì…˜ ëª¨ë‹ˆí„°ë§
```bash
# PM2 ëª¨ë‹ˆí„°ë§
pm2 monit

# ë¡œê·¸ í™•ì¸
pm2 logs openmanager

# ì„±ëŠ¥ ë©”íŠ¸ë¦­
pm2 show openmanager
```

### 2. ë¡œê·¸ ìˆ˜ì§‘ ì„¤ì •
```javascript
// next.config.tsì— ì¶”ê°€
const nextConfig = {
  experimental: {
    instrumentationHook: true,
  },
  logging: {
    fetches: {
      fullUrl: true,
    },
  },
}
```

### 3. ì•Œë¦¼ ì„¤ì •
```bash
# PM2 ì•Œë¦¼ ì„¤ì •
pm2 install pm2-logrotate
pm2 install pm2-auto-pull
```

## ğŸ”’ ë³´ì•ˆ ì„¤ì •

### 1. í™˜ê²½ë³€ìˆ˜ ë³´ì•ˆ
```bash
# í™˜ê²½ë³€ìˆ˜ íŒŒì¼ ê¶Œí•œ ì„¤ì •
chmod 600 .env.local

# Gitì—ì„œ ì œì™¸
echo ".env.local" >> .gitignore
```

### 2. ë°©í™”ë²½ ì„¤ì •
```bash
# UFW ë°©í™”ë²½ ì„¤ì •
sudo ufw enable
sudo ufw allow ssh
sudo ufw allow 80
sudo ufw allow 443
```

### 3. SSL/TLS ì„¤ì •
```bash
# ê°•ë ¥í•œ SSL ì„¤ì •
sudo nano /etc/nginx/snippets/ssl-params.conf

# ë‚´ìš©:
ssl_protocols TLSv1.2 TLSv1.3;
ssl_prefer_server_ciphers on;
ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384;
```

## ğŸ¯ ì„±ëŠ¥ ìµœì í™”

### 1. Next.js ìµœì í™”
```javascript
// next.config.ts
const nextConfig = {
  compress: true,
  swcMinify: true,
  images: {
    optimized: true,
  },
  experimental: {
    appDir: true,
  },
}
```

### 2. CDN ì„¤ì •
```bash
# Vercelì˜ ê²½ìš° ìë™ CDN ì œê³µ
# AWS CloudFront ë˜ëŠ” Cloudflare ì‚¬ìš© ê¶Œì¥
```

### 3. ìºì‹± ì „ëµ
```bash
# Redis ìºì‹œ ìµœì í™”
# TTL ì„¤ì •: 5ë¶„ (ë©”íŠ¸ë¦­ ë°ì´í„°)
# ì••ì¶• í™œì„±í™”
```

## ğŸ” ë°°í¬ ê²€ì¦

### 1. í—¬ìŠ¤ ì²´í¬
```bash
# API ì—”ë“œí¬ì¸íŠ¸ í™•ì¸
curl https://your-domain.com/api/health
curl https://your-domain.com/api/ping
```

### 2. ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
```bash
# ë¶€í•˜ í…ŒìŠ¤íŠ¸ (ì˜ˆ: Artillery)
npm install -g artillery
artillery quick --count 50 --num 100 https://your-domain.com
```

### 3. ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
```bash
# ì£¼ìš” API í…ŒìŠ¤íŠ¸
curl https://your-domain.com/api/servers
curl https://your-domain.com/api/dashboard
```

## ğŸš¨ ì¥ì•  ëŒ€ì‘

### 1. ë¡¤ë°± ì ˆì°¨
```bash
# Vercel ë¡¤ë°±
vercel --prod --env=rollback

# PM2 ë¡¤ë°±
pm2 reload openmanager
```

### 2. ë¡œê·¸ ë¶„ì„
```bash
# ì—ëŸ¬ ë¡œê·¸ í™•ì¸
pm2 logs openmanager --err
tail -f /var/log/nginx/error.log
```

### 3. ê¸´ê¸‰ ëŒ€ì‘
```bash
# ì„œë¹„ìŠ¤ ì¬ì‹œì‘
pm2 restart openmanager
sudo systemctl restart nginx
```

## ğŸ“ ë°°í¬ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ë°°í¬ ì „
- [ ] í™˜ê²½ë³€ìˆ˜ ì„¤ì • í™•ì¸
- [ ] ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ì ìš©
- [ ] Redis ì—°ê²° í…ŒìŠ¤íŠ¸
- [ ] ìˆ˜ì§‘ê¸° ì„¤ì • ê²€ì¦
- [ ] ë¹Œë“œ ì„±ê³µ í™•ì¸

### ë°°í¬ í›„
- [ ] í—¬ìŠ¤ ì²´í¬ API í™•ì¸
- [ ] ì£¼ìš” ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
- [ ] ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ì„¤ì •
- [ ] ë¡œê·¸ ìˆ˜ì§‘ ì„¤ì •
- [ ] ë°±ì—… ì •ì±… ìˆ˜ë¦½

### ë³´ì•ˆ ì²´í¬
- [ ] SSL ì¸ì¦ì„œ ì„¤ì •
- [ ] ë°©í™”ë²½ ê·œì¹™ ì ìš©
- [ ] ë¯¼ê°í•œ ì •ë³´ í™˜ê²½ë³€ìˆ˜ ì²˜ë¦¬
- [ ] ì ‘ê·¼ ê¶Œí•œ ìµœì†Œí™”

ëª¨ë“  ë°°í¬ ê³¼ì •ì€ **í•œêµ­ì–´ ë¬¸ì„œ**ë¡œ ê´€ë¦¬í•˜ë©°, ì˜ì–´ ë¬¸ì„œëŠ” ìƒì„±í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. 