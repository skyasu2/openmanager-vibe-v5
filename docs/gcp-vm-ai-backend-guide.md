# GCP VM AI Î∞±ÏóîÎìú Íµ¨Ï∂ï Í∞ÄÏù¥Îìú

## üìã Î™©Ï∞®

1. [GCP e2-micro VM Î¨¥Î£å Ìã∞Ïñ¥ Í∞úÏöî](#1-gcp-e2-micro-vm-Î¨¥Î£å-Ìã∞Ïñ¥-Í∞úÏöî)
2. [VM Ï¥àÍ∏∞ ÏÑ§Ï†ï](#2-vm-Ï¥àÍ∏∞-ÏÑ§Ï†ï)
3. [AI Î∞±ÏóîÎìú ÏÑúÎ≤Ñ ÏÑ§Ïπò](#3-ai-Î∞±ÏóîÎìú-ÏÑúÎ≤Ñ-ÏÑ§Ïπò)
4. [VM Î∞±ÏóîÎìú API ÏÑúÎ≤Ñ Íµ¨ÌòÑ](#4-vm-Î∞±ÏóîÎìú-api-ÏÑúÎ≤Ñ-Íµ¨ÌòÑ)
5. [AI Ïñ¥ÏãúÏä§ÌÑ¥Ìä∏ Ïó∞Îèô](#5-ai-Ïñ¥ÏãúÏä§ÌÑ¥Ìä∏-Ïó∞Îèô)
6. [Î¨¥Î£å Ìã∞Ïñ¥ ÏµúÏ†ÅÌôî Ï†ÑÎûµ](#6-Î¨¥Î£å-Ìã∞Ïñ¥-ÏµúÏ†ÅÌôî-Ï†ÑÎûµ)
7. [Î™®ÎãàÌÑ∞ÎßÅ Î∞è Í¥ÄÎ¶¨](#7-Î™®ÎãàÌÑ∞ÎßÅ-Î∞è-Í¥ÄÎ¶¨)

## 1. GCP e2-micro VM Î¨¥Î£å Ìã∞Ïñ¥ Í∞úÏöî

### Î¨¥Î£å Ìã∞Ïñ¥ ÏÇ¨Ïñë
- **Ïù∏Ïä§ÌÑ¥Ïä§**: e2-micro (1 vCPU, 1GB Î©îÎ™®Î¶¨)
- **Ïä§ÌÜ†Î¶¨ÏßÄ**: 30GB ÌëúÏ§Ä persistent disk
- **ÎÑ§Ìä∏ÏõåÌÅ¨**: 1GB Î∂ÅÎØ∏ ‚Üí Ï§ëÍµ≠/Ïò§Ïä§Ìä∏Î†àÏùºÎ¶¨ÏïÑ Ï†úÏô∏ Î™®Îì† ÏßÄÏó≠
- **ÏßÄÏó≠**: us-west1, us-central1, us-east1 Ï§ë 1Í∞ú
- **Í∞ÄÎèô ÏãúÍ∞Ñ**: 744ÏãúÍ∞Ñ/Ïõî (24/7 Ïö¥ÏòÅ Í∞ÄÎä•)

### ÌôúÏö© Í∞ÄÎä•Ìïú ÏÑúÎπÑÏä§
- AI Î∞±ÏóîÎìú API ÏÑúÎ≤Ñ
- Îî• Îü¨Îãù Î™®Îç∏ ÏÑúÎπô (Í≤ΩÎüâ Î™®Îç∏)
- Ï∫êÏã± Î†àÏù¥Ïñ¥ (Î©îÎ™®Î¶¨ Í∏∞Î∞ò)
- Ïä§ÏºÄÏ§ÑÎü¨/ÌÅ¨Î°†Ïû°
- ÏõπÌõÖ Ï≤òÎ¶¨ ÏÑúÎ≤Ñ
- Î™®ÎãàÌÑ∞ÎßÅ ÏóêÏù¥Ï†ÑÌä∏

## 2. VM Ï¥àÍ∏∞ ÏÑ§Ï†ï

### 2.1 VM Ïù∏Ïä§ÌÑ¥Ïä§ ÏÉùÏÑ±

```bash
# gcloud CLIÎ°ú VM ÏÉùÏÑ±
gcloud compute instances create openmanager-vm \
  --zone=us-central1-a \
  --machine-type=e2-micro \
  --image-family=ubuntu-2204-lts \
  --image-project=ubuntu-os-cloud \
  --boot-disk-size=30GB \
  --boot-disk-type=pd-standard \
  --tags=http-server,https-server
```

### 2.2 Î∞©ÌôîÎ≤Ω Í∑úÏπô ÏÑ§Ï†ï

```bash
# HTTP/HTTPS Ìä∏ÎûòÌîΩ ÌóàÏö©
gcloud compute firewall-rules create allow-http \
  --allow tcp:80,tcp:443 \
  --source-ranges 0.0.0.0/0 \
  --target-tags http-server,https-server

# MCP ÏÑúÎ≤Ñ Ìè¨Ìä∏ (8080-8090)
gcloud compute firewall-rules create allow-mcp \
  --allow tcp:8080-8090 \
  --source-ranges 0.0.0.0/0 \
  --target-tags mcp-server
```

### 2.3 SSH Ï†ëÏÜç Î∞è Í∏∞Î≥∏ Ìå®ÌÇ§ÏßÄ ÏÑ§Ïπò

```bash
# SSH Ï†ëÏÜç
gcloud compute ssh openmanager-vm --zone=us-central1-a

# ÏãúÏä§ÌÖú ÏóÖÎç∞Ïù¥Ìä∏
sudo apt update && sudo apt upgrade -y

# ÌïÑÏàò Ìå®ÌÇ§ÏßÄ ÏÑ§Ïπò
sudo apt install -y \
  curl wget git build-essential \
  python3 python3-pip python3-venv \
  nodejs npm \
  nginx supervisor \
  htop tmux
```

## 3. MCP ÏÑúÎ≤Ñ ÏÑ§Ïπò Í∞ÄÏù¥Îìú

### 3.1 Node.js ÌôòÍ≤Ω ÏÑ§Ï†ï (nvm ÏÇ¨Ïö©)

```bash
# nvm ÏÑ§Ïπò
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
source ~/.bashrc

# Node.js 22 ÏÑ§Ïπò
nvm install 22
nvm use 22
nvm alias default 22

# Ï†ÑÏó≠ Ìå®ÌÇ§ÏßÄ ÏÑ§Ïπò
npm install -g pm2 npx
```

### 3.2 Python ÌôòÍ≤Ω ÏÑ§Ï†ï

```bash
# Python 3.11 ÏÑ§Ïπò (Ubuntu 22.04 Í∏∞Î≥∏ÏùÄ 3.10)
sudo add-apt-repository ppa:deadsnakes/ppa
sudo apt update
sudo apt install -y python3.11 python3.11-venv python3.11-dev

# pip ÏóÖÍ∑∏Î†àÏù¥Îìú
python3.11 -m pip install --upgrade pip

# uv ÏÑ§Ïπò (Python Ìå®ÌÇ§ÏßÄ Í¥ÄÎ¶¨Ïûê)
curl -LsSf https://astral.sh/uv/install.sh | sh
source ~/.bashrc
```

### 3.3 MCP ÏÑúÎ≤Ñ ÏÑ§Ïπò

```bash
# MCP ÏÑúÎ≤Ñ ÎîîÎ†âÌÜ†Î¶¨ ÏÉùÏÑ±
mkdir -p ~/mcp-servers
cd ~/mcp-servers

# 1. filesystem ÏÑúÎ≤Ñ
npm install @modelcontextprotocol/server-filesystem

# 2. memory ÏÑúÎ≤Ñ (ÏßÄÏãù Í∑∏ÎûòÌîÑ)
npm install @modelcontextprotocol/server-memory

# 3. github ÏÑúÎ≤Ñ
npm install @modelcontextprotocol/server-github

# 4. sequential-thinking ÏÑúÎ≤Ñ
npm install @modelcontextprotocol/server-sequential-thinking

# 5. time ÏÑúÎ≤Ñ (Python)
uvx --from mcp-server-time mcp-server-time

# 6. context7 ÏÑúÎ≤Ñ
npm install @upstash/context7-mcp

# 7. serena ÏÑúÎ≤Ñ (Python)
git clone https://github.com/oraios/serena.git
cd serena
python3.11 -m venv venv
source venv/bin/activate
pip install -e .
cd ..

# 8. shadcn-ui ÏÑúÎ≤Ñ
npm install @jpisnice/shadcn-ui-mcp-server
```

### 3.4 MCP ÏÑúÎ≤Ñ ÏÑ§Ï†ï ÌååÏùº

```bash
# ~/mcp-servers/config.json
cat > ~/mcp-servers/config.json << 'EOF'
{
  "servers": {
    "filesystem": {
      "command": "node",
      "args": ["node_modules/@modelcontextprotocol/server-filesystem/dist/index.js", "/home/openmanager"],
      "port": 8080
    },
    "memory": {
      "command": "node",
      "args": ["node_modules/@modelcontextprotocol/server-memory/dist/index.js"],
      "port": 8081
    },
    "github": {
      "command": "node",
      "args": ["node_modules/@modelcontextprotocol/server-github/dist/index.js"],
      "env": {
        "GITHUB_PERSONAL_ACCESS_TOKEN": "${GITHUB_TOKEN}"
      },
      "port": 8082
    },
    "sequential-thinking": {
      "command": "node",
      "args": ["node_modules/@modelcontextprotocol/server-sequential-thinking/dist/index.js"],
      "port": 8083
    },
    "time": {
      "command": "uvx",
      "args": ["--from", "mcp-server-time", "mcp-server-time"],
      "port": 8084
    },
    "context7": {
      "command": "node",
      "args": ["node_modules/@upstash/context7-mcp/dist/index.js"],
      "port": 8085
    },
    "serena": {
      "command": "python3.11",
      "args": ["serena/src/serena_mcp/server.py", "--project", "/home/openmanager/project"],
      "port": 8086
    },
    "shadcn-ui": {
      "command": "node",
      "args": ["node_modules/@jpisnice/shadcn-ui-mcp-server/dist/index.js"],
      "port": 8087
    }
  }
}
EOF
```

### 3.5 PM2Î°ú MCP ÏÑúÎ≤Ñ Í¥ÄÎ¶¨

```bash
# PM2 ecosystem ÌååÏùº ÏÉùÏÑ±
cat > ~/ai-backend-services/ecosystem.config.js << 'EOF'
module.exports = {
  apps: [
    {
      name: 'mcp-filesystem',
      script: 'node_modules/@modelcontextprotocol/server-filesystem/dist/index.js',
      args: '/home/openmanager',
      env: {
        PORT: 8080
      }
    },
    {
      name: 'mcp-memory',
      script: 'node_modules/@modelcontextprotocol/server-memory/dist/index.js',
      env: {
        PORT: 8081
      }
    },
    {
      name: 'mcp-github',
      script: 'node_modules/@modelcontextprotocol/server-github/dist/index.js',
      env: {
        GITHUB_PERSONAL_ACCESS_TOKEN: process.env.GITHUB_TOKEN,
        PORT: 8082
      }
    },
    {
      name: 'mcp-sequential',
      script: 'node_modules/@modelcontextprotocol/server-sequential-thinking/dist/index.js',
      env: {
        PORT: 8083
      }
    },
    {
      name: 'mcp-context7',
      script: 'node_modules/@upstash/context7-mcp/dist/index.js',
      env: {
        PORT: 8085
      }
    },
    {
      name: 'mcp-shadcn',
      script: 'node_modules/@jpisnice/shadcn-ui-mcp-server/dist/index.js',
      env: {
        PORT: 8087
      }
    }
  ]
};
EOF

# PM2 ÏãúÏûë
pm2 start ecosystem.config.js
pm2 save
pm2 startup
```

## 4. VM Î∞±ÏóîÎìú API ÏÑúÎ≤Ñ Íµ¨ÌòÑ

### 4.1 Express API ÏÑúÎ≤Ñ ÏÑ§Ï†ï

```bash
# API ÏÑúÎ≤Ñ ÎîîÎ†âÌÜ†Î¶¨ ÏÉùÏÑ±
mkdir -p ~/api-server
cd ~/api-server

# package.json ÏÉùÏÑ±
npm init -y
npm install express cors helmet morgan compression dotenv
npm install -D @types/node @types/express typescript nodemon

# TypeScript ÏÑ§Ï†ï
npx tsc --init
```

### 4.2 API ÏÑúÎ≤Ñ ÏΩîÎìú

```typescript
// ~/api-server/src/index.ts
import express from 'express';
import cors from 'cors';
import helmet from 'helmet';
import morgan from 'morgan';
import compression from 'compression';
import { mcpRouter } from './routes/mcp';
import { aiRouter } from './routes/ai';
import { cacheRouter } from './routes/cache';
import { healthRouter } from './routes/health';

const app = express();
const PORT = process.env.PORT || 3001;

// ÎØ∏Îì§Ïõ®Ïñ¥
app.use(helmet());
app.use(cors());
app.use(compression());
app.use(morgan('combined'));
app.use(express.json());

// ÎùºÏö∞Ìä∏
app.use('/api/mcp', mcpRouter);
app.use('/api/ai', aiRouter);
app.use('/api/cache', cacheRouter);
app.use('/api/health', healthRouter);

// ÏóêÎü¨ Ìï∏Îì§Îü¨
app.use((err: Error, req: express.Request, res: express.Response, next: express.NextFunction) => {
  console.error(err.stack);
  res.status(500).json({ error: 'Internal Server Error' });
});

app.listen(PORT, () => {
  console.log(`VM Backend API Server running on port ${PORT}`);
});
```

### 4.3 MCP ÏÑúÎ≤Ñ Ïó∞Îèô ÎùºÏö∞ÌÑ∞

```typescript
// ~/api-server/src/routes/mcp.ts
import { Router } from 'express';
import axios from 'axios';

const router = Router();

// MCP ÏÑúÎ≤Ñ ÏÉÅÌÉú ÌôïÏù∏
router.get('/status', async (req, res) => {
  const servers = [
    { name: 'filesystem', port: 8080 },
    { name: 'memory', port: 8081 },
    { name: 'github', port: 8082 },
    { name: 'sequential-thinking', port: 8083 },
    { name: 'time', port: 8084 },
    { name: 'context7', port: 8085 },
    { name: 'serena', port: 8086 },
    { name: 'shadcn-ui', port: 8087 }
  ];

  const statuses = await Promise.all(
    servers.map(async (server) => {
      try {
        const response = await axios.get(`http://localhost:${server.port}/health`, {
          timeout: 1000
        });
        return { ...server, status: 'online', response: response.data };
      } catch (error) {
        return { ...server, status: 'offline', error: error.message };
      }
    })
  );

  res.json({ servers: statuses });
});

// MCP ÏÑúÎ≤ÑÎ°ú Î™ÖÎ†π Ï†ÑÎã¨
router.post('/:server/execute', async (req, res) => {
  const { server } = req.params;
  const { command, params } = req.body;

  const serverPorts: Record<string, number> = {
    filesystem: 8080,
    memory: 8081,
    github: 8082,
    'sequential-thinking': 8083,
    time: 8084,
    context7: 8085,
    serena: 8086,
    'shadcn-ui': 8087
  };

  const port = serverPorts[server];
  if (!port) {
    return res.status(404).json({ error: 'Server not found' });
  }

  try {
    const response = await axios.post(
      `http://localhost:${port}/execute`,
      { command, params },
      { timeout: 30000 }
    );
    res.json(response.data);
  } catch (error) {
    res.status(500).json({ error: error.message });
  }
});

export { router as mcpRouter };
```

### 4.4 AI Ïñ¥ÏãúÏä§ÌÑ¥Ìä∏ Ïó∞Îèô ÎùºÏö∞ÌÑ∞

```typescript
// ~/api-server/src/routes/ai.ts
import { Router } from 'express';
import { MemoryCache } from '../services/cache';
import { MCPExecutor } from '../services/mcp-executor';

const router = Router();
const cache = new MemoryCache();
const mcpExecutor = new MCPExecutor();

// AI ÏøºÎ¶¨ Ï≤òÎ¶¨
router.post('/query', async (req, res) => {
  const { query, context, useCache = true } = req.body;

  // Ï∫êÏãú Ï≤¥ÌÅ¨
  if (useCache) {
    const cached = cache.get(`query:${query}`);
    if (cached) {
      return res.json({ ...cached, fromCache: true });
    }
  }

  try {
    // MCP ÏÑúÎ≤ÑÎ•º ÌôúÏö©Ìïú ÏøºÎ¶¨ Ï≤òÎ¶¨
    const result = await mcpExecutor.processQuery(query, context);
    
    // Ï∫êÏãú Ï†ÄÏû•
    if (useCache) {
      cache.set(`query:${query}`, result, 300); // 5Î∂Ñ TTL
    }

    res.json({ ...result, fromCache: false });
  } catch (error) {
    res.status(500).json({ error: error.message });
  }
});

// ÏÑúÎ≤Ñ Î©îÌä∏Î¶≠ Î∂ÑÏÑù
router.post('/analyze-metrics', async (req, res) => {
  const { serverId, metrics } = req.body;

  try {
    // Sequential thinkingÏúºÎ°ú Î∂ÑÏÑù
    const analysis = await mcpExecutor.execute('sequential-thinking', 'analyze', {
      data: metrics,
      prompt: `Analyze server ${serverId} metrics and identify anomalies`
    });

    // Memory ÏÑúÎ≤ÑÏóê Ï†ÄÏû•
    await mcpExecutor.execute('memory', 'store', {
      key: `analysis:${serverId}:${Date.now()}`,
      value: analysis
    });

    res.json({ analysis });
  } catch (error) {
    res.status(500).json({ error: error.message });
  }
});

export { router as aiRouter };
```

## 5. AI Ïñ¥ÏãúÏä§ÌÑ¥Ìä∏ Ïó∞Îèô

### 5.1 ÌîÑÎ°†Ìä∏ÏóîÎìú ÏÑúÎπÑÏä§ Íµ¨ÌòÑ

```typescript
// src/services/vm-backend.service.ts
export class VMBackendService {
  private baseUrl: string;

  constructor() {
    this.baseUrl = process.env.NEXT_PUBLIC_VM_API_URL || 'http://vm-ip:3001/api';
  }

  async queryAI(query: string, context?: any): Promise<any> {
    const response = await fetch(`${this.baseUrl}/ai/query`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ query, context })
    });
    return response.json();
  }

  async analyzeMetrics(serverId: string, metrics: any): Promise<any> {
    const response = await fetch(`${this.baseUrl}/ai/analyze-metrics`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ serverId, metrics })
    });
    return response.json();
  }

  async getMCPStatus(): Promise<any> {
    const response = await fetch(`${this.baseUrl}/mcp/status`);
    return response.json();
  }

  async executeMCPCommand(server: string, command: string, params: any): Promise<any> {
    const response = await fetch(`${this.baseUrl}/mcp/${server}/execute`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ command, params })
    });
    return response.json();
  }
}
```

### 5.2 AI Ïñ¥ÏãúÏä§ÌÑ¥Ìä∏ ÌÜµÌï©

```typescript
// src/services/ai/vm-integrated-engine.ts
import { VMBackendService } from '../vm-backend.service';

export class VMIntegratedAIEngine {
  private vmBackend: VMBackendService;
  
  constructor() {
    this.vmBackend = new VMBackendService();
  }

  async processQuery(query: string): Promise<any> {
    try {
      // VM Î∞±ÏóîÎìúÎ°ú ÏøºÎ¶¨ Ï†ÑÏÜ°
      const result = await this.vmBackend.queryAI(query, {
        timestamp: new Date().toISOString(),
        source: 'dashboard'
      });

      // Í≤∞Í≥º Ìè¨Îß∑ÌåÖ
      return {
        answer: result.answer,
        confidence: result.confidence,
        sources: result.sources,
        processingTime: result.processingTime
      };
    } catch (error) {
      console.error('VM AI query failed:', error);
      // Ìè¥Î∞±: Î°úÏª¨ Ï≤òÎ¶¨
      return this.processLocally(query);
    }
  }

  private async processLocally(query: string): Promise<any> {
    // Î°úÏª¨ Ìè¥Î∞± Î°úÏßÅ
    return {
      answer: 'ÌòÑÏû¨ VM ÏÑúÎ≤ÑÏôÄ Ïó∞Í≤∞Ìï† Ïàò ÏóÜÏäµÎãàÎã§. Î°úÏª¨ Î™®ÎìúÎ°ú Ï≤òÎ¶¨ Ï§ëÏûÖÎãàÎã§.',
      confidence: 0.5,
      sources: ['local'],
      processingTime: 0
    };
  }
}
```

## 6. Î¨¥Î£å Ìã∞Ïñ¥ ÏµúÏ†ÅÌôî Ï†ÑÎûµ

### 6.1 Î¶¨ÏÜåÏä§ Î™®ÎãàÌÑ∞ÎßÅ

```bash
# Î©îÎ™®Î¶¨ ÏÇ¨Ïö©Îüâ Î™®ÎãàÌÑ∞ÎßÅ Ïä§ÌÅ¨Î¶ΩÌä∏
cat > ~/monitor.sh << 'EOF'
#!/bin/bash

# Î©îÎ™®Î¶¨ ÏûÑÍ≥ÑÍ∞í (MB)
MEMORY_THRESHOLD=800

while true; do
  # ÌòÑÏû¨ Î©îÎ™®Î¶¨ ÏÇ¨Ïö©Îüâ
  MEMORY_USED=$(free -m | awk 'NR==2{print $3}')
  
  if [ $MEMORY_USED -gt $MEMORY_THRESHOLD ]; then
    echo "‚ö†Ô∏è Memory usage high: ${MEMORY_USED}MB"
    
    # PM2 ÌîÑÎ°úÏÑ∏Ïä§ Ïû¨ÏãúÏûë
    pm2 restart all
    
    # Ï∫êÏãú Ï†ïÎ¶¨
    sync && echo 3 | sudo tee /proc/sys/vm/drop_caches
  fi
  
  sleep 60
done
EOF

chmod +x ~/monitor.sh
```

### 6.2 ÏûêÎèô Ïä§ÏºÄÏùºÎßÅ (ÌîÑÎ°úÏÑ∏Ïä§ Î†àÎ≤®)

```javascript
// ~/api-server/src/services/auto-scale.ts
import { exec } from 'child_process';
import os from 'os';

export class AutoScaler {
  private readonly CPU_THRESHOLD = 0.8;
  private readonly MEMORY_THRESHOLD = 0.85;

  async checkAndScale(): Promise<void> {
    const cpuUsage = os.loadavg()[0] / os.cpus().length;
    const memoryUsage = 1 - (os.freemem() / os.totalmem());

    if (cpuUsage > this.CPU_THRESHOLD) {
      console.log('High CPU usage detected, reducing workers');
      exec('pm2 scale mcp-sequential 0'); // ÏûÑÏãú Ï§ëÏßÄ
    }

    if (memoryUsage > this.MEMORY_THRESHOLD) {
      console.log('High memory usage detected, restarting services');
      exec('pm2 restart all');
    }
  }
}
```

### 6.3 Ïä§Ïôë Î©îÎ™®Î¶¨ ÏÑ§Ï†ï

```bash
# 2GB Ïä§Ïôë ÌååÏùº ÏÉùÏÑ± (Î©îÎ™®Î¶¨ Î∂ÄÏ°± ÎåÄÎπÑ)
sudo fallocate -l 2G /swapfile
sudo chmod 600 /swapfile
sudo mkswap /swapfile
sudo swapon /swapfile

# ÏòÅÍµ¨ ÏÑ§Ï†ï
echo '/swapfile none swap sw 0 0' | sudo tee -a /etc/fstab

# Ïä§Ïôë ÏÑ§Ï†ï ÏµúÏ†ÅÌôî
sudo sysctl vm.swappiness=10
sudo sysctl vm.vfs_cache_pressure=50
```

## 7. Î™®ÎãàÌÑ∞ÎßÅ Î∞è Í¥ÄÎ¶¨

### 7.1 Nginx Î¶¨Î≤ÑÏä§ ÌîÑÎ°ùÏãú ÏÑ§Ï†ï

```nginx
# /etc/nginx/sites-available/vm-backend
server {
    listen 80;
    server_name vm.openmanager.app;

    # API ÏÑúÎ≤Ñ
    location /api/ {
        proxy_pass http://localhost:3001/api/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    # MCP ÏÑúÎ≤Ñ ÏÉÅÌÉú
    location /mcp-status {
        proxy_pass http://localhost:3001/api/mcp/status;
    }

    # Ìó¨Ïä§Ï≤¥ÌÅ¨
    location /health {
        proxy_pass http://localhost:3001/api/health;
    }
}
```

### 7.2 ÏãúÏä§ÌÖú Î™®ÎãàÌÑ∞ÎßÅ ÎåÄÏãúÎ≥¥Îìú

```bash
# Grafana + Prometheus ÏÑ§Ïπò (Í≤ΩÎüâ ÏÑ§Ï†ï)
# ... (ÏÑ§Ïπò Ïä§ÌÅ¨Î¶ΩÌä∏)

# PM2 Î™®ÎãàÌÑ∞ÎßÅ
pm2 install pm2-metrics
pm2 web
```

### 7.3 Î∞±ÏóÖ Ï†ÑÎûµ

```bash
# ÏùºÏùº Î∞±ÏóÖ Ïä§ÌÅ¨Î¶ΩÌä∏
cat > ~/backup.sh << 'EOF'
#!/bin/bash

BACKUP_DIR="/home/backup/$(date +%Y%m%d)"
mkdir -p $BACKUP_DIR

# MCP ÏÑúÎ≤Ñ ÏÑ§Ï†ï Î∞±ÏóÖ
cp -r ~/mcp-servers/config.json $BACKUP_DIR/

# PM2 ÌîÑÎ°úÏÑ∏Ïä§ Î∞±ÏóÖ
pm2 save
cp ~/.pm2/dump.pm2 $BACKUP_DIR/

# API ÏÑúÎ≤Ñ Î∞±ÏóÖ
tar -czf $BACKUP_DIR/api-server.tar.gz ~/api-server/

# Ïò§ÎûòÎêú Î∞±ÏóÖ ÏÇ≠Ï†ú (7Ïùº Ïù¥ÏÉÅ)
find /home/backup -type d -mtime +7 -exec rm -rf {} +

echo "Backup completed: $BACKUP_DIR"
EOF

chmod +x ~/backup.sh

# Cron ÏÑ§Ï†ï
(crontab -l 2>/dev/null; echo "0 2 * * * /home/backup.sh") | crontab -
```

## 8. ÌôòÍ≤ΩÎ≥ÄÏàò ÏÑ§Ï†ï

```bash
# ~/.env
cat > ~/.env << 'EOF'
# VM Configuration
VM_INSTANCE_NAME=openmanager-vm
VM_ZONE=us-central1-a
VM_PROJECT_ID=your-project-id

# MCP Servers
MCP_FILESYSTEM_PORT=8080
MCP_MEMORY_PORT=8081
MCP_GITHUB_PORT=8082
MCP_SEQUENTIAL_PORT=8083
MCP_TIME_PORT=8084
MCP_CONTEXT7_PORT=8085
MCP_SERENA_PORT=8086
MCP_SHADCN_PORT=8087

# API Server
API_SERVER_PORT=3001
API_SERVER_HOST=0.0.0.0

# Authentication
GITHUB_TOKEN=ghp_xxxxx
SUPABASE_URL=https://xxxxx.supabase.co
SUPABASE_ANON_KEY=xxxxx
SUPABASE_SERVICE_KEY=xxxxx

# Monitoring
ENABLE_MONITORING=true
MONITORING_INTERVAL=60
EOF
```

## 9. ÏãúÏûë Ïä§ÌÅ¨Î¶ΩÌä∏

```bash
#!/bin/bash
# ~/start-all.sh

echo "üöÄ Starting OpenManager VM Backend Services..."

# ÌôòÍ≤ΩÎ≥ÄÏàò Î°úÎìú
source ~/.env

# MCP ÏÑúÎ≤Ñ ÏãúÏûë
echo "Starting MCP servers..."
cd ~/mcp-servers
pm2 start ecosystem.config.js

# API ÏÑúÎ≤Ñ ÏãúÏûë
echo "Starting API server..."
cd ~/api-server
pm2 start npm --name "api-server" -- start

# Î™®ÎãàÌÑ∞ÎßÅ ÏãúÏûë
echo "Starting monitoring..."
pm2 start ~/monitor.sh --name "monitor"

# Nginx Ïû¨ÏãúÏûë
sudo systemctl restart nginx

# ÏÉÅÌÉú ÌôïÏù∏
pm2 status

echo "‚úÖ All services started successfully!"
echo "API Server: http://localhost:3001"
echo "PM2 Web: http://localhost:9615"
```

## 10. Î¨∏Ï†ú Ìï¥Í≤∞

### Î©îÎ™®Î¶¨ Î∂ÄÏ°±
```bash
# ÌîÑÎ°úÏÑ∏Ïä§Î≥Ñ Î©îÎ™®Î¶¨ ÏÇ¨Ïö©Îüâ ÌôïÏù∏
pm2 monit

# Î∂àÌïÑÏöîÌïú ÌîÑÎ°úÏÑ∏Ïä§ Ï§ëÏßÄ
pm2 stop [process-name]

# Î©îÎ™®Î¶¨ Ï∫êÏãú Ï†ïÎ¶¨
sync && echo 3 | sudo tee /proc/sys/vm/drop_caches
```

### MCP ÏÑúÎ≤Ñ Ïó∞Í≤∞ Ïã§Ìå®
```bash
# Ìè¨Ìä∏ ÌôïÏù∏
sudo netstat -tlnp | grep -E '808[0-9]'

# Î∞©ÌôîÎ≤Ω ÌôïÏù∏
sudo iptables -L -n

# ÏÑúÎ≤Ñ Ïû¨ÏãúÏûë
pm2 restart [mcp-server-name]
```

### CPU Í≥ºÎ∂ÄÌïò
```bash
# CPU ÏÇ¨Ïö©Îüâ ÌôïÏù∏
top -n 1 | head -20

# Nice Í∞í Ï°∞Ï†ï
renice -n 10 -p $(pgrep node)

# ÌîÑÎ°úÏÑ∏Ïä§ Ïàò Ï°∞Ï†ï
pm2 scale [app-name] 1
```

## Í≤∞Î°†

GCP e2-micro VM Î¨¥Î£å Ìã∞Ïñ¥Î•º ÌôúÏö©ÌïòÏó¨:
- ‚úÖ 11Í∞ú MCP ÏÑúÎ≤Ñ Ìò∏Ïä§ÌåÖ
- ‚úÖ AI Î∞±ÏóîÎìú API ÏÑúÎ≤Ñ Ïö¥ÏòÅ
- ‚úÖ Ï∫êÏã± Î†àÏù¥Ïñ¥ Íµ¨ÌòÑ
- ‚úÖ 24/7 Î™®ÎãàÌÑ∞ÎßÅ ÏãúÏä§ÌÖú
- ‚úÖ ÏûêÎèô Ïä§ÏºÄÏùºÎßÅ Î∞è Î¶¨ÏÜåÏä§ Í¥ÄÎ¶¨

Ïõî $0Î°ú Í∞ïÎ†•Ìïú AI Ïñ¥ÏãúÏä§ÌÑ¥Ìä∏ Î∞±ÏóîÎìú Ïù∏ÌîÑÎùºÎ•º Íµ¨Ï∂ïÌï† Ïàò ÏûàÏäµÎãàÎã§.