# Multi-Agent Supervisor: ì‹œê°„-í’ˆì§ˆ ìƒê´€ê´€ê³„ ë¶„ì„

> **ì •ì  ë¶„ì„ ê¸°ì¤€ì¼**: 2025-12-26
> **ë¶„ì„ ëŒ€ìƒ**: `cloud-run/ai-engine/src/services/langgraph/multi-agent-supervisor.ts`

## ğŸ“Š ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨

![Time-Quality Analysis](./diagrams/time-quality-analysis.png)

---

## ğŸ” í•µì‹¬ ë°œê²¬ì‚¬í•­

### 1. ì‹œê°„ íˆ¬ì â‰  ì„ í˜•ì  í’ˆì§ˆ í–¥ìƒ

| ê²½ë¡œ | ì˜ˆìƒ ì‹œê°„ | í’ˆì§ˆ ì ìˆ˜ | ì‹œê°„ë‹¹ í’ˆì§ˆ íš¨ìœ¨ |
|------|----------|----------|-----------------|
| **Last Keeper** (ê°„ì†Œí™”) | ~1-3s | 50% | **16.7%/s** |
| **Normal + Verifier** | ~30-50s | 85% | 1.7%/s |
| **Normal Only** (ê²€ì¦ Skip) | ~15-20s | 70% | 3.5%/s |

**ê²°ë¡ **: ê°„ë‹¨í•œ ì¿¼ë¦¬ì— ë³µì¡í•œ íŒŒì´í”„ë¼ì¸ì„ ì ìš©í•˜ë©´ **ì‹œê°„ ëŒ€ë¹„ í’ˆì§ˆ íš¨ìœ¨ì´ 10ë°° ê°ì†Œ**

---

## ğŸ“ˆ ë‹¨ê³„ë³„ í’ˆì§ˆ ê¸°ì—¬ë„ ë¶„ì„

### Phase 1: Supervisor ë¼ìš°íŒ… (2-3ì´ˆ)
```
í’ˆì§ˆ ê¸°ì—¬ë„: +10%
ì—­í• : ì¿¼ë¦¬ ì˜ë„ íŒŒì•… ë° ì ì ˆí•œ Agent ì„ íƒ
```

**ì½”ë“œ ì¦ê±°** (`multi-agent-supervisor.ts:263-280`):
```typescript
const SUPERVISOR_PROMPT = `ë‹¹ì‹ ì€ OpenManager VIBEì˜ Multi-Agent Supervisorì…ë‹ˆë‹¤.

## ì—ì´ì „íŠ¸ ë¼ìš°íŒ…
- **nlq_agent**: ì„œë²„ ìƒíƒœ/ë©”íŠ¸ë¦­ ì¡°íšŒ (CPU, Memory, Disk)
- **analyst_agent**: íŒ¨í„´ ë¶„ì„, ì´ìƒ íƒì§€, íŠ¸ë Œë“œ ì˜ˆì¸¡
- **reporter_agent**: ì¸ì‹œë˜íŠ¸ ë¦¬í¬íŠ¸, ì¥ì•  ë¶„ì„, RAG ê²€ìƒ‰
```

**í’ˆì§ˆ ì˜í–¥**: ì˜ëª»ëœ Agent ì„ íƒ ì‹œ ì‘ë‹µ í’ˆì§ˆ 30-50% í•˜ë½

---

### Phase 2: Worker Agents (5-10ì´ˆ each)

| Agent | ë„êµ¬ ìˆ˜ | maxTokens | í’ˆì§ˆ ê¸°ì—¬ |
|-------|---------|-----------|----------|
| NLQ Agent | 4ê°œ | 1024 | +25% |
| Analyst Agent | 4ê°œ | 2048 | +20% |
| Reporter Agent | 2ê°œ | 4096 | +15% |

**ì½”ë“œ ì¦ê±°** (`model-config.ts:83-107`):
```typescript
export const AGENT_MODEL_CONFIG = {
  nlq: {
    model: 'llama-3.3-70b-versatile',
    temperature: 0.3,      // ë‚®ì€ temperature = ì¼ê´€ëœ ê²°ê³¼
    maxOutputTokens: 1024,
  },
  reporter: {
    model: 'llama-3.3-70b-versatile',
    temperature: 0.3,
    maxOutputTokens: 4096, // ê¸´ ë¦¬í¬íŠ¸ ìƒì„± ê°€ëŠ¥
  },
}
```

**í’ˆì§ˆ ì˜í–¥**:
- ë„êµ¬ í˜¸ì¶œ ì •í™•ë„ê°€ ì‘ë‹µ í’ˆì§ˆ ê²°ì •
- `temperature: 0.2-0.3` ì„¤ì •ìœ¼ë¡œ í™˜ê° ìµœì†Œí™”

---

### Phase 3: Verifier Agent (10-20ì´ˆ)

**4ê°€ì§€ ê²€ì¦ ê·œì¹™** (`verifier-agent.ts:69-81`):
```typescript
export const DEFAULT_VERIFIER_CONFIG: VerifierConfig = {
  rules: {
    checkMetricRanges: true,    // CPU 120% ê°™ì€ ë¹„ì •ìƒ ìˆ˜ì¹˜ êµì •
    checkRequiredFields: true,   // í•„ìˆ˜ ì •ë³´ ëˆ„ë½ íƒì§€
    checkFormatConsistency: true,
    detectHallucination: true,   // ìê¸°ëª¨ìˆœ, ë°˜ë³µíŒ¨í„´ íƒì§€
  },
  thresholds: {
    minConfidence: 0.7,  // 70% ë¯¸ë§Œ ì‹ ë¢°ë„ = ê²€ì¦ ì‹¤íŒ¨
  },
};
```

**í’ˆì§ˆ ê¸°ì—¬ë„ ë¶„ì„**:

| ê²€ì¦ ê·œì¹™ | ë¬¸ì œ íƒì§€ ì‹œ í’ˆì§ˆ ì˜í–¥ | ìˆ˜ì • ì‹œ í’ˆì§ˆ í–¥ìƒ |
|----------|---------------------|------------------|
| Metric Range | -25% (120% â†’ ì˜ëª»ëœ ì •ë³´) | +15% |
| Required Fields | -10% (ë¶ˆì™„ì „ ì‘ë‹µ) | +5% |
| Hallucination | -20% (ì‹ ë¢°ë„ í•˜ë½) | +10% |

**ì´ Verifier í’ˆì§ˆ ê¸°ì—¬**: ~15% (ë¬¸ì œ ì—†ìœ¼ë©´ í™•ì¸ë§Œ, ë¬¸ì œ ìˆìœ¼ë©´ êµì •)

---

## âš¡ Smart Skip ë¡œì§

**êµ¬í˜„ ìœ„ì¹˜** (`multi-agent-supervisor.ts:940-947`):
```typescript
// v5.87.1: Smart verification - skip for simple queries
const isSimpleQuery = query.length < 30 ||
  /^(ì•ˆë…•|ë°˜ê°€ì›Œ|ê³ ë§ˆì›Œ|ë„ì›€|ë­í•´|í…ŒìŠ¤íŠ¸)/i.test(query);

const { response, verification } = await executeSupervisor(query, {
  enableVerification: !isSimpleQuery, // Skip verifier (~10-20s savings)
});
```

**íš¨ê³¼**:
- ê°„ë‹¨ ì¿¼ë¦¬: 15-20ì´ˆ ë‹¨ì¶•
- ë³µì¡ ì¿¼ë¦¬: ì „ì²´ ê²€ì¦ ìœ ì§€

---

## ğŸ›¡ï¸ Last Keeper Mode ë¶„ì„

**í™œì„±í™” ì¡°ê±´** (`multi-agent-supervisor.ts:661-667`):
```typescript
if (isRateLimit) {
  // Groq rate limit ì¦‰ì‹œ Mistral ì§ì ‘ ì‘ë‹µ
  // Worker ì—ì´ì „íŠ¸ë“¤ë„ Groq ì‚¬ìš©í•˜ë¯€ë¡œ, ë°”ë¡œ Last Keeperë¡œ ì „í™˜
  console.warn(`âš ï¸ [Supervisor] Groq rate limit detected...`);
  return await executeLastKeeperMode(query, sessionId);
}
```

**í’ˆì§ˆ íŠ¸ë ˆì´ë“œì˜¤í”„**:

| í•­ëª© | Normal Path | Last Keeper |
|------|-------------|-------------|
| ì‹¤ì‹œê°„ ì„œë²„ ë°ì´í„° | âœ… ê°€ëŠ¥ | âŒ ë¶ˆê°€ |
| íŒ¨í„´ ë¶„ì„ | âœ… ê°€ëŠ¥ | âŒ ë¶ˆê°€ |
| ì¼ë°˜ ëŒ€í™” | âœ… ê°€ëŠ¥ | âœ… ê°€ëŠ¥ |
| ê¸°ìˆ  ì¡°ì–¸ | âœ… ìƒì„¸ | âš ï¸ ì¼ë°˜ì  |
| ì‘ë‹µ ì‹œê°„ | 30-50ì´ˆ | **1-3ì´ˆ** |

---

## ğŸ“‰ ì‹œê°„-í’ˆì§ˆ ê³¡ì„ 

```
í’ˆì§ˆ(%)
100 â”¤                          â”Œâ”€â”€â”€â”€â”€â”€â”€ Verifier ì™„ë£Œ (85%)
    â”‚                     â”Œâ”€â”€â”€â”€â”˜
 85 â”¤                â”Œâ”€â”€â”€â”€â”˜         Worker ì™„ë£Œ (70%)
    â”‚           â”Œâ”€â”€â”€â”€â”˜
 70 â”¤      â”Œâ”€â”€â”€â”€â”˜                   Supervisor ì™„ë£Œ (60%)
    â”‚ â”Œâ”€â”€â”€â”€â”˜
 50 â”¤â”€â”˜ Last Keeper (50%)
    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ì‹œê°„(ì´ˆ)
    0    1    5    10   15   20   25   30   40   50
```

**Key Insight**:
- 0-5ì´ˆ: ê¸‰ê²©í•œ í’ˆì§ˆ í–¥ìƒ (50% â†’ 60%)
- 5-20ì´ˆ: ì™„ë§Œí•œ í–¥ìƒ (60% â†’ 70%)
- 20-50ì´ˆ: ê²€ì¦ìœ¼ë¡œ ì¶”ê°€ í–¥ìƒ (70% â†’ 85%)

---

## ğŸ¯ ìµœì í™” ê¶Œì¥ì‚¬í•­

### í˜„ì¬ êµ¬í˜„ëœ ìµœì í™”

1. **Simple Query Skip** - ê°„ë‹¨ ì¿¼ë¦¬ëŠ” Verifier ìŠ¤í‚µ
2. **Immediate Last Keeper** - Rate limit ì‹œ ì¦‰ì‹œ ì „í™˜
3. **Keep-Alive Ping** - 10ì´ˆë§ˆë‹¤ ì§„í–‰ ìƒí™© ì „ì†¡ (íƒ€ì„ì•„ì›ƒ ë°©ì§€)

### ì¶”ê°€ ìµœì í™” ê°€ëŠ¥ ì˜ì—­

| ì˜ì—­ | ì˜ˆìƒ íš¨ê³¼ | ë³µì¡ë„ |
|------|----------|--------|
| Agent ë³‘ë ¬ ì‹¤í–‰ | -10ì´ˆ | ë†’ìŒ |
| ìºì‹œ ë ˆì´ì–´ | -5-10ì´ˆ | ì¤‘ê°„ |
| ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ | ì²´ê° ì‹œê°„ â†“ | ì¤‘ê°„ |
| Worker ìˆ˜ ìµœì í™” | -5ì´ˆ | ë‚®ìŒ |

---

## ğŸ“‹ ìš”ì•½

| ì‹œë‚˜ë¦¬ì˜¤ | ê¶Œì¥ ê²½ë¡œ | ì˜ˆìƒ í’ˆì§ˆ |
|----------|----------|----------|
| "ì•ˆë…•í•˜ì„¸ìš”" | Last Keeper â†’ ë°”ë¡œ ì‘ë‹µ | 50% (ì¶©ë¶„) |
| "ì„œë²„ ìƒíƒœ í™•ì¸" | Normal Path + Verifier | 85% |
| Rate Limit ìƒí™© | Last Keeper (ìë™) | 50% |
| ê¸´ê¸‰ ì¥ì•  ë¶„ì„ | Normal Path + ì „ì²´ ê²€ì¦ | 85% |

**ê²°ë¡ **: ì‹œê°„ì„ ë” ì“´ë‹¤ê³  ë¬´ì¡°ê±´ í’ˆì§ˆì´ ë¹„ë¡€ í–¥ìƒë˜ì§€ ì•ŠìŒ. ì¿¼ë¦¬ ë³µì¡ë„ì— ë§ëŠ” ì ì ˆí•œ ê²½ë¡œ ì„ íƒì´ í•µì‹¬.
