%%{init: {'theme': 'base', 'themeVariables': {
  'primaryColor': '#3b82f6',
  'primaryTextColor': '#fff',
  'primaryBorderColor': '#2563eb',
  'lineColor': '#64748b',
  'secondaryColor': '#10b981',
  'tertiaryColor': '#f59e0b'
}}}%%
%% Multi-Agent Supervisor - Time-Quality Analysis
%% Updated: 2025-12-26

flowchart TB
    subgraph INPUT["ğŸ“¥ ì…ë ¥"]
        Q[/"ì‚¬ìš©ì ì¿¼ë¦¬"/]
    end

    subgraph FAST["âš¡ Fast Path (1-3ì´ˆ)"]
        direction TB
        SIMPLE{"ê°„ë‹¨ ì¿¼ë¦¬?<br/>len < 30"}
        KEEPER["ğŸ›¡ï¸ Last Keeper<br/>Mistral Small (24B)<br/>â±ï¸ ~1s | ğŸ“Š 50%"]
    end

    subgraph NORMAL["ğŸ”„ Normal Path (15-30ì´ˆ)"]
        direction TB
        SUP["ğŸ‘” Supervisor<br/>Groq 70B<br/>â±ï¸ ~2s | ğŸ“Š +10%"]

        subgraph WORKERS["Worker Agents"]
            direction LR
            NLQ["ğŸ“Š NLQ Agent<br/>Groq 70B<br/>â±ï¸ ~5s | ğŸ“Š +25%"]
            ANALYST["ğŸ” Analyst<br/>Groq 70B<br/>â±ï¸ ~5s | ğŸ“Š +20%"]
            REPORTER["ğŸ“‹ Reporter<br/>Groq 70B<br/>â±ï¸ ~5s | ğŸ“Š +15%"]
        end
    end

    subgraph VERIFY["âœ… Verification (10-20ì´ˆ)"]
        direction TB
        VER["ğŸ”¬ Verifier Agent<br/>Mistral 24B<br/>â±ï¸ ~15s | ğŸ“Š +15%"]

        subgraph CHECKS["ê²€ì¦ í•­ëª©"]
            direction LR
            C1["ë©”íŠ¸ë¦­ ë²”ìœ„<br/>0-100%"]
            C2["í•„ìˆ˜ í•„ë“œ<br/>ì™„ì „ì„±"]
            C3["í™˜ê° íƒì§€<br/>Hallucination"]
        end
    end

    subgraph OUTPUT["ğŸ“¤ ì¶œë ¥"]
        RESP[/"ìµœì¢… ì‘ë‹µ<br/>+ ì‹ ë¢°ë„ ì ìˆ˜"/]
    end

    %% Connections
    Q --> SIMPLE
    SIMPLE -->|"Yes"| KEEPER
    SIMPLE -->|"No"| SUP

    SUP -->|"ë¼ìš°íŒ…"| NLQ
    SUP -->|"ë¼ìš°íŒ…"| ANALYST
    SUP -->|"ë¼ìš°íŒ…"| REPORTER

    NLQ --> VER
    ANALYST --> VER
    REPORTER --> VER

    VER --> C1
    VER --> C2
    VER --> C3

    C1 --> RESP
    C2 --> RESP
    C3 --> RESP
    KEEPER --> RESP

    %% Rate Limit Path
    SUP -.->|"Groq Rate Limit"| KEEPER

    %% Styling
    classDef fast fill:#10b981,stroke:#059669,color:#fff
    classDef normal fill:#3b82f6,stroke:#2563eb,color:#fff
    classDef verify fill:#8b5cf6,stroke:#7c3aed,color:#fff
    classDef fallback fill:#f59e0b,stroke:#d97706,color:#fff

    class SIMPLE,KEEPER fast
    class SUP,NLQ,ANALYST,REPORTER normal
    class VER,C1,C2,C3 verify
