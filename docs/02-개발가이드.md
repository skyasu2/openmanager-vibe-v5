# 개발 가이드

## 🚀 개발 환경 구축

### 사전 요구사항
- Node.js 18+ 
- npm 또는 yarn
- Git
- PostgreSQL (Supabase)
- Redis

### 1. 프로젝트 클론
```bash
git clone https://github.com/skyasu2/openmanager-vibe-v5.git
cd openmanager-vibe-v5
```

### 2. 의존성 설치
```bash
npm install
```

### 3. 환경변수 설정
```bash
cp .env.example .env.local
```

`.env.local` 파일 편집:
```env
# 기본 설정
NEXT_PUBLIC_SITE_URL=http://localhost:3000
COLLECTOR_MODE=dummy

# Supabase 설정
SUPABASE_URL=your_supabase_url
SUPABASE_ANON_KEY=your_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key

# Redis 설정
REDIS_URL=redis://localhost:6379

# 프로덕션 수집기 설정 (선택사항)
PROMETHEUS_URL=http://prometheus:9090
AWS_ACCESS_KEY_ID=your_aws_key
AWS_SECRET_ACCESS_KEY=your_aws_secret
AWS_REGION=ap-northeast-2
CUSTOM_API_ENDPOINTS=http://server1:8080/metrics,http://server2:8080/metrics
```

### 4. 데이터베이스 설정
```bash
# Supabase 스키마 생성
psql -h your_supabase_host -U postgres -d postgres -f scripts/setup-database.sql
```

### 5. 개발 서버 실행
```bash
npm run dev
```

## 📁 프로젝트 구조

```
openmanager-vibe-v5/
├── src/
│   ├── app/              # Next.js App Router
│   │   ├── api/          # API 엔드포인트
│   │   ├── dashboard/    # 대시보드 페이지
│   │   └── demo/         # 데모 페이지
│   ├── components/       # React 컴포넌트
│   │   ├── ai/           # AI 관련 컴포넌트
│   │   ├── dashboard/    # 대시보드 컴포넌트
│   │   ├── demo/         # 데모 컴포넌트
│   │   └── ui/           # 공통 UI 컴포넌트
│   ├── config/           # 설정 파일들
│   ├── lib/              # 유틸리티 라이브러리
│   ├── modules/          # MCP 모듈
│   │   └── mcp/          # MCP 프로세서
│   ├── services/         # 비즈니스 로직
│   │   └── collectors/   # 데이터 수집기들
│   ├── stores/           # 상태 관리 (Zustand)
│   ├── styles/           # CSS 스타일
│   └── types/            # TypeScript 타입 정의
├── docs/                 # 문서
├── scripts/              # 스크립트 파일들
└── public/              # 정적 파일들
```

## 🔧 개발 워크플로우

### 1. 더미 모드 개발
```bash
# .env.local에서
COLLECTOR_MODE=dummy

# 개발 서버 실행
npm run dev
```

더미 모드에서는 `src/lib/enterprise-servers.ts`의 정적 데이터를 사용합니다.

### 2. 프로덕션 모드 테스트
```bash
# .env.local에서
COLLECTOR_MODE=production

# 필요한 수집기 설정 추가
PROMETHEUS_URL=http://your-prometheus:9090
# 또는 AWS_ACCESS_KEY_ID=...
# 또는 CUSTOM_API_ENDPOINTS=...
```

### 3. 빌드 및 테스트
```bash
# 타입 체크
npm run type-check

# 린트 체크
npm run lint

# 빌드
npm run build

# 프로덕션 서버 실행
npm run start
```

## 🧩 핵심 컴포넌트

### 수집기 시스템
- `CollectionManager`: 수집 프로세스 관리
- `CollectorFactory`: 수집기 팩토리
- `PrometheusCollector`: Kubernetes 메트릭 수집
- `CloudWatchCollector`: AWS 메트릭 수집
- `CustomAPICollector`: 커스텀 API 수집

### 저장소 시스템
- `storage.ts`: Redis + Supabase 이중화 저장소
- 지능형 쿼리 (Redis → Supabase 순차)
- 자동 TTL 관리

### AI 시스템
- `MCPProcessor`: Model Context Protocol 처리
- `agent.ts`: AI 에이전트 로직
- 실시간 인과관계 분석

## 🔍 디버깅

### 로그 확인
```bash
# 수집기 로그
tail -f logs/collector.log

# API 로그
# 브라우저 개발자 도구 콘솔 확인
```

### 환경변수 검증
```bash
# 환경변수 체크 API
curl http://localhost:3000/api/health
```

### 데이터베이스 연결 테스트
```bash
# Supabase 연결 테스트
curl http://localhost:3000/api/status
```

## 🧪 테스트

### 단위 테스트
```bash
npm run test
```

### E2E 테스트
```bash
npm run test:e2e
```

### API 테스트
```bash
# 서버 목록 조회
curl http://localhost:3000/api/servers

# 대시보드 데이터
curl http://localhost:3000/api/dashboard

# 시뮬레이션 실행
curl -X POST http://localhost:3000/api/simulate
```

## 📦 새로운 수집기 추가

### 1. 수집기 인터페이스 구현
```typescript
// src/services/collectors/my-collector.ts
import { BaseCollector } from './base-collector';

export class MyCollector extends BaseCollector {
  async collect(serverId: string): Promise<ServerMetrics> {
    // 수집 로직 구현
  }
}
```

### 2. 팩토리에 등록
```typescript
// src/services/collectors/collector-factory.ts
import { MyCollector } from './my-collector';

export function createCollector(type: string) {
  switch (type) {
    case 'my-collector':
      return new MyCollector();
    // ...
  }
}
```

### 3. 환경변수 설정
```typescript
// src/config/collectors.ts
export const collectorConfigs = {
  'my-collector': {
    enabled: !!process.env.MY_COLLECTOR_URL,
    url: process.env.MY_COLLECTOR_URL
  }
};
```

## 🛠️ 코딩 스타일

### TypeScript
- 엄격한 타입 체크 사용
- interface보다 type 선호
- null/undefined 명시적 처리

### React
- 함수형 컴포넌트 사용
- Custom Hooks 활용
- 컴포넌트 분리 원칙

### 스타일링
- Tailwind CSS 유틸리티 클래스
- 반응형 디자인 우선
- 다크 모드 지원

## 🔄 배포 준비

### 프로덕션 빌드
```bash
npm run build
```

### 환경변수 검증
```bash
# 프로덕션 환경변수 체크
npm run env:check
```

### 성능 최적화
```bash
# 번들 분석
npm run analyze
```

모든 개발 과정에서 **한국어 주석과 문서화**를 우선으로 합니다. 