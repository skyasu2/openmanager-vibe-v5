<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìµœì‹  ë°°í¬ AI ì–´ì‹œìŠ¤í„´íŠ¸ ë””ë²„ê¹…</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .error {
            border-left: 4px solid #f44336;
            background-color: #fff8f8;
        }

        .success {
            border-left: 4px solid #4CAF50;
            background-color: #f8fff8;
        }

        .warning {
            border-left: 4px solid #ff9800;
            background-color: #fffaf0;
        }

        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }

        button:hover {
            background-color: #0056b3;
        }

        .result {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin-top: 10px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 500px;
            overflow-y: auto;
            font-size: 12px;
        }

        .url-info {
            background-color: #e3f2fd;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
        }

        .test-status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: bold;
            margin-left: 10px;
        }

        .status-pass {
            background-color: #d4edda;
            color: #155724;
        }

        .status-fail {
            background-color: #f8d7da;
            color: #721c24;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ğŸ” ìµœì‹  ë°°í¬ AI ì–´ì‹œìŠ¤í„´íŠ¸ ë””ë²„ê¹…</h1>
        <div class="url-info">
            <h3>ğŸ“ í…ŒìŠ¤íŠ¸ ëŒ€ìƒ</h3>
            <p><strong>ìµœì‹  ë°°í¬:</strong> <code>openmanager-vibe-v5-7wtcxkqs4-skyasus-projects.vercel.app</code></p>
            <p><strong>ë¬¸ì œ:</strong> AI ì–´ì‹œìŠ¤í„´íŠ¸ ì§ˆë¬¸ ì‹œ "HTTP 405" ì˜¤ë¥˜ ë°œìƒ</p>
        </div>

        <button onclick="runFullDiagnostic()">ğŸš€ ì „ì²´ ì§„ë‹¨ ì‹¤í–‰</button>
        <button onclick="testAIAssistant()">ğŸ¤– AI ì–´ì‹œìŠ¤í„´íŠ¸ í…ŒìŠ¤íŠ¸</button>
        <button onclick="testAllAPIs()">ğŸ“¡ ëª¨ë“  API í…ŒìŠ¤íŠ¸</button>
        <button onclick="clearResults()">ğŸ§¹ ê²°ê³¼ ì§€ìš°ê¸°</button>
    </div>

    <div class="container">
        <h2>ğŸ“Š ì§„ë‹¨ ê²°ê³¼</h2>
        <div id="test-results" class="result" style="display: none;"></div>
    </div>

    <script>
        const baseUrl = 'https://openmanager-vibe-v5-7wtcxkqs4-skyasus-projects.vercel.app';

        function showResult(content, className = 'success') {
            const element = document.getElementById('test-results');
            element.style.display = 'block';
            element.textContent = content;
            element.className = `result ${className}`;
        }

        function appendResult(content) {
            const element = document.getElementById('test-results');
            element.style.display = 'block';
            element.textContent += content + '\n';
        }

        async function testAPI(endpoint, method = 'GET', body = null) {
            try {
                const options = {
                    method: method,
                    headers: { 'Content-Type': 'application/json' }
                };

                if (body) {
                    options.body = JSON.stringify(body);
                }

                const response = await fetch(`${baseUrl}${endpoint}`, options);

                let responseData = null;
                try {
                    responseData = await response.json();
                } catch (e) {
                    responseData = await response.text();
                }

                return {
                    success: response.ok,
                    status: response.status,
                    statusText: response.statusText,
                    data: responseData,
                    error: response.ok ? null : `HTTP ${response.status}: ${response.statusText}`
                };
            } catch (error) {
                return {
                    success: false,
                    status: 0,
                    statusText: 'Network Error',
                    data: null,
                    error: error.message
                };
            }
        }

        async function runFullDiagnostic() {
            showResult('ğŸ” AI ì–´ì‹œìŠ¤í„´íŠ¸ ì „ì²´ ì§„ë‹¨ ì‹œì‘...\n\n');

            // 1. ê¸°ë³¸ í—¬ìŠ¤ì²´í¬
            appendResult('1ï¸âƒ£ ê¸°ë³¸ ì‹œìŠ¤í…œ ìƒíƒœ í™•ì¸');
            const healthResult = await testAPI('/api/health');
            appendResult(`   í—¬ìŠ¤ì²´í¬: ${healthResult.status} ${healthResult.success ? 'âœ…' : 'âŒ'}`);

            // 2. AI ê´€ë ¨ APIë“¤ ìˆœì°¨ í…ŒìŠ¤íŠ¸
            const aiAPIs = [
                { path: '/api/ai/unified/status', name: 'AI í†µí•© ìƒíƒœ' },
                { path: '/api/ai/smart-fallback', name: 'Smart Fallback ìƒíƒœ' },
                { path: '/api/ai/google-ai/status', name: 'Google AI ìƒíƒœ' },
                { path: '/api/ai/mcp/query', name: 'MCP ì¿¼ë¦¬', method: 'POST', body: { question: "í…ŒìŠ¤íŠ¸", priority: "medium", category: "system" } }
            ];

            appendResult('\n2ï¸âƒ£ AI API ìƒíƒœ í™•ì¸');
            for (const api of aiAPIs) {
                const result = await testAPI(api.path, api.method || 'GET', api.body);
                appendResult(`   ${api.name}: ${result.status} ${result.success ? 'âœ…' : 'âŒ'}`);
                if (!result.success) {
                    appendResult(`      ì˜¤ë¥˜: ${result.error}`);
                }
                await new Promise(resolve => setTimeout(resolve, 300));
            }

            // 3. ì‹¤ì œ AI ì–´ì‹œìŠ¤í„´íŠ¸ ì¿¼ë¦¬ í…ŒìŠ¤íŠ¸
            appendResult('\n3ï¸âƒ£ AI ì–´ì‹œìŠ¤í„´íŠ¸ ì‹¤ì œ ì¿¼ë¦¬ í…ŒìŠ¤íŠ¸');
            await testAIAssistantQuery();

            appendResult('\nğŸ” ì „ì²´ ì§„ë‹¨ ì™„ë£Œ!');
        }

        async function testAIAssistant() {
            showResult('ğŸ¤– AI ì–´ì‹œìŠ¤í„´íŠ¸ ì§‘ì¤‘ í…ŒìŠ¤íŠ¸ ì‹œì‘...\n\n');
            await testAIAssistantQuery();
        }

        async function testAIAssistantQuery() {
            const testQueries = [
                {
                    name: "Smart Fallback ì—”ì§„ í…ŒìŠ¤íŠ¸",
                    endpoint: "/api/ai/smart-fallback",
                    method: "POST",
                    body: {
                        query: "í˜„ì¬ ì„œë²„ ìƒíƒœëŠ” ì–´ë–¤ê°€ìš”?",
                        context: {
                            sessionId: `test_${Date.now()}`,
                            language: "ko",
                            urgency: "medium"
                        },
                        options: {
                            enableThinking: false,
                            maxResponseTime: 15000,
                            confidenceThreshold: 0.7,
                            useMCP: true,
                            useRAG: true,
                            useGoogleAI: true
                        }
                    }
                },
                {
                    name: "MCP ì¿¼ë¦¬ í…ŒìŠ¤íŠ¸",
                    endpoint: "/api/ai/mcp/query",
                    method: "POST",
                    body: {
                        question: "í˜„ì¬ ì‹œìŠ¤í…œ ìƒíƒœëŠ” ì–´ë–¤ê°€ìš”?",
                        priority: "medium",
                        category: "system"
                    }
                },
                {
                    name: "AI ì±„íŒ… í…ŒìŠ¤íŠ¸",
                    endpoint: "/api/ai-chat",
                    method: "POST",
                    body: {
                        action: "send",
                        message: "í˜„ì¬ ì„œë²„ ìƒíƒœëŠ” ì–´ë–¤ê°€ìš”?",
                        sessionId: `chat_test_${Date.now()}`
                    }
                }
            ];

            for (const query of testQueries) {
                appendResult(`\nğŸ” ${query.name}:`);
                appendResult(`   ì—”ë“œí¬ì¸íŠ¸: ${query.method} ${query.endpoint}`);

                const result = await testAPI(query.endpoint, query.method, query.body);
                appendResult(`   ê²°ê³¼: ${result.status} ${result.statusText} ${result.success ? 'âœ…' : 'âŒ'}`);

                if (result.success && result.data) {
                    if (result.data.success !== false) {
                        appendResult(`   âœ… ì„±ê³µ! ì‘ë‹µ ë¯¸ë¦¬ë³´ê¸°:`);
                        const preview = JSON.stringify(result.data).substring(0, 200);
                        appendResult(`   ${preview}...`);
                    } else {
                        appendResult(`   âŒ API ì‘ë‹µ ì‹¤íŒ¨: ${result.data.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`);
                    }
                } else {
                    appendResult(`   âŒ HTTP ì˜¤ë¥˜: ${result.error}`);

                    // 405 ì˜¤ë¥˜ íŠ¹ë³„ ì²˜ë¦¬
                    if (result.status === 405) {
                        appendResult(`   ğŸ’¡ 405 ì˜¤ë¥˜ ë¶„ì„: POST ë©”ì„œë“œê°€ í—ˆìš©ë˜ì§€ ì•ŠìŒ`);
                        appendResult(`   ğŸ”§ í•´ê²° ë°©ì•ˆ: API ë¼ìš°íŠ¸ì—ì„œ POST ë©”ì„œë“œ ì§€ì› í™•ì¸ í•„ìš”`);
                    }
                }

                await new Promise(resolve => setTimeout(resolve, 1000));
            }
        }

        async function testAllAPIs() {
            showResult('ğŸ“¡ ëª¨ë“  API ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸ ì‹œì‘...\n\n');

            const allEndpoints = [
                { path: '/api/health', method: 'GET', name: 'í—¬ìŠ¤ì²´í¬' },
                { path: '/api/status', method: 'GET', name: 'ì‹œìŠ¤í…œ ìƒíƒœ' },
                { path: '/api/logs/recent?limit=10', method: 'GET', name: 'ìµœê·¼ ë¡œê·¸' },
                { path: '/api/ai/unified/status', method: 'GET', name: 'AI í†µí•© ìƒíƒœ' },
                { path: '/api/ai/smart-fallback', method: 'GET', name: 'Smart Fallback ìƒíƒœ' },
                { path: '/api/ai/google-ai/status', method: 'GET', name: 'Google AI ìƒíƒœ' },
                { path: '/api/ai/logging/stream?mode=sidebar', method: 'GET', name: 'AI ë¡œê¹… ìŠ¤íŠ¸ë¦¼' }
            ];

            let passCount = 0;
            let failCount = 0;

            for (const endpoint of allEndpoints) {
                const result = await testAPI(endpoint.path, endpoint.method);
                const status = result.success ? 'PASS' : 'FAIL';
                const emoji = result.success ? 'âœ…' : 'âŒ';

                appendResult(`${emoji} ${endpoint.name}: ${result.status} (${status})`);

                if (result.success) {
                    passCount++;
                } else {
                    failCount++;
                    appendResult(`   ì˜¤ë¥˜: ${result.error}`);
                }

                await new Promise(resolve => setTimeout(resolve, 200));
            }

            appendResult(`\nğŸ“Š í…ŒìŠ¤íŠ¸ ê²°ê³¼ ìš”ì•½:`);
            appendResult(`   âœ… ì„±ê³µ: ${passCount}ê°œ`);
            appendResult(`   âŒ ì‹¤íŒ¨: ${failCount}ê°œ`);
            appendResult(`   ğŸ“ˆ ì„±ê³µë¥ : ${Math.round((passCount / (passCount + failCount)) * 100)}%`);
        }

        function clearResults() {
            const element = document.getElementById('test-results');
            element.style.display = 'none';
            element.textContent = '';
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì‹¤í–‰
        window.addEventListener('load', () => {
            console.log('ğŸ” ìµœì‹  ë°°í¬ AI ì–´ì‹œìŠ¤í„´íŠ¸ ë””ë²„ê¹… í˜ì´ì§€ ë¡œë“œë¨');
            console.log('ëŒ€ìƒ URL:', baseUrl);

            // 3ì´ˆ í›„ ìë™ìœ¼ë¡œ ê¸°ë³¸ ì§„ë‹¨ ì‹¤í–‰
            setTimeout(() => {
                runFullDiagnostic();
            }, 1000);
        });
    </script>
</body>

</html>