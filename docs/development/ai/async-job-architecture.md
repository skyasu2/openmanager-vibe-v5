# ë¹„ë™ê¸° AI ì‘ì—… ì²˜ë¦¬ ì•„í‚¤í…ì²˜

**Version**: 1.0.0
**Date**: 2025-12-23
**Status**: Draft

## 1. í˜„ì¬ ë¬¸ì œì  ë¶„ì„

### 1.1 Timeout ì œí•œ
| í™˜ê²½ | ì œí•œ | í˜„ì¬ ì„¤ì • |
|------|------|-----------|
| Vercel Free | 10ì´ˆ | - |
| Vercel Pro | 60ì´ˆ | `maxDuration = 60` |
| Cloud Run | ìµœëŒ€ 60ë¶„ | ì œí•œ ì—†ìŒ |

### 1.2 í˜„ì¬ íë¦„ì˜ ë³‘ëª©
```
User â†’ Vercel (maxDuration: 60s) â†’ Cloud Run (LangGraph)
                    â†‘
              TIMEOUT ë°œìƒ!
              (ë³µì¡í•œ ì¿¼ë¦¬ ì‹œ)
```

**ë¬¸ì œ**: Vercelì´ Cloud Run ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ëŠ” ë™ì•ˆ timeout ë°œìƒ

### 1.3 ë³µì¡í•œ ì¿¼ë¦¬ ì˜ˆì‹œ
- "ëª¨ë“  ì„œë²„ì˜ ì„±ëŠ¥ ë¶„ì„ í›„ ìµœì í™” ë°©ì•ˆ ì œì‹œí•´ì¤˜"
- "ì§€ë‚œ 7ì¼ê°„ ì¥ì•  íŒ¨í„´ ë¶„ì„í•˜ê³  ì˜ˆë°©ì±… ë§Œë“¤ì–´ì¤˜"
- "ì„œë²„ 30ëŒ€ ì „ì²´ ëª¨ë‹ˆí„°ë§ ë°ì´í„° ê¸°ë°˜ ë¦¬í¬íŠ¸ ìƒì„±"

## 2. í¬íŠ¸í´ë¦¬ì˜¤ ìˆ˜ì¤€ ì†”ë£¨ì…˜

### 2.1 Option A: Job Queue ì•„í‚¤í…ì²˜ (ê¶Œì¥)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Job Queue Architecture                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   POST /ai/jobs    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚ Client â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚  Vercel   â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â† Job ID (ì¦‰ì‹œ)  â”‚  (BFF)    â”‚                    â”‚
â”‚       â”‚                         â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚       â”‚                               â”‚                          â”‚
â”‚       â”‚                               â–¼                          â”‚
â”‚       â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚       â”‚   GET /ai/jobs/:id     â”‚  Cloud Run  â”‚ â† ì¥ì‹œê°„ ì²˜ë¦¬     â”‚
â”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚  (Worker)   â”‚   (ìµœëŒ€ 60ë¶„)     â”‚
â”‚       â”‚   â† Status/Progress    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚       â”‚                               â”‚                          â”‚
â”‚       â”‚                               â–¼                          â”‚
â”‚       â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚       â”‚                        â”‚  Supabase   â”‚ â† ê²°ê³¼ ì €ì¥       â”‚
â”‚       â”‚   â† Complete Result    â”‚  (Storage)  â”‚                   â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ì¥ì 
- âœ… Vercel timeoutê³¼ ë¬´ê´€í•˜ê²Œ ì¥ì‹œê°„ ì‘ì—… ì²˜ë¦¬
- âœ… ì§„í–‰ë¥  ì‹¤ì‹œê°„ í‘œì‹œ ê°€ëŠ¥
- âœ… ì‘ì—… ì¤‘ë‹¨/ì¬ì‹œë„ ê°€ëŠ¥
- âœ… ì‘ì—… ì´ë ¥ ì¶”ì  ê°€ëŠ¥

#### êµ¬í˜„ ìƒì„¸

```typescript
// 1. Job ìƒì„± API (Vercel - ì¦‰ì‹œ ì‘ë‹µ)
// POST /api/ai/jobs
interface CreateJobRequest {
  type: 'analysis' | 'report' | 'optimization';
  query: string;
  options?: {
    priority: 'low' | 'normal' | 'high';
    timeout?: number;  // Cloud Run ì¸¡ timeout
  };
}

interface CreateJobResponse {
  jobId: string;
  status: 'queued';
  estimatedTime: number;  // seconds
  pollUrl: string;        // ìƒíƒœ í™•ì¸ URL
}

// 2. Job ìƒíƒœ ì¡°íšŒ API (Vercel - ë¹ ë¥¸ ì‘ë‹µ)
// GET /api/ai/jobs/:jobId
interface JobStatusResponse {
  jobId: string;
  status: 'queued' | 'processing' | 'completed' | 'failed';
  progress: number;       // 0-100
  currentStep?: string;   // "ë°ì´í„° ìˆ˜ì§‘ ì¤‘..."
  result?: AIResponse;    // ì™„ë£Œ ì‹œ ê²°ê³¼
  error?: string;         // ì‹¤íŒ¨ ì‹œ ì—ëŸ¬
}

// 3. Cloud Run Worker (ì¥ì‹œê°„ ì²˜ë¦¬)
interface WorkerJob {
  jobId: string;
  query: string;
  updateProgress(step: string, progress: number): void;
  saveResult(result: AIResponse): void;
}
```

#### Supabase í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ

```sql
-- AI ì‘ì—… í…Œì´ë¸”
CREATE TABLE ai_jobs (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES auth.users(id),
  type VARCHAR(50) NOT NULL,
  query TEXT NOT NULL,
  status VARCHAR(20) DEFAULT 'queued',
  progress INTEGER DEFAULT 0,
  current_step TEXT,
  result JSONB,
  error TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  started_at TIMESTAMPTZ,
  completed_at TIMESTAMPTZ,

  -- RLS ì •ì±…
  CONSTRAINT valid_status CHECK (
    status IN ('queued', 'processing', 'completed', 'failed', 'cancelled')
  )
);

-- ì¸ë±ìŠ¤
CREATE INDEX idx_ai_jobs_user ON ai_jobs(user_id);
CREATE INDEX idx_ai_jobs_status ON ai_jobs(status);
```

### 2.2 Option B: Streaming + Progressive Response

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Streaming Progressive Architecture               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   SSE Stream    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    Stream    â”Œâ”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Client â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  Vercel   â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚Cloud â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   ì§„í–‰ë¥ /ê²°ê³¼   â”‚  (Proxy)  â”‚  ì²­í¬ ì „ë‹¬  â”‚ Run  â”‚ â”‚
â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚  ğŸ“¦ Stream Chunks:                                               â”‚
â”‚  â”œâ”€â”€ {"type": "progress", "step": "ë°ì´í„° ìˆ˜ì§‘", "pct": 10}     â”‚
â”‚  â”œâ”€â”€ {"type": "progress", "step": "ë¶„ì„ ì¤‘", "pct": 40}         â”‚
â”‚  â”œâ”€â”€ {"type": "partial", "content": "ì¤‘ê°„ ê²°ê³¼..."}             â”‚
â”‚  â””â”€â”€ {"type": "complete", "result": {...}}                       â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ì¥ì 
- âœ… ì‹¤ì‹œê°„ í”¼ë“œë°±
- âœ… ê¸°ì¡´ ìŠ¤íŠ¸ë¦¬ë° ì¸í”„ë¼ í™œìš©
- âœ… êµ¬í˜„ ë³µì¡ë„ ë‚®ìŒ

#### ë‹¨ì 
- âŒ ì—°ê²° ëŠê¸°ë©´ ì²˜ìŒë¶€í„° ì¬ì‹œì‘
- âŒ 60ì´ˆ ë„˜ëŠ” ì‘ì—…ì€ ì—¬ì „íˆ ë¬¸ì œ

#### êµ¬í˜„ ìƒì„¸

```typescript
// Cloud Runì—ì„œ ì§„í–‰ë¥  ìŠ¤íŠ¸ë¦¬ë°
function* processComplexQuery(query: string): Generator<StreamChunk> {
  yield { type: 'progress', step: 'ì¿¼ë¦¬ ë¶„ì„', pct: 5 };

  yield { type: 'progress', step: 'ì„œë²„ ë°ì´í„° ìˆ˜ì§‘', pct: 15 };
  const serverData = await collectServerData();

  yield { type: 'progress', step: 'AI ë¶„ì„ ì‹œì‘', pct: 30 };

  // ì¤‘ê°„ ê²°ê³¼ ìŠ¤íŠ¸ë¦¬ë°
  for await (const chunk of analyzeWithAI(serverData)) {
    yield { type: 'partial', content: chunk };
  }

  yield { type: 'complete', result: finalResult };
}
```

### 2.3 Option C: Hybrid (ê¶Œì¥ ì¡°í•©)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Hybrid Smart Routing                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Query Complexity Analysis                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚  ê°„ë‹¨í•œ ì¿¼ë¦¬ (ì˜ˆìƒ < 10s)  â”€â”€â†’  Direct Streaming        â”‚    â”‚
â”‚  â”‚  "ì„œë²„ ìƒíƒœ ì•Œë ¤ì¤˜"              (í˜„ì¬ ë°©ì‹ ìœ ì§€)         â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚  ì¤‘ê°„ ë³µì¡ë„ (10s < ì˜ˆìƒ < 60s) â”€â”€â†’  Progressive Stream  â”‚    â”‚
â”‚  â”‚  "ìµœê·¼ ì¥ì•  ë¶„ì„í•´ì¤˜"               (ì§„í–‰ë¥  í‘œì‹œ)         â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚  ë³µì¡í•œ ì¿¼ë¦¬ (ì˜ˆìƒ > 60s)  â”€â”€â†’  Job Queue               â”‚    â”‚
â”‚  â”‚  "ì „ì²´ ìµœì í™” ë¦¬í¬íŠ¸"            (ë¹„ë™ê¸° ì²˜ë¦¬)           â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ì¿¼ë¦¬ ë³µì¡ë„ ë¶„ì„ê¸°

```typescript
interface ComplexityAnalysis {
  level: 'simple' | 'medium' | 'complex';
  estimatedTime: number;
  factors: {
    dataVolume: 'low' | 'medium' | 'high';
    analysisDepth: 'shallow' | 'deep';
    multiStep: boolean;
  };
}

function analyzeQueryComplexity(query: string): ComplexityAnalysis {
  const keywords = {
    simple: ['ìƒíƒœ', 'í˜„ì¬', 'ì•Œë ¤ì¤˜', 'ë³´ì—¬ì¤˜'],
    complex: ['ë¶„ì„', 'ìµœì í™”', 'ë¦¬í¬íŠ¸', 'ì „ì²´', 'ëª¨ë“ ', 'ë¹„êµ', 'ì˜ˆì¸¡'],
    multiStep: ['ê·¸ë¦¬ê³ ', 'í›„ì—', 'ë‹¤ìŒì—', 'ê¸°ë°˜ìœ¼ë¡œ'],
  };

  // í‚¤ì›Œë“œ ë§¤ì¹­ + ê³¼ê±° ì¿¼ë¦¬ ì‹¤í–‰ ì‹œê°„ ê¸°ë°˜ ì˜ˆì¸¡
  // ...
}
```

## 3. êµ¬í˜„ ê¶Œì¥ ìˆœì„œ

### Phase 1: Progressive Streaming ê°œì„  (1ì£¼)
1. Cloud Runì—ì„œ ì§„í–‰ë¥  ìŠ¤íŠ¸ë¦¬ë° ì¶”ê°€
2. í”„ë¡ íŠ¸ì—”ë“œ ì§„í–‰ë¥  í‘œì‹œ UI êµ¬í˜„
3. ë¶€ë¶„ ê²°ê³¼ í‘œì‹œ ê¸°ëŠ¥

### Phase 2: Job Queue ê¸°ì´ˆ (2ì£¼)
1. Supabase `ai_jobs` í…Œì´ë¸” ìƒì„±
2. Job ìƒì„±/ì¡°íšŒ API êµ¬í˜„
3. Cloud Run Worker êµ¬í˜„
4. í´ë§ ê¸°ë°˜ ìƒíƒœ ì¡°íšŒ

### Phase 3: ìŠ¤ë§ˆíŠ¸ ë¼ìš°íŒ… (1ì£¼)
1. ì¿¼ë¦¬ ë³µì¡ë„ ë¶„ì„ê¸° êµ¬í˜„
2. ìë™ ë¼ìš°íŒ… ë¡œì§
3. ì‚¬ìš©ì ì„ íƒ ì˜µì…˜ (ë¹ ë¥¸ ì‘ë‹µ vs ìƒì„¸ ë¶„ì„)

### Phase 4: ìµœì í™” (1ì£¼)
1. WebSocket ê¸°ë°˜ ì‹¤ì‹œê°„ ìƒíƒœ ì—…ë°ì´íŠ¸
2. ì‘ì—… ìš°ì„ ìˆœìœ„ í
3. ì‘ì—… ì·¨ì†Œ/ì¬ì‹œë„

## 4. í”„ë¡ íŠ¸ì—”ë“œ UX

### 4.1 ê°„ë‹¨í•œ ì¿¼ë¦¬ (í˜„ì¬ì™€ ë™ì¼)
```
User: "ì„œë²„ ìƒíƒœ ì•Œë ¤ì¤˜"
AI: [ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ] "í˜„ì¬ 30ëŒ€ ì„œë²„ ì¤‘ 28ëŒ€ ì •ìƒ..."
```

### 4.2 ë³µì¡í•œ ì¿¼ë¦¬ (Job Queue)
```
User: "ëª¨ë“  ì„œë²„ ìµœì í™” ë¶„ì„ ë¦¬í¬íŠ¸ ë§Œë“¤ì–´ì¤˜"

AI: "ğŸ“Š ë³µì¡í•œ ë¶„ì„ì´ í•„ìš”í•©ë‹ˆë‹¤. ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì²˜ë¦¬í• ê¹Œìš”?"
    [ë¹ ë¥¸ ìš”ì•½ (10ì´ˆ)] [ìƒì„¸ ë¶„ì„ ì‹œì‘ (ì˜ˆìƒ 3ë¶„)]

    â†“ (ì‚¬ìš©ìê°€ ìƒì„¸ ë¶„ì„ ì„ íƒ)

AI: "ğŸ”„ ë¶„ì„ ì‘ì—…ì„ ì‹œì‘í–ˆìŠµë‹ˆë‹¤. (ì‘ì—… ID: job_abc123)"

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ğŸ“ˆ AI ë¶„ì„ ì§„í–‰ ì¤‘...               â”‚
    â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 40%            â”‚
    â”‚ í˜„ì¬: ì„œë²„ #15 ì„±ëŠ¥ ë°ì´í„° ë¶„ì„ ì¤‘  â”‚
    â”‚ ì˜ˆìƒ ì™„ë£Œ: 2ë¶„ 30ì´ˆ                 â”‚
    â”‚                                      â”‚
    â”‚ [ì·¨ì†Œ] [ë°±ê·¸ë¼ìš´ë“œë¡œ ì´ë™]           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â†“ (ì™„ë£Œ)

AI: "âœ… ë¶„ì„ ì™„ë£Œ!"
    [ì „ì²´ ë¦¬í¬íŠ¸ ë³´ê¸°] [ìš”ì•½ ë³´ê¸°] [PDF ë‹¤ìš´ë¡œë“œ]
```

## 5. ë¹„ìš© ê³ ë ¤ì‚¬í•­

### 5.1 Supabase (ë¬´ë£Œ í‹°ì–´)
- 500MB DB: Job í…Œì´ë¸”ì€ ~1KB/job, ì•½ 50ë§Œ ê±´ ê°€ëŠ¥
- ê²°ê³¼ JSONB í‰ê·  5KB ê°€ì • ì‹œ ~10ë§Œ ê±´

### 5.2 Cloud Run (ë¬´ë£Œ í‹°ì–´)
- 200ë§Œ í˜¸ì¶œ/ì›”: Job ì²˜ë¦¬ì— ì¶©ë¶„
- ì¥ì‹œê°„ ì‘ì—…ì€ ë¹„ìš© ì¦ê°€ ê°€ëŠ¥ (ë¶„ë‹¹ ê³¼ê¸ˆ)

### 5.3 ìµœì í™” ì „ëµ
- ì™„ë£Œëœ Job 7ì¼ í›„ ìë™ ì‚­ì œ
- í° ê²°ê³¼ëŠ” ìš”ì•½ë§Œ ì €ì¥, ì „ì²´ëŠ” ì„ì‹œ íŒŒì¼ë¡œ
- Rate limitingìœ¼ë¡œ ë‚¨ìš© ë°©ì§€

## 6. ê²°ë¡ 

### 6.1 ì¦‰ì‹œ êµ¬í˜„ ê¶Œì¥
1. **Progressive Streaming**: ì§„í–‰ë¥  í‘œì‹œë§Œ ì¶”ê°€ (ë‚®ì€ ë³µì¡ë„, ë†’ì€ UX ê°œì„ )
2. **ì¿¼ë¦¬ ë³µì¡ë„ ê²½ê³ **: ì˜¤ë˜ ê±¸ë¦´ ê²ƒ ê°™ìœ¼ë©´ ë¯¸ë¦¬ ì•ˆë‚´

### 6.2 ì¤‘ê¸° êµ¬í˜„ ê¶Œì¥
1. **Job Queue ì‹œìŠ¤í…œ**: ë³µì¡í•œ ì¿¼ë¦¬ì— ëŒ€í•œ ê·¼ë³¸ì  í•´ê²°
2. **ìŠ¤ë§ˆíŠ¸ ë¼ìš°íŒ…**: ìë™ìœ¼ë¡œ ìµœì  ê²½ë¡œ ì„ íƒ

---

## 7. êµ¬í˜„ ì™„ë£Œ (Phase 1)

### 7.1 êµ¬í˜„ëœ API ì—”ë“œí¬ì¸íŠ¸

| ì—”ë“œí¬ì¸íŠ¸ | ë©”ì„œë“œ | ì„¤ëª… |
|-----------|--------|------|
| `/api/ai/jobs` | POST | Job ìƒì„± |
| `/api/ai/jobs` | GET | Job ëª©ë¡ ì¡°íšŒ |
| `/api/ai/jobs/:id` | GET | ê°œë³„ Job ìƒíƒœ ì¡°íšŒ |
| `/api/ai/jobs/:id` | DELETE | Job ì·¨ì†Œ |
| `/api/ai/jobs/:id/progress` | PATCH | ì§„í–‰ë¥  ì—…ë°ì´íŠ¸ (Worker ì „ìš©) |

### 7.2 í”„ë¡ íŠ¸ì—”ë“œ í›…

```typescript
// ë‹¨ìˆœ í´ë§
import { useJobPolling } from '@/hooks/ai/useJobPolling';

const { job, isPolling, cancelJob } = useJobPolling(jobId, {
  onComplete: (result) => console.log('ì™„ë£Œ:', result),
  onProgress: (progress, step) => setProgress(progress),
});

// ìƒì„± + í´ë§ í†µí•©
import { useJobSubmit } from '@/hooks/ai/useJobPolling';

const { submitJob, job, isSubmitting, isPolling } = useJobSubmit();
await submitJob('analysis', 'ëª¨ë“  ì„œë²„ ìƒíƒœ ë¶„ì„í•´ì¤˜');
```

### 7.3 Cloud Run Worker ì—°ë™

```python
# Cloud Run Workerì—ì„œ ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
import httpx

VERCEL_API = "https://your-app.vercel.app"
WORKER_SECRET = os.getenv("AI_WORKER_SECRET")

async def update_progress(job_id: str, progress: int, step: str):
    await httpx.patch(
        f"{VERCEL_API}/api/ai/jobs/{job_id}/progress",
        headers={"Authorization": f"Bearer {WORKER_SECRET}"},
        json={"status": "processing", "progress": progress, "currentStep": step}
    )

async def complete_job(job_id: str, result: dict):
    await httpx.patch(
        f"{VERCEL_API}/api/ai/jobs/{job_id}/progress",
        headers={"Authorization": f"Bearer {WORKER_SECRET}"},
        json={"status": "completed", "result": result}
    )
```

---

## ì°¸ê³  ìë£Œ
- [Vercel Function Limits](https://vercel.com/docs/functions/runtimes#max-duration)
- [Cloud Run Timeout](https://cloud.google.com/run/docs/configuring/request-timeout)
- [Server-Sent Events (SSE)](https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events)
