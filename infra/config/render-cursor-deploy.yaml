# ğŸš€ Render + Cursor IDE ì§ì ‘ ë°°í¬ ì„¤ì •
# OpenManager Vibe v5 - MCP ì„œë²„ ë°°í¬ (Cursor ì—°ë™)

services:
  - type: web
    name: openmanager-mcp-cursor
    runtime: node
    plan: free
    region: oregon
    branch: main
    rootDir: mcp-server
    
    # ğŸ”§ ë¹Œë“œ ë° ì‹œì‘ ëª…ë ¹
    buildCommand: |
      echo "ğŸš€ Cursor IDE ì—°ë™ ë¹Œë“œ ì‹œì‘..."
      npm ci --production=false
      npm run build
      echo "âœ… ë¹Œë“œ ì™„ë£Œ"
    
    startCommand: |
      echo "ğŸŒŸ OpenManager MCP ì„œë²„ ì‹œì‘ (Cursor ì—°ë™)..."
      npm start
    
    # ğŸ¥ í—¬ìŠ¤ì²´í¬ ì„¤ì •
    healthCheckPath: /health
    
    # ğŸ”„ ìë™ ë°°í¬ ì„¤ì • (Cursorì—ì„œ í‘¸ì‹œ ì‹œ ìë™ ë°°í¬)
    autoDeploy: true
    
    # ğŸŒ í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
    envVars:
      - key: NODE_ENV
        value: production
      - key: RENDER
        value: 'true'
      - key: CURSOR_DEPLOY
        value: 'true'
      - key: ENABLE_HTTP
        value: 'true'
      - key: PORT
        value: '10000'
      - key: AI_ENGINE_MODE
        value: 'true'
      - key: NODE_OPTIONS
        value: '--max-old-space-size=512'
      - key: NEXT_TELEMETRY_DISABLED
        value: '1'
      - key: PROJECT_ROOT
        value: /opt/render/project/src
      - key: DEPLOY_SOURCE
        value: 'cursor-ide'
      - key: DEPLOY_TIMESTAMP
        generateValue: true
      
      # ğŸ” ë³´ì•ˆ í‚¤ (Render ëŒ€ì‹œë³´ë“œì—ì„œ ìˆ˜ë™ ì„¤ì •)
      - key: GITHUB_TOKEN
        sync: false
      - key: SUPABASE_URL
        sync: false
      - key: SUPABASE_ANON_KEY
        sync: false
      - key: UPSTASH_REDIS_REST_URL
        sync: false
      - key: UPSTASH_REDIS_REST_TOKEN
        sync: false
      - key: GOOGLE_AI_API_KEY
        sync: false
    
    # ğŸ”§ ë¹Œë“œ í™˜ê²½ ì„¤ì •
    buildFilter:
      paths:
        - mcp-server/**
        - src/services/mcp/**
        - package.json
        - package-lock.json
      ignoredPaths:
        - docs/**
        - tests/**
        - development/**
        - .storybook/**
    
    # ğŸ“Š ëª¨ë‹ˆí„°ë§ ì„¤ì •
    notifications:
      - type: slack
        name: cursor-deploy-notifications
        channel: "#openmanager-deploy"
        events:
          - deploy-started
          - deploy-succeeded
          - deploy-failed
          - service-suspended
    
    # ğŸš¨ ì•Œë¦¼ ì„¤ì •
    alerts:
      - rule: cpu > 80
        duration: 5m
      - rule: memory > 90
        duration: 3m
      - rule: response_time > 5s
        duration: 2m

# ğŸ”§ Cursor IDE ì—°ë™ ì„¤ì •
cursor_integration:
  # SSH í‚¤ ê¸°ë°˜ ë°°í¬
  ssh_deploy:
    enabled: true
    key_path: ~/.ssh/render_cursor_deploy
    
  # Git Hook ì„¤ì •
  git_hooks:
    pre_push: |
      echo "ğŸ” Cursor â†’ Render ë°°í¬ ì „ ê²€ì¦..."
      npm run validate:quick
      echo "âœ… ê²€ì¦ ì™„ë£Œ"
    
    post_push: |
      echo "ğŸš€ Render ë°°í¬ íŠ¸ë¦¬ê±°ë¨"
      echo "ğŸ“ ë°°í¬ URL: https://openmanager-mcp-cursor.onrender.com"
  
  # ë°°í¬ ìŠ¤í¬ë¦½íŠ¸
  deploy_scripts:
    quick_deploy: |
      #!/bin/bash
      echo "âš¡ Cursor ë¹ ë¥¸ ë°°í¬ ì‹œì‘..."
      git add .
      git commit -m "ğŸš€ Cursor ë¹ ë¥¸ ë°°í¬: $(date)"
      git push origin main
      echo "âœ… ë°°í¬ ì™„ë£Œ!"
    
    rollback: |
      #!/bin/bash
      echo "ğŸ”„ ì´ì „ ë²„ì „ìœ¼ë¡œ ë¡¤ë°±..."
      git revert HEAD --no-edit
      git push origin main
      echo "âœ… ë¡¤ë°± ì™„ë£Œ!"

# ğŸ“ ë°°í¬ ë¡œê·¸ ì„¤ì •
logging:
  level: info
  format: json
  destinations:
    - console
    - file: /opt/render/project/logs/deploy.log
  
  # Cursor ì „ìš© ë¡œê·¸
  cursor_logs:
    enabled: true
    path: /opt/render/project/logs/cursor-deploy.log
    rotation: daily
    retention: 7d

# ğŸ”’ ë³´ì•ˆ ì„¤ì •
security:
  # CORS ì„¤ì • (Cursor IDE ì ‘ê·¼ í—ˆìš©)
  cors:
    origins:
      - "vscode-webview://*"
      - "https://*.cursor.sh"
      - "http://localhost:*"
    methods: ["GET", "POST", "PUT", "DELETE"]
    headers: ["Content-Type", "Authorization", "X-Cursor-Token"]
  
  # API í‚¤ ë³´í˜¸
  api_protection:
    rate_limit: 100/minute
    ip_whitelist:
      - "0.0.0.0/0" # ê°œë°œ ë‹¨ê³„ì—ì„œëŠ” ëª¨ë“  IP í—ˆìš©
    
  # í™˜ê²½ ë³€ìˆ˜ ì•”í˜¸í™”
  env_encryption:
    enabled: true
    algorithm: AES-256-GCM
    
# ğŸ¯ ì„±ëŠ¥ ìµœì í™”
performance:
  # ìºì‹œ ì„¤ì •
  cache:
    static_files: 24h
    api_responses: 5m
    
  # ì••ì¶• ì„¤ì •
  compression:
    enabled: true
    algorithms: ["gzip", "br"]
    
  # ë©”ëª¨ë¦¬ ìµœì í™”
  memory:
    max_heap_size: 400MB
    gc_interval: 30s
    
# ğŸ“Š ëª¨ë‹ˆí„°ë§ ë° ë¶„ì„
monitoring:
  # ë©”íŠ¸ë¦­ ìˆ˜ì§‘
  metrics:
    enabled: true
    interval: 30s
    endpoints:
      - /health
      - /metrics
      - /api/status
    
  # ì—…íƒ€ì„ ëª¨ë‹ˆí„°ë§
  uptime:
    check_interval: 60s
    timeout: 10s
    retries: 3
    
  # ì„±ëŠ¥ ì¶”ì 
  performance_tracking:
    response_time: true
    throughput: true
    error_rate: true
    memory_usage: true
    cpu_usage: true

# ğŸ”§ ê°œë°œì ë„êµ¬
dev_tools:
  # ì›ê²© ë””ë²„ê¹… (ê°œë°œ í™˜ê²½ì—ì„œë§Œ)
  remote_debug:
    enabled: false # í”„ë¡œë•ì…˜ì—ì„œëŠ” ë¹„í™œì„±í™”
    port: 9229
    
  # ë¡œê·¸ ìŠ¤íŠ¸ë¦¬ë°
  log_streaming:
    enabled: true
    websocket_endpoint: /logs/stream
    
  # ìƒíƒœ ëŒ€ì‹œë³´ë“œ
  status_dashboard:
    enabled: true
    endpoint: /admin/status
    auth_required: true

# ğŸ“‹ ë©”íƒ€ë°ì´í„°
metadata:
  version: "5.44.0"
  created_by: "cursor-ide"
  last_updated: "2024-06-24"
  description: "OpenManager Vibe v5 MCP Server - Cursor IDE ì§ì ‘ ë°°í¬ìš©"
  tags:
    - openmanager
    - mcp-server
    - cursor-ide
    - nodejs
    - ai-engine
  
  # ë°°í¬ ì •ë³´
  deploy_info:
    source: "cursor-ide"
    branch: "main"
    auto_deploy: true
    rollback_enabled: true
    
  # ì—°ë½ì²˜ ì •ë³´
  contacts:
    developer: "OpenManager Team"
    support: "support@openmanager.dev"
    docs: "https://docs.openmanager.dev" 