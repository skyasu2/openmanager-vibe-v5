#!/bin/bash
# Git pre-commit hook for secret scanning
# μ„¤μΉ: cp .githooks/pre-commit .git/hooks/pre-commit && chmod +x .git/hooks/pre-commit

echo "π” Pre-commit: μ‹ν¬λ¦Ώ κ²€μ‚¬ μ¤‘..."

# μ¤ν¬λ¦½νΈ μ‹¤ν–‰
./scripts/security/check-secrets.sh

# κ²€μ‚¬ κ²°κ³Ό ν™•μΈ
if [ $? -ne 0 ]; then
    echo ""
    echo "β μ»¤λ°‹μ΄ μ¤‘λ‹¨λμ—μµλ‹λ‹¤: μ‹ν¬λ¦Ώμ΄ λ°κ²¬λμ—μµλ‹λ‹¤!"
    echo "μ„μ κ²½κ³ λ¥Ό ν™•μΈν•κ³  λ¬Έμ λ¥Ό ν•΄κ²°ν• ν›„ λ‹¤μ‹ μ‹λ„ν•μ„Έμ”."
    exit 1
fi

echo "β… Pre-commit: μ‹ν¬λ¦Ώ κ²€μ‚¬ ν†µκ³Ό"

# TypeScript νƒ€μ… μ²΄ν¬ (μ„ νƒμ‚¬ν•­)
if command -v npm &> /dev/null; then
    echo "π” Pre-commit: TypeScript νƒ€μ… μ²΄ν¬ μ¤‘..."
    npm run type-check --silent
    
    if [ $? -ne 0 ]; then
        echo "β μ»¤λ°‹μ΄ μ¤‘λ‹¨λμ—μµλ‹λ‹¤: TypeScript νƒ€μ… μ—λ¬κ°€ μμµλ‹λ‹¤!"
        exit 1
    fi
    
    echo "β… Pre-commit: TypeScript νƒ€μ… μ²΄ν¬ ν†µκ³Ό"
fi

echo "β… λ¨λ“  κ²€μ‚¬λ¥Ό ν†µκ³Όν–μµλ‹λ‹¤. μ»¤λ°‹μ„ μ§„ν–‰ν•©λ‹λ‹¤..."