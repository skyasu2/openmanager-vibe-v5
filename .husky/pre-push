#!/bin/sh

echo "ğŸš€ Pre-push ê²€ì¦ ì‹œì‘ (Non-blocking v3.0)..."

# Skip if HUSKY is disabled
if [ "$HUSKY" = "0" ]; then
    echo "â­ï¸  Huskyê°€ ë¹„í™œì„±í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ê²€ì¦ì„ ê±´ë„ˆëœë‹ˆë‹¤."
    exit 0
fi

# Fast track options
if [ "$1" = "--fast" ] || [ "$FAST_PUSH" = "1" ]; then
    echo "âš¡ Fast track ëª¨ë“œ - ê¸°ë³¸ ê²€ì¦ë§Œ ì‹¤í–‰"
    npm run test:quick
    exit $?
fi

# ë‹¨ìˆœ ë™ê¸° ì‹¤í–‰ (ë°±ê·¸ë¼ìš´ë“œ í”„ë¡œì„¸ìŠ¤ ì œê±°)
echo "ğŸ§ª í•µì‹¬ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘..."
npm run test:quick

TEST_RESULT=$?

# ê²°ê³¼ ì²˜ë¦¬
if [ $TEST_RESULT -ne 0 ]; then
    echo "âŒ í•µì‹¬ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨!"
    echo "ğŸ’¡ í•´ê²°ì±…:"
    echo "   - npm test (ìƒì„¸ í…ŒìŠ¤íŠ¸)"
    echo "   - npm run test:watch (ì›Œì¹˜ ëª¨ë“œ)"
    echo "   - HUSKY=0 git push (ê¸´ê¸‰ ì‹œë§Œ)"
    echo "   - git push --fast (ë¹ ë¥¸ í‘¸ì‹œ)"
    exit 1
fi

# ì„±ê³µ ë©”ì‹œì§€
echo "âœ… Pre-push ê²€ì¦ ì™„ë£Œ!"
echo "ğŸš€ Pushë¥¼ ì§„í–‰í•©ë‹ˆë‹¤..."
echo "ğŸ“Š ì„±ëŠ¥: ë‹¨ìˆœí™”ë¡œ íƒ€ì„ì•„ì›ƒ ë¬¸ì œ í•´ê²°"