#!/bin/sh

echo "🚀 Pre-push 검증 시작..."

# Skip if HUSKY is disabled
if [ "$HUSKY" = "0" ]; then
    echo "⏭️  Husky가 비활성화되어 있습니다. 검증을 건너뜁니다."
    exit 0
fi

# 임시 완화된 Pre-push 검증
echo "📋 TypeScript 타입 체크 중 (경고만)..."
npm run type-check 2>&1 | head -20

# TypeScript 에러는 경고로만 처리 (차단하지 않음)
if [ $? -ne 0 ]; then
    echo "⚠️  TypeScript 타입 경고가 있습니다. (계속 진행)"
    echo "💡 나중에 수정해주세요: npm run type-check"
fi

echo "🧪 핵심 테스트 실행 중..."
npm run test:quick

if [ $? -ne 0 ]; then
    echo "❌ 테스트 실패!"
    echo "💡 해결책: npm test 실행 후 수정"
    echo "   또는 HUSKY=0 git push (긴급시만)"
    exit 1
fi

echo "✅ Pre-push 검증 완료!"
echo "🚀 Push를 진행합니다..."