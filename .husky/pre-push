#!/bin/sh

echo "ğŸš€ ì§€ëŠ¥í˜• Pre-push ê²€ì¦ ì‹œì‘..."

# Skip if HUSKY is disabled
if [ "$HUSKY" = "0" ]; then
    echo "â­ï¸  Huskyê°€ ë¹„í™œì„±í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ê²€ì¦ì„ ê±´ë„ˆëœë‹ˆë‹¤."
    exit 0
fi

# ğŸ§  ì§€ëŠ¥í˜• Pre-push ì—”ì§„ ì‹¤í–‰
node scripts/intelligent-pre-push.js

# í´ë°±: ê¸°ë³¸ ê²€ì‚¬ (Node.js ì‹¤í–‰ ì‹¤íŒ¨ ì‹œ)
if [ $? -ne 0 ]; then
    echo "âš¡ í´ë°±: ê¸°ë³¸ Pre-push ê²€ì¦"
    
    # ê¸°ë³¸ ë¹ ë¥¸ ê²€ì¦
    echo "âš¡ ë¹ ë¥¸ ê²€ì¦ ì‹¤í–‰ ì¤‘..."
    npm run validate:fast
    
    if [ $? -ne 0 ]; then
        echo "âŒ ë¹ ë¥¸ ê²€ì¦ ì‹¤íŒ¨!"
        echo "ğŸ’¡ í•´ê²°ì±…:"
        echo "  npm run lint:fix && npm run type-check"
        echo "  ë˜ëŠ” HUSKY=0 git push (ê°•ì œ í‘¸ì‹œ)"
        
        # ëŒ€í™”í˜• ëª¨ë“œì—ì„œë§Œ ì„ íƒ ì˜µì…˜ ì œê³µ
        if [ -t 0 ]; then
            echo ""
            echo "ê·¸ë˜ë„ í‘¸ì‹œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? (y/N)"
            read -r response
            if [ "$response" = "y" ] || [ "$response" = "Y" ]; then
                exit 0
            fi
        fi
        
        exit 1
    fi
fi

echo "âœ… Pre-push ê²€ì¦ ì™„ë£Œ!"
echo "ğŸš€ Pushë¥¼ ì§„í–‰í•©ë‹ˆë‹¤..."