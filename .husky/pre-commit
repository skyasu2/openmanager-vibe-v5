#!/bin/sh

echo "ğŸš€ Pre-commit ê²€ì¦ ì‹œì‘..."

# í™˜ê²½ ë³€ìˆ˜ë¡œ ìŠ¤í‚µ ê°€ëŠ¥
if [ "$HUSKY" = "0" ]; then
    echo "â­ï¸  Huskyê°€ ë¹„í™œì„±í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ê²€ì¦ì„ ê±´ë„ˆëœë‹ˆë‹¤."
    exit 0
fi

# lint-staged ì‹¤í–‰ (ë³€ê²½ëœ íŒŒì¼ë§Œ ê²€ì‚¬)
echo "ğŸ§¹ ë³€ê²½ëœ íŒŒì¼ ê²€ì‚¬ ì¤‘..."
npx lint-staged

if [ $? -ne 0 ]; then
    echo "âŒ Pre-commit ê²€ì¦ ì‹¤íŒ¨!"
    exit 1
fi

# ë³´ì•ˆ ê²€ì‚¬ (í•˜ë“œì½”ë”©ëœ ì‹œí¬ë¦¿ ê²€ì‚¬)
echo "ğŸ”’ ë³´ì•ˆ ê²€ì‚¬ ì¤‘..."
if [ -f "scripts/check-hardcoded-secrets.sh" ]; then
    bash scripts/check-hardcoded-secrets.sh
    if [ $? -ne 0 ]; then
        echo "âŒ ë³´ì•ˆ ê²€ì‚¬ ì‹¤íŒ¨! í•˜ë“œì½”ë”©ëœ ì‹œí¬ë¦¿ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤."
        exit 1
    fi
fi

# ë¬¸ì„œ íŒŒì¼ ì‹œí¬ë¦¿ ê²€ì‚¬ (ì„ íƒì‚¬í•­)
if [ -f "scripts/security/check-secrets-in-docs.sh" ]; then
    echo "ğŸ“„ ë¬¸ì„œ íŒŒì¼ ì‹œí¬ë¦¿ ê²€ì‚¬ ì¤‘..."
    bash scripts/security/check-secrets-in-docs.sh
    if [ $? -ne 0 ]; then
        echo "âŒ ë¬¸ì„œ íŒŒì¼ì—ì„œ ì‹œí¬ë¦¿ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤!"
        echo "ğŸ’¡ í† í°ì„ [REDACTED]ë¡œ êµì²´í•˜ê±°ë‚˜ ì˜ˆì‹œ í˜•ì‹ìœ¼ë¡œ ë³€ê²½í•˜ì„¸ìš”."
        exit 1
    fi
fi

echo "âœ… Pre-commit ê²€ì¦ í†µê³¼!"