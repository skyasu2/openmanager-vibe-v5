#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Pre-commit ê²€ì¦ ì‹œì‘..."

# ë¹„ë°€ í‚¤ ìŠ¤ìº”
echo "ğŸ” ë¹„ë°€ í‚¤ ìœ ì¶œ ê²€ì‚¬..."
node scripts/precommit-check-secrets.js
if [ $? -ne 0 ]; then
  exit 1
fi

# íƒ€ì… ì²´í¬
echo "ğŸ“ TypeScript íƒ€ì… ì²´í¬..."
npm run type-check
if [ $? -ne 0 ]; then
  echo "âŒ TypeScript íƒ€ì… ì—ëŸ¬ê°€ ìˆìŠµë‹ˆë‹¤. ìˆ˜ì • í›„ ë‹¤ì‹œ ì»¤ë°‹í•˜ì„¸ìš”."
  exit 1
fi

# ESLint ì²´í¬
echo "ğŸ”§ ESLint ê²€ì‚¬..."
npm run lint
if [ $? -ne 0 ]; then
  echo "âŒ ESLint ì—ëŸ¬ê°€ ìˆìŠµë‹ˆë‹¤. ìˆ˜ì • í›„ ë‹¤ì‹œ ì»¤ë°‹í•˜ì„¸ìš”."
  exit 1
fi

# Staged íŒŒì¼ í¬ë§·íŒ…
echo "âœ¨ ì½”ë“œ í¬ë§·íŒ…..."
npx lint-staged

# ìŠ¤í† ë¦¬ë¶ ê²€ì¦ ì¶”ê°€
echo "ğŸ” ìŠ¤í† ë¦¬ë¶ íŒŒì¼ ê²€ì¦ ì¤‘..."
npm run storybook:validate --silent || {
  echo "âŒ ìŠ¤í† ë¦¬ë¶ íŒŒì¼ì— ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤. ìˆ˜ì • í›„ ë‹¤ì‹œ ì»¤ë°‹í•´ì£¼ì„¸ìš”."
  exit 1
}

echo "âœ… Pre-commit ê²€ì¦ ì™„ë£Œ!"
