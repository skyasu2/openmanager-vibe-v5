#!/bin/sh

echo "ğŸš€ ì§€ëŠ¥í˜• Pre-commit ê²€ì¦ ì‹œì‘..."

# í™˜ê²½ ë³€ìˆ˜ë¡œ ìŠ¤í‚µ ê°€ëŠ¥
if [ "$HUSKY" = "0" ]; then
    echo "â­ï¸  Huskyê°€ ë¹„í™œì„±í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ê²€ì¦ì„ ê±´ë„ˆëœë‹ˆë‹¤."
    exit 0
fi

# ğŸ§  ì§€ëŠ¥í˜• ê²€ì¦ ì—”ì§„ ì‹¤í–‰
node scripts/intelligent-pre-commit.js

# í´ë°±: ê¸°ë³¸ ê²€ì‚¬ (Node.js ì‹¤í–‰ ì‹¤íŒ¨ ì‹œ)
if [ $? -ne 0 ]; then
    echo "âš¡ í´ë°±: ê¸°ë³¸ ê²€ì¦ ëª¨ë“œ"
    
    # ê¸°ë³¸ lint-staged
    echo "ğŸ§¹ ë³€ê²½ëœ íŒŒì¼ ê²€ì‚¬ ì¤‘..."
    npx lint-staged --concurrent=true
    
    if [ $? -ne 0 ]; then
        echo "âŒ Pre-commit ê²€ì¦ ì‹¤íŒ¨!"
        echo "ğŸ’¡ í•´ê²°: npm run lint:fix && npm run type-check"
        exit 1
    fi
    
    # ê¸°ë³¸ ë³´ì•ˆ ê²€ì‚¬
    echo "ğŸ”’ ë³´ì•ˆ ê²€ì‚¬ ì¤‘..."
    if [ -f "scripts/check-hardcoded-secrets.sh" ]; then
        bash scripts/check-hardcoded-secrets.sh --quick
        if [ $? -ne 0 ]; then
            echo "âŒ ë³´ì•ˆ ê²€ì‚¬ ì‹¤íŒ¨!"
            exit 1
        fi
    fi
fi

echo "âœ… Pre-commit ê²€ì¦ ì™„ë£Œ!"