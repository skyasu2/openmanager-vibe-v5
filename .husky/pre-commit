#!/bin/sh

# 환경 변수로 스킵 가능
if [ "$HUSKY" = "0" ]; then
    echo "⏭️  HUSKY=0 설정으로 검증을 건너뜁니다."
    exit 0
fi

echo "🧹 변경된 파일만 검사 중..."

# 보안 검사: 하드코딩된 시크릿 탐지
echo "🔒 보안 검사: 하드코딩된 시크릿 탐지 중..."
node scripts/security/check-hardcoded-secrets.js

if [ $? -ne 0 ]; then
    echo "❌ 보안 검사 실패! 하드코딩된 시크릿을 제거하세요."
    exit 1
fi

# 핵심 수정: lint-staged만 실행 (변경된 파일만 검사)
npx lint-staged

# 중국어 검사 비활성화 (Qwen에서 자동 차단 설정됨)

echo "✅ Pre-commit 완료!"