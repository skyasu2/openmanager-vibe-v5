#!/bin/sh

echo "ğŸš€ Pre-commit ê²€ì¦ ì‹œì‘..."

# í™˜ê²½ ë³€ìˆ˜ë¡œ ìŠ¤í‚µ ê°€ëŠ¥
if [ "$HUSKY" = "0" ]; then
    echo "â­ï¸  Huskyê°€ ë¹„í™œì„±í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ê²€ì¦ì„ ê±´ë„ˆëœë‹ˆë‹¤."
    exit 0
fi

# í•µì‹¬ ê²€ì‚¬ 1: lint-staged ì‹¤í–‰ (ë³€ê²½ëœ íŒŒì¼ë§Œ ê²€ì‚¬) - 2025 í‘œì¤€
echo "ğŸ§¹ ë³€ê²½ëœ íŒŒì¼ ê²€ì‚¬ ì¤‘... (ì„±ëŠ¥ ìµœì í™” ëª¨ë“œ)"
npx lint-staged --concurrent=true

if [ $? -ne 0 ]; then
    echo "âŒ Pre-commit ê²€ì¦ ì‹¤íŒ¨!"
    echo "ğŸ’¡ ë¬¸ì œ í•´ê²°: npm run lint:fix ì‹¤í–‰ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”."
    exit 1
fi

# í•µì‹¬ ê²€ì‚¬ 2: ë³´ì•ˆ ê²€ì‚¬ (í•˜ë“œì½”ë”©ëœ ì‹œí¬ë¦¿ ê²€ì‚¬) - í•„ìˆ˜
echo "ğŸ”’ ë³´ì•ˆ ê²€ì‚¬ ì¤‘..."
if [ -f "scripts/check-hardcoded-secrets.sh" ]; then
    bash scripts/check-hardcoded-secrets.sh
    if [ $? -ne 0 ]; then
        echo "âŒ ë³´ì•ˆ ê²€ì‚¬ ì‹¤íŒ¨! í•˜ë“œì½”ë”©ëœ ì‹œí¬ë¦¿ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤."
        echo "ğŸ’¡ í™˜ê²½ë³€ìˆ˜ë¡œ ëŒ€ì²´í•˜ê±°ë‚˜ .env.localì— ì¶”ê°€í•˜ì„¸ìš”."
        exit 1
    fi
fi

echo "âœ… Pre-commit ê²€ì¦ í†µê³¼!"