#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "ğŸ” Pre-commit: Quick checks (< 5ì´ˆ ëª©í‘œ)..."
START_TIME=$(date +%s)

# 1. .env íŒŒì¼ ì°¨ë‹¨
echo "ğŸ”’ Checking for sensitive files..."
if git diff --cached --name-only | grep -E '^\.env$|^\.env\.|\.env$' | grep -v '\.env\.example$'; then
  echo "âŒ .env íŒŒì¼ì€ ì»¤ë°‹í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤"
  exit 1
fi

# 2. API í‚¤/ë¹„ë°€í‚¤ íŒ¨í„´ ê²€ì‚¬
STAGED_CONTENT=$(git diff --cached)
if echo "$STAGED_CONTENT" | grep -qiE '(api[_-]?key|secret[_-]?key|password|token).*=.*["\047][A-Za-z0-9+/=]{20,}["\047]'; then
  echo "âŒ í•˜ë“œì½”ë”©ëœ API í‚¤ë‚˜ ë¹„ë°€í‚¤ê°€ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤"
  echo "ğŸ’¡ í™˜ê²½ë³€ìˆ˜(.env.local)ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”"
  exit 1
fi

# 3. package.json ë¬¸ë²• ê²€ì‚¬
if git diff --cached --name-only | grep -q "package.json"; then
  echo "ğŸ“¦ Checking package.json..."
  node -e "JSON.parse(require('fs').readFileSync('package.json', 'utf8'))" || {
    echo "âŒ package.json has syntax errors"
    exit 1
  }
fi

END_TIME=$(date +%s)
DURATION=$((END_TIME - START_TIME))

echo "âœ… Pre-commit passed in ${DURATION}s"
echo "ğŸ’¡ Format: Run 'npm run format' before commit (optional)"
echo "ğŸ’¡ Full lint will run in pre-push"
