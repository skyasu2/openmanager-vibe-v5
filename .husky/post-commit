#!/usr/bin/env bash

# Post-commit Hook: Background AI Code Review
# ëª©ì : ì»¤ë°‹ ì™„ë£Œ í›„ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ìžë™ AI ì½”ë“œ ë¦¬ë·° ì‹¤í–‰
# ë³€ê²½ ì´ë ¥:
#   - 2025-11-26: pre-commitì—ì„œ post-commitìœ¼ë¡œ ì´ë™ (ì»¤ë°‹ ë¸”ë¡œí‚¹ ë°©ì§€)

set -e

echo "ðŸš€ Post-commit validation started (background)..."

# 1. ESLint ì „ì²´ ê²€ì‚¬ (ë°±ê·¸ë¼ìš´ë“œ, íƒ€ìž„ì•„ì›ƒ ì—†ìŒ)
if [ -f "scripts/lint/run-lint-check.sh" ]; then
    echo "  ðŸ” ESLint check â†’ logs/lint-reports/"
    bash scripts/lint/run-lint-check.sh > /dev/null 2>&1 &
fi

# 2. TypeScript íƒ€ìž… ì²´í¬ (ë°±ê·¸ë¼ìš´ë“œ, íƒ€ìž„ì•„ì›ƒ ì—†ìŒ)
if [ -f "scripts/typecheck/run-typecheck.sh" ]; then
    echo "  ðŸ“ TypeScript check â†’ logs/typecheck-reports/"
    bash scripts/typecheck/run-typecheck.sh > /dev/null 2>&1 &
fi

# 3. Auto AI Code Review (Codex â†’ Gemini Fallback, ë°±ê·¸ë¼ìš´ë“œ)
if [ -f "scripts/code-review/auto-ai-review.sh" ]; then
    echo "  ðŸ¤– AI code review â†’ logs/code-reviews/"
    bash scripts/code-review/auto-ai-review.sh > /dev/null 2>&1 &
fi

echo "âœ… All background tasks started. Check logs/ for results."

exit 0
