#!/usr/bin/env bash

# Post-commit Hook: Background AI Code Review
# ëª©ì : ì»¤ë°‹ ì™„ë£Œ í›„ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ìžë™ AI ì½”ë“œ ë¦¬ë·° ì‹¤í–‰
# ë³€ê²½ ì´ë ¥:
#   - 2025-11-26: pre-commitì—ì„œ post-commitìœ¼ë¡œ ì´ë™ (ì»¤ë°‹ ë¸”ë¡œí‚¹ ë°©ì§€)

set -e

echo "ðŸš€ Post-commit validation started (background, 5min timeout)..."

# 1. ESLint ì „ì²´ ê²€ì‚¬ (ë°±ê·¸ë¼ìš´ë“œ, 5ë¶„ íƒ€ìž„ì•„ì›ƒ)
if [ -f "scripts/lint/run-lint-check.sh" ]; then
    echo "  ðŸ” ESLint check â†’ logs/lint-reports/"
    timeout 300 bash scripts/lint/run-lint-check.sh > /dev/null 2>&1 &
fi

# 2. TypeScript íƒ€ìž… ì²´í¬ (ë°±ê·¸ë¼ìš´ë“œ, 5ë¶„ íƒ€ìž„ì•„ì›ƒ)
if [ -f "scripts/typecheck/run-typecheck.sh" ]; then
    echo "  ðŸ“ TypeScript check â†’ logs/typecheck-reports/"
    timeout 300 bash scripts/typecheck/run-typecheck.sh > /dev/null 2>&1 &
fi

# 3. Auto AI Code Review (Codex â†’ Gemini Fallback, ë°±ê·¸ë¼ìš´ë“œ, 5ë¶„ íƒ€ìž„ì•„ì›ƒ)
if [ -f "scripts/code-review/auto-ai-review.sh" ]; then
    echo "  ðŸ¤– AI code review â†’ logs/code-reviews/"
    timeout 300 bash scripts/code-review/auto-ai-review.sh > /dev/null 2>&1 &
fi

# 4. í†µí•© ì•Œë¦¼ ìƒì„± (ëª¨ë“  ìž‘ì—… ì™„ë£Œ í›„)
if [ -f "scripts/validation/create-summary.sh" ]; then
    # ë°±ê·¸ë¼ìš´ë“œ ìž‘ì—…ì´ ì™„ë£Œë  ë•Œê¹Œì§€ ëŒ€ê¸° (ìµœëŒ€ 310ì´ˆ)
    (sleep 310 && bash scripts/validation/create-summary.sh > /dev/null 2>&1) &
fi

echo "âœ… All background tasks started (5min timeout)."
echo "ðŸ’¡ Results will be in logs/ and /tmp/validation-complete-*.md"

exit 0
